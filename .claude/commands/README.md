# Claude Code 自动化指令系统

本项目配置了一套完整的自动化指令系统，旨在提高 AI 辅助开发的效率和质量。

## 📋 指令列表

### 🔄 上下文管理

#### `/context-transfer` - 上下文迁移
**用途**: 当 Token 即将耗尽时，生成完整的会话快照，便于在新会话中恢复工作状态。

**关键功能**:
- 生成会话快照文档 (docs/sessions/session-{时间}.md)
- 记录当前进度、文件变更、已知问题
- 更新 CLAUDE.md 引用最新快照
- 提供新会话恢复指令

**使用场景**:
- Token 使用率超过 80%
- 长时间开发后需要保存状态
- 准备切换到新会话

**触发方式**:
```
/context-transfer
保存当前进度
生成会话快照
```

---

### 💾 开发进度管理

#### `/progress` - 查看当前进度
**用途**: 显示项目整体进度、代码统计、测试覆盖率等。

**输出内容**:
- 整体进度百分比和阶段完成情况
- 代码行数统计（后端/前端）
- 测试覆盖率
- Git 提交数量
- 近期里程碑和下一步任务

**触发方式**:
```
/progress
查看进度
```

#### `/progress-save [描述]` - 保存进度检查点
**用途**: 保存当前开发进度作为检查点，方便后续对比和回溯。

**保存内容**:
- Git commit hash 和分支信息
- 代码统计和测试覆盖率
- 已完成/进行中/待办任务列表
- 文件树快照

**触发方式**:
```
/progress-save "完成支付功能"
保存进度
```

#### `/progress-load [检查点ID]` - 加载历史进度
**用途**: 查看历史保存的进度检查点。

#### `/progress-compare` - 对比进度变化
**用途**: 对比两个时间点的进度变化，生成详细的对比报告。

---

### 🐛 Bug 经验库管理

#### `/bug-add` - 添加 Bug 经验
**用途**: 记录遇到的 Bug 及其解决方案到经验库，避免重复踩坑。

**记录内容**:
- Bug 标题和分类
- 详细描述和错误信息
- 文件位置
- 解决方案和根本原因
- 预防措施

**触发方式**:
```
/bug-add
记录这个 Bug
保存这个问题的解决方案
```

#### `/bug-search [关键词]` - 搜索 Bug 经验
**用途**: 根据关键词搜索已知的 Bug 和解决方案。

**搜索范围**:
- Bug 标题
- 问题描述
- 错误信息
- 文件路径
- 标签

**触发方式**:
```
/bug-search "空指针"
/bug-search "NullPointerException"
```

#### `/bug-list [分类]` - 列出 Bug 清单
**用途**: 按分类列出所有 Bug 经验。

**分类**:
- backend - 后端 Bug
- frontend - 前端 Bug
- database - 数据库 Bug
- devops - 部署/运维 Bug
- integration - 第三方集成 Bug

#### `/bug-stats` - Bug 统计分析
**用途**: 统计 Bug 的分类、频率、解决时间，提供改进建议。

---

### 💾 Git 提交管理

#### `/commit` - 智能提交
**用途**: 自动分析代码变更，生成规范的 Git 提交信息，并更新项目文档。

**自动执行**:
1. 分析 Git diff，识别变更类型 (feat/fix/docs/refactor/...)
2. 生成符合 Conventional Commits 规范的提交信息
3. 更新 `docs/开发进度.md`
4. 更新 CLAUDE.md 项目状态
5. 执行 Git 提交和推送

**智能特性**:
- 自动检测提交类型和影响范围
- 自动关联 Issue (#数字)
- 防止敏感信息提交
- 推送失败时提供解决方案

**触发方式**:
```
/commit
提交代码
保存进度并提交
```

---

### 🔍 代码审查

#### `/review` - 审查当前变更
**用途**: 自动检查代码质量、规范遵守和潜在问题。

**检查项**:
- **功能性**: 是否实现需求、边界条件处理
- **代码质量**: 命名、职责单一、注释
- **安全性**: SQL 注入、XSS、敏感数据
- **性能**: N+1 查询、循环优化、缓存使用
- **测试覆盖**: 关键逻辑有测试、覆盖率达标
- **文档**: 公共 API 有注释

**输出**:
- 错误 (❌): 必须修复的严重问题
- 警告 (⚠️): 建议修复的问题
- 建议 (💡): 可选的优化
- 代码质量评分

**触发方式**:
```
/review
审查代码
Code Review
```

#### `/review-file [文件路径]` - 审查指定文件

#### `/review-commit [commit hash]` - 审查指定提交

---

### 🧪 测试覆盖率

#### `/test` - 运行所有测试
**用途**: 运行项目的所有测试并生成详细的覆盖率报告。

**输出内容**:
- 测试执行结果（通过/失败/跳过）
- 代码覆盖率（行/分支/函数）
- 失败测试的详细信息
- 低覆盖率模块列表
- 覆盖率趋势对比
- 改进建议

**触发方式**:
```
/test
运行测试
测试覆盖率
```

#### `/test-backend` - 运行后端测试

#### `/test-frontend` - 运行前端测试

#### `/test-watch` - 监听模式运行测试

---

### 🔧 代码重构

#### `/refactor` - 交互式重构
**用途**: 基于代码审查结果或技术债务，执行自动化代码重构。

**重构类型**:
- 提取方法 (Extract Method)
- 重命名 (Rename)
- 消除重复代码 (Remove Duplication)
- 提取常量 (Extract Constant)
- 简化条件表达式 (Simplify Conditional)

**安全特性**:
- 重构前自动创建 Git 分支
- 重构后自动运行测试
- 保留重构前后对比

**触发方式**:
```
/refactor
代码重构
```

---

### 📄 文档生成

#### `/docs-api` - 生成 API 文档
**用途**: 基于代码注释和接口定义，自动生成 API 文档。

**输出格式**:
- Markdown 文档
- Postman Collection
- OpenAPI (Swagger) 规范

#### `/docs-db` - 生成数据库文档
**用途**: 基于数据库表结构，生成数据库文档和 ER 图。

#### `/docs-arch` - 生成架构图
**用途**: 生成系统架构图、时序图、流程图。

#### `/docs-changelog` - 生成变更日志
**用途**: 基于 Git 提交历史，生成 CHANGELOG.md。

---

### 🚀 自动化部署

#### `/deploy-dev` - 部署到开发环境

#### `/deploy-test` - 部署到测试环境

#### `/deploy-prod` - 部署到生产环境

**部署流程**:
1. 运行所有测试
2. 代码审查通过检查
3. 构建项目
4. 备份当前版本
5. 部署新版本
6. 健康检查
7. 通知相关人员

**安全检查**:
- 生产环境部署需要二次确认
- 自动回滚机制
- 部署日志记录

---

## 🔄 典型工作流

### 开发新功能

```
1. 开始开发
   ↓
2. 编写代码和测试
   ↓
3. /review                 # 代码审查
   ↓
4. 修复审查发现的问题
   ↓
5. /test                   # 运行测试
   ↓
6. /commit                 # 智能提交
   ↓
7. /progress               # 查看进度
```

### 遇到 Bug

```
1. 发现 Bug
   ↓
2. /bug-search "关键词"     # 搜索已知解决方案
   ↓
3. 如果是新 Bug，解决后:
   ↓
4. /bug-add                # 记录到经验库
```

### 上下文即将耗尽

```
1. Token 使用率 > 80%
   ↓
2. /context-transfer       # 生成会话快照
   ↓
3. 在新会话中说:
   "继续上次的开发工作"
   ↓
4. Claude 自动读取快照恢复上下文
```

---

## 💡 最佳实践

### 1. 定期保存进度

每完成一个重要功能后，执行:
```
/progress-save "完成XX功能"
/commit
```

### 2. 提交前自动检查

`/commit` 会自动触发代码审查和测试，确保提交质量。

### 3. Bug 记录及时

遇到问题并解决后，立即执行 `/bug-add`，避免遗忘细节。

### 4. 定期查看进度

每天开始/结束工作时，执行 `/progress` 查看整体进度。

### 5. 长会话中保存快照

当 Token 使用率超过 60% 时，考虑执行 `/context-transfer`。

---

## 🎓 新手入门

### 第一次使用

1. 查看当前项目状态:
   ```
   /progress
   ```

2. 体验智能提交:
   ```
   /commit
   ```

3. 搜索已知问题:
   ```
   /bug-search "关键词"
   ```

4. 查看代码质量:
   ```
   /review
   ```

### 学习资源

- 阅读 `.claude/commands/` 目录下的详细文档
- 查看 `CLAUDE.md` 了解项目概述
- 参考 `docs/` 目录下的设计文档

---

## 📚 相关文档

- [CLAUDE.md](../../CLAUDE.md_back) - 项目概述和配置
- [开发进度](../../docs/开发进度.md) - 开发进度跟踪（待创建）
- [Bug经验库](../../docs/Bug经验库.md) - Bug 记录（待创建）
- [前端开发规范](../../docs/v0/4前端开发规范.md) - 前端规范
- [后端开发规范](../../docs/v0/5后端开发规范.md) - 后端规范

---

## ⚙️ 配置选项

部分指令支持自定义配置，在 `.claude/config.json` 中设置：

```json
{
  "commit": {
    "autoPush": true,
    "updateDocs": true
  },
  "codeReview": {
    "autoReviewOnCommit": true,
    "minCoverageBackend": 80,
    "minCoverageFrontend": 70
  },
  "test": {
    "autoRunOnCommit": true,
    "failOnCoverageDrop": false
  }
}
```

---

## 🤝 贡献

如果您有新的指令想法或改进建议，欢迎在项目中提出！

---

**Powered by Claude Code** 🚀
