# æ”¯ä»˜å®‰å…¨å¢å¼ºæ–¹æ¡ˆ

> **æ–‡æ¡£ç›®çš„**ï¼šè¯¦ç»†è¯´æ˜å¾®ä¿¡æ”¯ä»˜çš„å®‰å…¨åŠ å›ºæªæ–½
> **å¯¹åº”å†³ç­–**ï¼šè®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£ P1-3ï¼ˆæ”¯ä»˜å®‰å…¨å¢å¼ºï¼‰

---

## ğŸ“‹ å®‰å…¨å¨èƒåˆ†æ

### 1. æ½œåœ¨æ”»å‡»åœºæ™¯

| æ”»å‡»ç±»å‹ | æ”»å‡»æ‰‹æ®µ | å½±å“ | é˜²æŠ¤çº§åˆ« |
|---------|---------|------|---------|
| **é‡æ”¾æ”»å‡»** | æˆªè·å¹¶é‡å¤å‘é€æ”¯ä»˜å›è°ƒ | é‡å¤å…¥è´¦ã€èµ„é‡‘é£é™© | ğŸ”´ P0 |
| **CSRFæ”»å‡»** | ä¼ªé€ OAuthæˆæƒè¯·æ±‚ | è´¦å·åŠ«æŒ | ğŸ”´ P0 |
| **è®¢å•æšä¸¾** | çŒœæµ‹è®¢å•å·è§„å¾‹ | ä¿¡æ¯æ³„éœ² | ğŸŸ  P1 |
| **Tokençªƒå–** | çªƒå–accessToken | æœªæˆæƒæ“ä½œ | ğŸŸ  P1 |
| **ä¸­é—´äººæ”»å‡»** | æ‹¦æˆªHTTPè¯·æ±‚ | æ•°æ®æ³„éœ² | ğŸŸ¡ P2 |
| **æ”¯ä»˜é¡µé¢åŠ«æŒ** | JSæ³¨å…¥ã€é’“é±¼é¡µé¢ | èµ„é‡‘æŸå¤± | ğŸŸ¡ P2 |

---

## ğŸ”’ é˜¶æ®µ1ï¼šæ”¯ä»˜å›è°ƒå®‰å…¨å¢å¼ºï¼ˆP0ï¼Œå¿…é¡»å®ç°ï¼‰

### 1.1 å¾®ä¿¡ç­¾åéªŒè¯

**å®ç°åŸç†**ï¼š
```java
@Service
public class WechatPaySignatureValidator {

    @Value("${wechat.pay.api-key}")
    private String apiKey;

    /**
     * éªŒè¯å¾®ä¿¡æ”¯ä»˜å›è°ƒç­¾å
     *
     * @param params å›è°ƒå‚æ•°ï¼ˆXMLè§£æåçš„Mapï¼‰
     * @return true=éªŒè¯é€šè¿‡, false=ç­¾åé”™è¯¯
     */
    public boolean validateSign(Map<String, String> params) {
        // 1. æå–signå­—æ®µ
        String receivedSign = params.get("sign");
        if (receivedSign == null || receivedSign.isEmpty()) {
            log.warn("Missing sign field in wechat payment callback");
            return false;
        }

        // 2. ç§»é™¤signå­—æ®µï¼ˆå‚ä¸ç­¾åçš„å­—æ®µä¸åŒ…å«signæœ¬èº«ï¼‰
        Map<String, String> signParams = new TreeMap<>(params);
        signParams.remove("sign");

        // 3. æŒ‰å­—å…¸åºæ‹¼æ¥å‚æ•°
        StringBuilder sb = new StringBuilder();
        for (Map.Entry<String, String> entry : signParams.entrySet()) {
            if (entry.getValue() != null && !entry.getValue().isEmpty()) {
                sb.append(entry.getKey()).append("=").append(entry.getValue()).append("&");
            }
        }
        sb.append("key=").append(apiKey);

        // 4. MD5ç­¾å
        String calculatedSign = DigestUtils.md5Hex(sb.toString()).toUpperCase();

        // 5. å¯¹æ¯”ç­¾å
        boolean valid = calculatedSign.equals(receivedSign);
        if (!valid) {
            log.error("Wechat pay signature validation failed. Expected: {}, Actual: {}",
                      calculatedSign, receivedSign);
        }
        return valid;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@PostMapping("/api/webhook/wechat/payment")
public String handlePaymentCallback(@RequestBody String xml) {
    Map<String, String> params = WechatXmlParser.parse(xml);

    // ç¬¬ä¸€æ­¥ï¼šéªŒè¯ç­¾å
    if (!signatureValidator.validateSign(params)) {
        log.error("Invalid signature from wechat payment callback");
        sendSecurityAlert("æ”¯ä»˜å›è°ƒç­¾åéªŒè¯å¤±è´¥", params);
        return "<xml><return_code>FAIL</return_code><return_msg>ç­¾åé”™è¯¯</return_msg></xml>";
    }

    // ç»§ç»­å¤„ç†ä¸šåŠ¡é€»è¾‘...
}
```

---

### 1.2 æ—¶é—´çª—å£éªŒè¯ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰

**åŸç†**ï¼šæ‹’ç»æ—¶é—´æˆ³è¿‡æ—§çš„å›è°ƒè¯·æ±‚

**å®ç°**ï¼š
```java
/**
 * éªŒè¯å›è°ƒæ—¶é—´çª—å£ï¼ˆ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
 */
public boolean validateTimeWindow(Map<String, String> params) {
    String timeEndStr = params.get("time_end");  // ç¤ºä¾‹: 20251204123000
    if (timeEndStr == null || timeEndStr.isEmpty()) {
        return true;  // å¦‚æœå¾®ä¿¡æœªè¿”å›æ—¶é—´ï¼Œè·³è¿‡éªŒè¯
    }

    try {
        LocalDateTime callbackTime = LocalDateTime.parse(
            timeEndStr,
            DateTimeFormatter.ofPattern("yyyyMMddHHmmss")
        );

        long minutesDiff = ChronoUnit.MINUTES.between(callbackTime, LocalDateTime.now());

        if (minutesDiff > 5) {
            log.warn("Payment callback time_end too old: {} minutes ago", minutesDiff);
            return false;
        }

        if (minutesDiff < -1) {  // å…è®¸1åˆ†é’Ÿæ—¶é’Ÿè¯¯å·®
            log.warn("Payment callback time_end in the future: {} minutes", Math.abs(minutesDiff));
            return false;
        }

        return true;
    } catch (Exception e) {
        log.error("Failed to parse time_end: {}", timeEndStr, e);
        return false;
    }
}
```

---

### 1.3 Rediså¹‚ç­‰æ€§æ£€æŸ¥ï¼ˆåˆ†å¸ƒå¼é”ï¼‰

**åŸç†**ï¼šä½¿ç”¨Redisçš„`SETNX`å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”

**å®ç°**ï¼š
```java
@Service
public class PaymentCallbackIdempotentService {

    @Autowired
    private StringRedisTemplate redisTemplate;

    /**
     * å°è¯•è·å–å›è°ƒå¤„ç†é”
     *
     * @param orderNo è®¢å•å·
     * @return true=è·å–æˆåŠŸï¼ˆé¦–æ¬¡å¤„ç†ï¼‰, false=é”å·²å­˜åœ¨ï¼ˆé‡å¤å›è°ƒï¼‰
     */
    public boolean tryAcquireLock(String orderNo) {
        String lockKey = "payment:callback:" + orderNo;
        Boolean acquired = redisTemplate.opsForValue().setIfAbsent(
            lockKey,
            String.valueOf(System.currentTimeMillis()),
            10,  // 10åˆ†é’Ÿåè‡ªåŠ¨é‡Šæ”¾ï¼ˆé˜²æ­¢æ­»é”ï¼‰
            TimeUnit.MINUTES
        );

        if (Boolean.FALSE.equals(acquired)) {
            log.warn("Duplicate payment callback detected for orderNo: {}", orderNo);
            return false;
        }

        log.info("Payment callback lock acquired for orderNo: {}", orderNo);
        return true;
    }

    /**
     * é‡Šæ”¾é”
     */
    public void releaseLock(String orderNo) {
        String lockKey = "payment:callback:" + orderNo;
        redisTemplate.delete(lockKey);
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Transactional(rollbackFor = Exception.class)
public void processPaymentCallback(Map<String, String> params) {
    String orderNo = params.get("out_trade_no");

    // å°è¯•è·å–é”
    if (!idempotentService.tryAcquireLock(orderNo)) {
        log.info("Duplicate callback, skip processing");
        return;  // é‡å¤å›è°ƒï¼Œç›´æ¥è¿”å›æˆåŠŸ
    }

    try {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†...
        updatePaymentRecord(orderNo);
    } finally {
        // å¤„ç†å®Œæˆåé‡Šæ”¾é”
        idempotentService.releaseLock(orderNo);
    }
}
```

---

### 1.4 æ•°æ®åº“å”¯ä¸€çº¦æŸ

**é˜²æ­¢å¹¶å‘åœºæ™¯ä¸‹çš„é‡å¤å…¥è´¦**ï¼š

```sql
-- payment_recordè¡¨å”¯ä¸€çº¦æŸ
ALTER TABLE payment_record
ADD CONSTRAINT uk_order_no UNIQUE (order_no);

-- å¦‚æœéœ€è¦æ›´æ–°è®¢å•çŠ¶æ€ï¼Œä½¿ç”¨ä¹è§‚é”
ALTER TABLE payment_record
ADD COLUMN version INT DEFAULT 0;
```

**ä¹è§‚é”ç¤ºä¾‹**ï¼š
```java
@Update("UPDATE payment_record SET pay_status = #{payStatus}, version = version + 1 " +
        "WHERE order_no = #{orderNo} AND pay_status = 'PENDING' AND version = #{version}")
int updatePayStatusWithOptimisticLock(@Param("orderNo") String orderNo,
                                       @Param("payStatus") String payStatus,
                                       @Param("version") int version);
```

---

## ğŸ” é˜¶æ®µ2ï¼šä¸€æ¬¡æ€§Ticketæœºåˆ¶ï¼ˆP1ï¼Œæ¨èå®ç°ï¼‰

### 2.1 è®¾è®¡åŸç†

**é—®é¢˜**ï¼šaccessTokenå¯é‡å¤ä½¿ç”¨ï¼Œå­˜åœ¨å®‰å…¨é£é™©

**è§£å†³æ–¹æ¡ˆ**ï¼šå¼•å…¥ä¸€æ¬¡æ€§ticketæœºåˆ¶

**æµç¨‹**ï¼š
```mermaid
sequenceDiagram
    participant H5 as H5å‰ç«¯
    participant API as åç«¯API
    participant Redis as Redis

    H5->>API: POST /api/h5/paymentsï¼ˆåˆ›å»ºè®¢å•ï¼‰
    API->>Redis: ç”Ÿæˆä¸€æ¬¡æ€§ticketï¼ˆtk_once_xxx, TTL=5åˆ†é’Ÿï¼‰
    API->>Redis: å…³è”ticket â†’ orderNo
    API-->>H5: è¿”å›{orderNo, prepay_id, ticket}

    Note over H5,Redis: æ”¯ä»˜æˆåŠŸåè½®è¯¢è®¢å•çŠ¶æ€

    H5->>API: GET /api/h5/orders/{orderNo}/status?ticket=tk_once_xxx
    API->>Redis: éªŒè¯ticketæ˜¯å¦å­˜åœ¨
    Redis-->>API: è¿”å›orderNo
    API->>API: éªŒè¯ticketå…³è”çš„orderNo === è¯·æ±‚orderNo
    API->>Redis: åˆ é™¤ticketï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰
    API-->>H5: è¿”å›è®¢å•çŠ¶æ€

    H5->>API: GET /api/h5/orders/{orderNo}/status?ticket=tk_once_xxx
    API->>Redis: æŸ¥è¯¢ticket
    Redis-->>API: ticketä¸å­˜åœ¨
    API-->>H5: è¿”å›401 "ç¥¨æ®æ— æ•ˆæˆ–å·²ä½¿ç”¨"
```

### 2.2 å®ç°ä»£ç 

**ç”Ÿæˆticket**ï¼š
```java
@Service
public class OneTimeTicketService {

    @Autowired
    private StringRedisTemplate redisTemplate;

    /**
     * ç”Ÿæˆä¸€æ¬¡æ€§ticket
     *
     * @param orderNo è®¢å•å·
     * @return ticketå­—ç¬¦ä¸²
     */
    public String generateTicket(String orderNo) {
        String ticket = "tk_once_" + UUID.randomUUID().toString();
        String key = "ticket:" + ticket;

        // å­˜å…¥Redisï¼Œ5åˆ†é’Ÿæœ‰æ•ˆ
        redisTemplate.opsForValue().set(
            key,
            orderNo,
            5,
            TimeUnit.MINUTES
        );

        log.info("Generated one-time ticket: {} for orderNo: {}", ticket, orderNo);
        return ticket;
    }

    /**
     * éªŒè¯å¹¶æ¶ˆè´¹ticket
     *
     * @param ticket ç¥¨æ®
     * @param expectedOrderNo æœŸæœ›çš„è®¢å•å·
     * @return true=éªŒè¯é€šè¿‡, false=éªŒè¯å¤±è´¥
     */
    public boolean validateAndConsumeTicket(String ticket, String expectedOrderNo) {
        String key = "ticket:" + ticket;

        // è·å–å¹¶åˆ é™¤ï¼ˆåŸå­æ“ä½œï¼‰
        String actualOrderNo = redisTemplate.opsForValue().getAndDelete(key);

        if (actualOrderNo == null) {
            log.warn("Ticket not found or already used: {}", ticket);
            return false;
        }

        if (!actualOrderNo.equals(expectedOrderNo)) {
            log.error("Ticket orderNo mismatch. Expected: {}, Actual: {}",
                      expectedOrderNo, actualOrderNo);
            // æ¢å¤ticketï¼ˆè®¢å•å·ä¸åŒ¹é…è§†ä¸ºæ”»å‡»ï¼‰
            redisTemplate.opsForValue().set(key, actualOrderNo, 1, TimeUnit.MINUTES);
            return false;
        }

        log.info("Ticket validated and consumed: {}", ticket);
        return true;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// åˆ›å»ºè®¢å•æ—¶ç”Ÿæˆticket
@PostMapping("/api/h5/payments")
public Result<PaymentResponse> createPayment(@RequestBody PaymentRequest request) {
    // ... åˆ›å»ºè®¢å•é€»è¾‘ ...

    String ticket = ticketService.generateTicket(orderNo);

    return Result.success(PaymentResponse.builder()
        .orderNo(orderNo)
        .prepayId(prepayId)
        .ticket(ticket)  // è¿”å›ticketç»™å‰ç«¯
        .build());
}

// æŸ¥è¯¢è®¢å•çŠ¶æ€æ—¶éªŒè¯ticket
@GetMapping("/api/h5/orders/{orderNo}/status")
public Result<OrderStatusResponse> queryOrderStatus(
        @PathVariable String orderNo,
        @RequestParam String ticket) {

    // éªŒè¯å¹¶æ¶ˆè´¹ticket
    if (!ticketService.validateAndConsumeTicket(ticket, orderNo)) {
        throw new BusinessException(401, "ç¥¨æ®æ— æ•ˆæˆ–å·²ä½¿ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢");
    }

    // æŸ¥è¯¢è®¢å•çŠ¶æ€...
}
```

---

## ğŸ›¡ï¸ é˜¶æ®µ3ï¼šå‰ç«¯å¤±è´¥è¡¥å¿ï¼ˆP2ï¼Œå¢å¼ºä½“éªŒï¼‰

### 3.1 æ”¯ä»˜å¤±è´¥å¤„ç†

**å‰ç«¯ä»£ç **ï¼š
```javascript
// H5å‰ç«¯ï¼šæ”¯ä»˜é¡µé¢
async function handlePayment() {
  try {
    // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜
    await wx.chooseWXPay({
      ...payParams,
      success: async function(res) {
        console.log('æ”¯ä»˜æˆåŠŸ', res);
        // è½®è¯¢è®¢å•çŠ¶æ€
        await pollOrderStatus();
      },
      fail: async function(err) {
        console.error('æ”¯ä»˜å¤±è´¥', err);

        if (err.errMsg === 'chooseWXPay:cancel') {
          // ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆ
          showResumePaymentButton();
        } else {
          // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
          // ä»ç„¶è½®è¯¢è®¢å•çŠ¶æ€ï¼ˆå¯èƒ½å·²æ”¯ä»˜æˆåŠŸï¼‰
          const status = await checkOrderStatus();

          if (status.payStatus !== 'SUCCESS') {
            showResumePaymentButton();
          }
        }
      }
    });
  } catch (error) {
    console.error('è°ƒèµ·æ”¯ä»˜å¤±è´¥', error);
    showToast('æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}

// æ˜¾ç¤º"ç»§ç»­æ”¯ä»˜"æŒ‰é’®
function showResumePaymentButton() {
  Dialog.confirm({
    title: 'æ”¯ä»˜æœªå®Œæˆ',
    message: 'æ‚¨å¯ä»¥ç»§ç»­å®Œæˆæ”¯ä»˜ï¼Œæˆ–ç¨ååœ¨"æˆ‘çš„è®¢å•"ä¸­ç»§ç»­',
    confirmButtonText: 'ç»§ç»­æ”¯ä»˜',
    cancelButtonText: 'ç¨åæ”¯ä»˜'
  }).then(() => {
    // è°ƒç”¨æ¢å¤æ”¯ä»˜æ¥å£
    resumePayment();
  });
}
```

### 3.2 æ”¯ä»˜æ¢å¤æ¥å£

**åç«¯æ¥å£**ï¼š`POST /api/h5/payments/{orderNo}/resume`

**å®ç°**ï¼š
```java
@PostMapping("/api/h5/payments/{orderNo}/resume")
public Result<ResumePaymentResponse> resumePayment(@PathVariable String orderNo) {
    // 1. æŸ¥è¯¢è®¢å•
    PaymentRecord record = paymentRecordMapper.selectOne(
        new LambdaQueryWrapper<PaymentRecord>()
            .eq(PaymentRecord::getOrderNo, orderNo)
    );

    if (record == null) {
        throw new BusinessException("è®¢å•ä¸å­˜åœ¨");
    }

    // 2. éªŒè¯è®¢å•çŠ¶æ€
    if (!PayStatus.PENDING.equals(record.getPayStatus())) {
        throw new BusinessException("è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œæ— æ³•ç»§ç»­æ”¯ä»˜");
    }

    // 3. éªŒè¯è®¢å•æœ‰æ•ˆæœŸï¼ˆ30åˆ†é’Ÿå†…ï¼‰
    if (record.getCreatedAt().plusMinutes(30).isBefore(LocalDateTime.now())) {
        throw new BusinessException("è®¢å•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ä¸‹å•");
    }

    // 4. é‡æ–°ç”Ÿæˆprepay_idï¼ˆåŸprepay_idå·²è¿‡æœŸï¼‰
    String newPrepayId = wechatPayManager.createOrder(
        orderNo,
        record.getAmount(),
        record.getCampName()
    );

    // 5. ç”Ÿæˆæ–°çš„ç­¾å
    Map<String, String> payParams = wechatPayManager.generatePayParams(newPrepayId);

    return Result.success(ResumePaymentResponse.builder()
        .orderNo(orderNo)
        .prepayId(newPrepayId)
        .payParams(payParams)
        .build());
}
```

---

## ğŸš¨ å®‰å…¨å‘Šè­¦æœºåˆ¶

### 4.1 ä¼ä¸šå¾®ä¿¡å‘Šè­¦

**è§¦å‘åœºæ™¯**ï¼š
- ç­¾åéªŒè¯å¤±è´¥
- é‡æ”¾æ”»å‡»æ£€æµ‹åˆ°
- å¼‚å¸¸é«˜é¢‘å›è°ƒ
- accessToken/ticketå¼‚å¸¸ä½¿ç”¨

**å®ç°**ï¼š
```java
@Service
public class SecurityAlertService {

    @Autowired
    private WeworkNotifyManager weworkNotifyManager;

    /**
     * å‘é€å®‰å…¨å‘Šè­¦
     */
    public void sendSecurityAlert(String alertType, Map<String, Object> details) {
        String message = buildAlertMessage(alertType, details);

        // å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥
        weworkNotifyManager.sendTextMessage(
            message,
            "@all"  // é€šçŸ¥æ‰€æœ‰ç®¡ç†å‘˜
        );

        // è®°å½•å‘Šè­¦æ—¥å¿—
        SecurityAlertLog log = new SecurityAlertLog();
        log.setAlertType(alertType);
        log.setDetails(JSON.toJSONString(details));
        log.setSeverity("HIGH");
        securityAlertLogMapper.insert(log);
    }

    private String buildAlertMessage(String alertType, Map<String, Object> details) {
        return String.format(
            "ã€å®‰å…¨å‘Šè­¦ã€‘%s\n" +
            "æ—¶é—´: %s\n" +
            "è¯¦æƒ…: %s\n" +
            "è¯·ç«‹å³æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—",
            alertType,
            LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")),
            details
        );
    }
}
```

---

## ğŸ“Š å®‰å…¨ç›‘æ§æŒ‡æ ‡

### 5.1 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | é˜ˆå€¼ | å‘Šè­¦çº§åˆ« |
|------|------|---------|
| ç­¾åéªŒè¯å¤±è´¥ç‡ | >1% | ğŸ”´ P0 |
| é‡å¤å›è°ƒæ¬¡æ•° | >10æ¬¡/åˆ†é’Ÿ | ğŸŸ  P1 |
| TicketéªŒè¯å¤±è´¥ç‡ | >5% | ğŸŸ  P1 |
| è®¢å•æšä¸¾å°è¯• | >100æ¬¡/å°æ—¶ | ğŸŸ¡ P2 |
| accessTokenå¼‚å¸¸ä½¿ç”¨ | >50æ¬¡/å°æ—¶ | ğŸŸ¡ P2 |

### 5.2 PrometheusæŒ‡æ ‡é‡‡é›†

```java
@Component
public class PaymentSecurityMetrics {

    private final Counter signatureFailureCounter;
    private final Counter duplicateCallbackCounter;
    private final Counter ticketValidationFailureCounter;

    public PaymentSecurityMetrics(MeterRegistry registry) {
        this.signatureFailureCounter = Counter.builder("payment.signature.failure")
            .description("å¾®ä¿¡æ”¯ä»˜ç­¾åéªŒè¯å¤±è´¥æ¬¡æ•°")
            .register(registry);

        this.duplicateCallbackCounter = Counter.builder("payment.callback.duplicate")
            .description("é‡å¤æ”¯ä»˜å›è°ƒæ¬¡æ•°")
            .register(registry);

        this.ticketValidationFailureCounter = Counter.builder("payment.ticket.validation.failure")
            .description("TicketéªŒè¯å¤±è´¥æ¬¡æ•°")
            .register(registry);
    }

    public void recordSignatureFailure() {
        signatureFailureCounter.increment();
    }

    public void recordDuplicateCallback() {
        duplicateCallbackCounter.increment();
    }

    public void recordTicketValidationFailure() {
        ticketValidationFailureCounter.increment();
    }
}
```

---

## âœ… å®æ–½æ¸…å•

### é˜¶æ®µ1ï¼šæ”¯ä»˜å›è°ƒå®‰å…¨ï¼ˆå¿…é¡»å®ç°ï¼‰

- [ ] **P0-1**: å®ç°å¾®ä¿¡ç­¾åéªŒè¯
- [ ] **P0-2**: å®ç°æ—¶é—´çª—å£éªŒè¯
- [ ] **P0-3**: å®ç°Redisåˆ†å¸ƒå¼é”ï¼ˆå¹‚ç­‰æ€§ï¼‰
- [ ] **P0-4**: æ·»åŠ æ•°æ®åº“å”¯ä¸€çº¦æŸ
- [ ] **P0-5**: å®ç°ç­¾åéªŒè¯å¤±è´¥å‘Šè­¦

### é˜¶æ®µ2ï¼šä¸€æ¬¡æ€§Ticketï¼ˆæ¨èå®ç°ï¼‰

- [ ] **P1-1**: å®ç°ticketç”ŸæˆæœåŠ¡
- [ ] **P1-2**: å®ç°ticketéªŒè¯ä¸æ¶ˆè´¹
- [ ] **P1-3**: å‰ç«¯æ”¹é€ ï¼ˆæ”¯æŒticketå‚æ•°ï¼‰
- [ ] **P1-4**: ç¼–å†™å•å…ƒæµ‹è¯•

### é˜¶æ®µ3ï¼šå‰ç«¯å¤±è´¥è¡¥å¿ï¼ˆå¢å¼ºä½“éªŒï¼‰

- [ ] **P2-1**: å®ç°æ”¯ä»˜æ¢å¤æ¥å£
- [ ] **P2-2**: å‰ç«¯æ”¯ä»˜å¤±è´¥å¤„ç†é€»è¾‘
- [ ] **P2-3**: å‰ç«¯"ç»§ç»­æ”¯ä»˜"åŠŸèƒ½
- [ ] **P2-4**: è®¢å•æœ‰æ•ˆæœŸç®¡ç†

### é˜¶æ®µ4ï¼šç›‘æ§ä¸å‘Šè­¦

- [ ] **P2-5**: é›†æˆPrometheusæŒ‡æ ‡é‡‡é›†
- [ ] **P2-6**: é…ç½®Grafanaå‘Šè­¦è§„åˆ™
- [ ] **P2-7**: ä¼ä¸šå¾®ä¿¡å‘Šè­¦æ¥å…¥
- [ ] **P2-8**: å®‰å…¨æ—¥å¿—å®¡è®¡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¥å£æ–‡æ¡£ - 3.9 æ”¯ä»˜æ¢å¤æ¥å£](./æ¥å£æ–‡æ¡£.md)
- [æŠ€æœ¯æ–¹æ¡ˆ - 5.2.8 å¼‚å¸¸å¤„ç†](./æŠ€æœ¯æ–¹æ¡ˆ.md)
- [OAuthç»‘å®šå®Œæ•´æ—¶åºå›¾](./OAuthç»‘å®šå®Œæ•´æ—¶åºå›¾.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-12-04
**ç»´æŠ¤è€…**ï¼šæŠ€æœ¯æ¶æ„ç»„ + å®‰å…¨å›¢é˜Ÿ
