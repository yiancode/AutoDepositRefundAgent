# ğŸ¯ v1 ç‰ˆæœ¬è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£

> **æ–‡æ¡£ç›®çš„**ï¼šæ•´åˆæ‰€æœ‰å·²å‘ç°çš„è®¾è®¡é—®é¢˜å’Œä¼˜åŒ–æœºä¼š
> **ç”Ÿæˆæ—¶é—´**ï¼š2025-12-04

---

## ğŸ“Š å†³ç­–ä¼˜å…ˆçº§æ€»è§ˆ

### å…³é”®æŒ‡æ ‡

| ç±»åˆ« | ğŸ”´ é˜»å¡æ€§é—®é¢˜ | ğŸŸ  é«˜é£é™©é—®é¢˜ | ğŸŸ¡ ä¼˜åŒ–æœºä¼š | ğŸŸ¢ æ”¹è¿›å»ºè®® |
|------|------------|------------|----------|----------|
| **æ•°é‡** | 3 | 8 | 12 | 10 |
| **å¤„ç†æ—¶æœº** | Stage 0 å‰å¿…é¡»è§£å†³ | Stage 1 å‰å®Œæˆ | å¼€å‘ä¸­è¿­ä»£ | åç»­ç‰ˆæœ¬ |

### å½±å“é¢åˆ†æ

```
        ä¸šåŠ¡å½±å“ (Business Impact)
          ^
     é«˜   â”‚  ğŸ”´ P0 - å¿…é¡»è§£å†³         ğŸŸ  P1 - é«˜ä¼˜å…ˆçº§
          â”‚  â”œâ”€ EP02æ–‡æ¡£ç¼ºå¤±          â”œâ”€ é˜¶æ®µè§„åˆ’è°ƒæ•´
          â”‚  â”œâ”€ FastAuthæµç¨‹æ–­å±‚      â”œâ”€ æ”¯ä»˜å®‰å…¨å¢å¼º
          â”‚  â””â”€ bind_statusä¸ä¸€è‡´     â”œâ”€ æ¥å£DBè€¦åˆ
          â”‚                           â””â”€ OAuthç»‘å®šæ—¶åº
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     ä½   â”‚  ğŸŸ¢ P3 - å¯å»¶å            ğŸŸ¡ P2 - ä¸­ä¼˜å…ˆçº§
          â”‚  â”œâ”€ æ–‡æ¡£é‡å¤é—®é¢˜          â”œâ”€ ç›‘æ§ç»†ç²’åº¦
          â”‚  â”œâ”€ æ—¥å¿—è„±æ•              â”œâ”€ Dockerç¯å¢ƒ
          â”‚  â””â”€ E2Eæµ‹è¯•               â”œâ”€ Managerå±‚è¯„ä¼°
                                      â””â”€ APIå‘½åè§„èŒƒ
              ä½                    é«˜
                    æŠ€æœ¯å¤æ‚åº¦ (Complexity)
```

---

## ğŸ”´ ç¬¬ä¸€éƒ¨åˆ†ï¼šé˜»å¡æ€§é—®é¢˜ï¼ˆå¿…é¡»è§£å†³ï¼‰

### P0-1ï¼šEP02 ç”¨æˆ·æ•…äº‹æ–‡æ¡£ç¼ºå¤± âš ï¸âš ï¸âš ï¸

**é—®é¢˜æè¿°**ï¼š
- `docs/v1/user-stories/EP02-ä¼šå‘˜æŠ¥åä¸æ”¯ä»˜.md` ä¸å­˜åœ¨
- EP02 æ˜¯æ ¸å¿ƒæ”¯ä»˜æµç¨‹ï¼Œæ—  Gherkin éªŒæ”¶æ ‡å‡†å°†å¯¼è‡´å¼€å‘ç†è§£åå·®

**å½±å“èŒƒå›´**ï¼š
- ğŸ¯ ä¸šåŠ¡æµç¨‹ï¼šæ”¯ä»˜ç»‘å®šè·¯å¾„ã€OAuthé›†æˆã€AccessTokenæœºåˆ¶
- ğŸ‘¨â€ğŸ’» å¼€å‘å›¢é˜Ÿï¼šå‰åç«¯å¯¹æ¥å£ç†è§£ä¸ä¸€è‡´
- ğŸ§ª æµ‹è¯•éªŒæ”¶ï¼šæ— æ˜ç¡®éªŒæ”¶æ¡ä»¶

**å†³ç­–å»ºè®®**ï¼š
```yaml
æ–¹æ¡ˆ: ç«‹å³è¡¥å……å®Œæ•´EP02æ–‡æ¡£
  æ—¶é—´: 4å°æ—¶
  è´Ÿè´£äºº: äº§å“ + åç«¯è´Ÿè´£äºº
  ç»“æ„å‚è€ƒ:
    - S2.1: H5ç«¯OAuthæˆæƒç™»å½•
    - S2.2: åˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆåŠ¨æ€äºŒç»´ç è·¯å¾„ï¼‰
    - S2.3: å¾®ä¿¡æ”¯ä»˜JSAPIè°ƒç”¨
    - S2.4: æ”¯ä»˜å›è°ƒå¤„ç†ä¸AccessTokenç”Ÿæˆ
    - S2.5: ç”¨æˆ·ç»‘å®šæ˜Ÿçƒè´¦å·
    - S2.6: å›ºå®šäºŒç»´ç å…œåº•è·¯å¾„
    - S2.7: è®¢å•çŠ¶æ€æŸ¥è¯¢
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] äº§å“è´Ÿè´£äººç¼–å†™S2.1-S2.7æ•…äº‹è‰ç¨¿
- [ ] æŠ€æœ¯è´Ÿè´£äººè¡¥å……æŠ€æœ¯çº¦æŸå’Œè¾¹ç•Œæ¡ä»¶
- [ ] å‰åç«¯è¯„å®¡ç¡®è®¤éªŒæ”¶æ ‡å‡†

---

### P0-2ï¼šFastAuth ä¼šå‘˜éªŒè¯æµç¨‹æ–­å±‚ ğŸ”—

**é—®é¢˜æè¿°**ï¼š
- `docs/v1/FastAuthæ¥å…¥æ–¹æ¡ˆ.md:40-142` æè¿°äº†ä¼šå‘˜åŒæ­¥ + éªŒè¯ API
- `docs/v1/æ¥å£æ–‡æ¡£.md` ä»…æœ‰ç®€å•çš„ `POST /api/h5/members/verify`
- **ç¼ºå¤±ç¯èŠ‚**ï¼šOAuth å®Œæˆåå¦‚ä½•è½åœ° `user_planet_binding` è¡¨

**å½“å‰æµç¨‹ç¼ºå£**ï¼š
```mermaid
sequenceDiagram
    participant H5
    participant API
    participant FastAuth
    participant DB

    H5->>API: OAuthæˆæƒè¯·æ±‚
    API->>FastAuth: é‡å®šå‘åˆ°OAuth
    FastAuth->>API: å›è°ƒè¿”å›openid
    API->>H5: è¿”å›JWT token

    Note over API,DB: âŒ ç¼ºå¤±ï¼šå¦‚ä½•å†™å…¥user_planet_binding?
    Note over API,DB: âŒ ç¼ºå¤±ï¼šå¦‚ä½•ä¸payment_recordå…³è”?

    H5->>API: POST /api/h5/members/verify
    API->>DB: æŸ¥è¯¢user_planet_binding
    DB-->>API: ??? (æ•°æ®ä½•æ—¶å†™å…¥?)
```

**å†³ç­–å»ºè®®**ï¼š

**æ–¹æ¡ˆï¼šåœ¨ OAuth å›è°ƒä¸­ä¸»åŠ¨ç»‘å®š**

```yaml
æ—¶åºè®¾è®¡:
  1. OAuthå›è°ƒ â†’ è·å–openid
  2. æŸ¥è¯¢payment_recordï¼ˆé€šè¿‡access_tokenå…³è”ï¼‰
  3. å¦‚æœå­˜åœ¨è®¢å• + access_tokençŠ¶æ€=active:
     a. å¼•å¯¼ç”¨æˆ·å¡«å†™æ˜Ÿçƒä¿¡æ¯ï¼ˆuserNumber/ç”¨æˆ·åï¼‰
     b. è°ƒç”¨/api/h5/orders/{orderNo}/planet-binding
     c. å†™å…¥user_planet_bindingè¡¨
     d. æ›´æ–°payment_record.bind_status = 'completed'
  4. å¦‚æœæ— è®¢å•ï¼Œä»…åˆ›å»ºwechat_userè®°å½•

ä¼˜åŠ¿:
  âœ… æ”¯ä»˜å’Œç»‘å®šæµç¨‹å¼ºå…³è”
  âœ… æ•°æ®ä¸€è‡´æ€§æœ‰ä¿éšœ
  âœ… ç¬¦åˆ"æ”¯ä»˜å7å¤©å†…ç»‘å®š"çš„ä¸šåŠ¡è§„åˆ™
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¡¥å……å®Œæ•´æ—¶åºå›¾ï¼ˆOAuth â†’ ç»‘å®š â†’ éªŒè¯ï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ˜ç¡® `/api/auth/callback` çš„ç»‘å®šé€»è¾‘
- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­è¯´æ˜ `user_planet_binding` çš„æ•°æ®æ¥æº

---

### P0-3ï¼šbind_status çŠ¶æ€å®šä¹‰ä¸ä¸€è‡´ ğŸ“‹

**é—®é¢˜ä½ç½®**ï¼š
- **æŠ€æœ¯æ–¹æ¡ˆ**ï¼š`pending | completed | expired | manual_review | closed`
- **æ¥å£æ–‡æ¡£**ï¼šéƒ¨åˆ†æ¥å£è¿”å› `bind_status: "success"`ï¼ˆéæ ‡å‡†å€¼ï¼‰

**å†³ç­–å»ºè®®**ï¼š
```yaml
æ ‡å‡†çŠ¶æ€å€¼ï¼ˆä»¥æŠ€æœ¯æ–¹æ¡ˆä¸ºå‡†ï¼‰:
  pending:        æ”¯ä»˜å®Œæˆï¼Œå¾…ç”¨æˆ·ç»‘å®šï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
  completed:      ç»‘å®šå®Œæˆ
  expired:        è¶…è¿‡7å¤©æœªç»‘å®š
  manual_review:  ç³»ç»Ÿæ— æ³•è‡ªåŠ¨åŒ¹é…ï¼Œè¿›å…¥äººå·¥å®¡æ ¸
  closed:         äººå·¥å®¡æ ¸åˆ¤å®šæ— æ³•åŒ¹é…

ä¿®æ”¹æ¸…å•:
  - docs/v1/æ¥å£æ–‡æ¡£.md: æ‰€æœ‰è¿”å›bindStatuså­—æ®µç»Ÿä¸€ç”¨ä¸Šè¿°5ä¸ªå€¼
  - å‰ç«¯æšä¸¾å®šä¹‰: ä½¿ç”¨ç»Ÿä¸€çŠ¶æ€å¸¸é‡
  - æ•°æ®åº“çº¦æŸ: ALTER TABLE payment_record ADD CONSTRAINT check_bind_status
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] å…¨å±€æœç´¢æ›¿æ¢ `"success"` â†’ `"completed"`
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­å¢åŠ çŠ¶æ€æœºå›¾ä¾‹ï¼ˆ5çŠ¶æ€ + è½¬æ¢æ¡ä»¶ï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ·»åŠ çŠ¶æ€æšä¸¾è¯´æ˜ç« èŠ‚

---

## ğŸŸ  ç¬¬äºŒéƒ¨åˆ†ï¼šé«˜é£é™©é—®é¢˜ï¼ˆStage 1 å‰å®Œæˆï¼‰

### P1-1ï¼šé˜¶æ®µè§„åˆ’ä¸å‚ç›´åˆ‡ç‰‡åŸåˆ™å†²çª ğŸ—ï¸

**é—®é¢˜æè¿°**ï¼š
- **ç°çŠ¶**ï¼š
  - `docs/v1/AIè¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’.md:32-75` Stage 1 å¼•å…¥ OAuth + ç®¡ç†åå°éª¨æ¶
  - `docs/v1/æŠ€æœ¯æ–¹æ¡ˆ.md:3862-3974` Stage 1 åŒ…å«é«˜ä¾èµ–æ¨¡å—
- **å†²çª**ï¼šè¿èƒŒ"å…ˆåšä½ä¾èµ–å‚ç›´åˆ‡ç‰‡"åŸåˆ™
- **é£é™©**ï¼šOAuth å’Œç®¡ç†åå°å¹¶è¡Œå¼€å‘ä¼šäº§ç”Ÿäº¤å‰ç­‰å¾…ï¼Œå»¶åæ”¯ä»˜è·¯å¾„é£é™©æš´éœ²

**å½“å‰ Stage 1 å†…å®¹**ï¼š
```yaml
Stage 1ï¼ˆå½“å‰è§„åˆ’ï¼‰:
  - âœ… ç®¡ç†åå°éª¨æ¶ï¼ˆä½ä¸šåŠ¡ä»·å€¼ï¼‰
  - âœ… OAuthæˆæƒæµç¨‹ï¼ˆé˜»å¡H5ç«¯æ‰€æœ‰åŠŸèƒ½ï¼‰
  - âœ… è®­ç»ƒè¥CRUDï¼ˆç®¡ç†ç«¯åŠŸèƒ½ï¼‰

é—®é¢˜:
  - OAuthå¼€å‘é˜»å¡æ•´ä¸ªH5ç«¯
  - ç®¡ç†åå°å’Œæ”¯ä»˜æµç¨‹æ— ä¾èµ–å…³ç³»ï¼Œå´ä¸²è¡Œå¼€å‘
  - æ”¯ä»˜æ ¸å¿ƒè·¯å¾„åœ¨Stage 2æ‰èƒ½å®Œæ•´æµ‹è¯•
```

**å†³ç­–å»ºè®®**ï¼š

**æ–¹æ¡ˆï¼šè°ƒæ•´ä¸ºç«¯åˆ°ç«¯å‚ç›´åˆ‡ç‰‡**

```yaml
æ–°Stage 1ï¼ˆæ”¯ä»˜é—­ç¯ï¼‰:
  ç›®æ ‡: å®Œæˆ"ç”¨æˆ·æŠ¥åâ†’æ”¯ä»˜â†’ç»‘å®š"æœ€å°å¯ç”¨è·¯å¾„ï¼ˆMVPï¼‰

  åç«¯:
    - OAuthæˆæƒï¼ˆä»…H5å¿…éœ€éƒ¨åˆ†ï¼‰
    - æ”¯ä»˜è®¢å•åˆ›å»ºï¼ˆ/api/h5/paymentsï¼‰
    - å¾®ä¿¡æ”¯ä»˜å¯¹æ¥ï¼ˆJSAPI + å›è°ƒï¼‰
    - AccessTokenç”Ÿæˆä¸éªŒè¯
    - ç»‘å®šæ˜Ÿçƒè´¦å·ï¼ˆ/api/h5/orders/{id}/planet-bindingï¼‰

  å‰ç«¯:
    - H5æ”¯ä»˜é¡µé¢ï¼ˆç®€åŒ–ç‰ˆï¼Œæ— éœ€å®Œæ•´ç”¨æˆ·ä¸­å¿ƒï¼‰
    - å¾®ä¿¡æˆæƒè·³è½¬
    - æ”¯ä»˜ç»“æœè½®è¯¢
    - ç»‘å®šè¡¨å•

  æ•°æ®åº“:
    - training_campï¼ˆåŸºç¡€å­—æ®µï¼‰
    - payment_record
    - wechat_user
    - user_planet_binding

  éªŒæ”¶æ ‡å‡†:
    âœ… ç”¨æˆ·å¯å®Œæˆæ”¯ä»˜å¹¶ç»‘å®šæ˜Ÿçƒè´¦å·
    âœ… payment_record.bind_statusæ­£ç¡®æµè½¬
    âœ… æ”¯ä»˜å›è°ƒå¹‚ç­‰æ€§éªŒè¯é€šè¿‡

  ä»·å€¼:
    ğŸ’° æå‰æš´éœ²æ”¯ä»˜è·¯å¾„é£é™©ï¼ˆå¾®ä¿¡æ”¯ä»˜å¯¹æ¥ã€ç½‘ç»œé‡è¯•ï¼‰
    ğŸ’° å‰åç«¯å¯å¹¶è¡Œå¼€å‘ï¼ˆæ¥å£æ˜ç¡®ï¼‰
    ğŸ’° æœ€æ—©å¯æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

æ–°Stage 2ï¼ˆç®¡ç†åå° + æ‰“å¡åŒæ­¥ï¼‰:
  ç®¡ç†ç«¯:
    - è®­ç»ƒè¥ç®¡ç†ï¼ˆCRUD + å‘å¸ƒï¼‰
    - ä¼šå‘˜åˆ—è¡¨æŸ¥è¯¢
    - æ”¯ä»˜è®°å½•æŸ¥çœ‹

  åŒæ­¥ä»»åŠ¡:
    - çŸ¥è¯†æ˜Ÿçƒæ‰“å¡æ•°æ®åŒæ­¥
    - èº«ä»½åŒ¹é…ç®—æ³•
    - camp_memberè¡¨å®Œå–„

  ä»·å€¼:
    ğŸ’° ç®¡ç†ç«¯å’ŒåŒæ­¥ä»»åŠ¡å¯å¹¶è¡Œå¼€å‘
    ğŸ’° åŸºäºStage 1çš„çœŸå®æ”¯ä»˜æ•°æ®æµ‹è¯•

æ–°Stage 3ï¼ˆé€€æ¬¾æµç¨‹ï¼‰:
  - ä¿æŒåŸæœ‰è§„åˆ’
```



**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] å¬å¼€æŠ€æœ¯è¯„å®¡ä¼šï¼Œç¡®è®¤Stageé‡æ–°åˆ’åˆ†æ–¹æ¡ˆ
- [ ] æ›´æ–° `AIè¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’.md` çš„Stageå®šä¹‰
- [ ] æ›´æ–° `æŠ€æœ¯æ–¹æ¡ˆ.md` çš„å®æ–½è·¯çº¿å›¾
- [ ] é‡æ–°è¯„ä¼°å„Stageçš„æ—¶é—´ä¼°ç®—

---

### P1-2ï¼šæ¥å£/æ•°æ®åº“è€¦åˆä¸æ€§èƒ½é£é™© âš¡

**é—®é¢˜æè¿°**ï¼š
- **æ¥å£è®¾è®¡**ï¼š`docs/v1/æ¥å£æ–‡æ¡£.md:820-849` è¿”å›å­—æ®µåŒ…å« `planetUserId`, `userNumber`
- **æ•°æ®åº“è®¾è®¡**ï¼š`camp_member` è¡¨åªæœ‰ `filled_*` å’ŒåŒ¹é…å­—æ®µ
- **ç¼ºå¤±è®¾è®¡**ï¼šæ— è¯»å†™éš”ç¦»ç­–ç•¥ã€æ— ç¼“å­˜å±‚ã€æ¥å£ç›´æ¥å¤šè¡¨ JOIN

**æ€§èƒ½é£é™©åœºæ™¯**ï¼š
```sql
-- è·å–è®­ç»ƒè¥æˆå‘˜åˆ—è¡¨ï¼ˆéœ€è¦å…³è”3å¼ è¡¨ï¼‰
SELECT
    cm.id,
    cm.camp_id,
    cm.filled_user_number,  -- camp_memberè¡¨
    pu.planet_user_id,      -- planet_userè¡¨
    pu.name,                -- planet_userè¡¨
    pr.order_no,            -- payment_recordè¡¨
    pr.amount,              -- payment_recordè¡¨
    pr.bind_status          -- payment_recordè¡¨
FROM camp_member cm
LEFT JOIN planet_user pu ON cm.planet_user_id = pu.id
LEFT JOIN payment_record pr ON cm.payment_record_id = pr.id
WHERE cm.camp_id = ?;

-- é—®é¢˜:
-- 1. æ¯æ¬¡æŸ¥è¯¢éƒ½JOIN 3å¼ è¡¨
-- 2. é«˜å¹¶å‘åœºæ™¯ä¸‹DBæˆä¸ºç“¶é¢ˆ
-- 3. planetUserIdå¯èƒ½ä¸ºç©ºï¼ˆæœªåŒ¹é…ç”¨æˆ·ï¼‰ï¼ŒJOINæ€§èƒ½å·®
```

**å†³ç­–å»ºè®®**ï¼š

**æ–¹æ¡ˆï¼šå¼•å…¥ Redis ç¼“å­˜å±‚ + æ•°æ®å†—ä½™**

```yaml
è®¾è®¡åŸåˆ™:
  - è¯»å¤šå†™å°‘çš„æ•°æ® â†’ Redisç¼“å­˜
  - é«˜é¢‘æŸ¥è¯¢å­—æ®µ â†’ æ•°æ®åº“å†—ä½™
  - å¼ºä¸€è‡´æ€§è¦æ±‚ä½çš„æ•°æ® â†’ æœ€ç»ˆä¸€è‡´æ€§

å…·ä½“æ–¹æ¡ˆ:
  1. camp_memberè¡¨å¢åŠ å†—ä½™å­—æ®µ:
     ALTER TABLE camp_member ADD COLUMN planet_user_name VARCHAR(50);
     ALTER TABLE camp_member ADD COLUMN planet_user_number VARCHAR(50);
     ALTER TABLE camp_member ADD COLUMN order_no VARCHAR(64);

     ä¼˜åŠ¿:
       - ä¼šå‘˜åˆ—è¡¨æŸ¥è¯¢æ— éœ€JOIN
       - ç´¢å¼•ä¼˜åŒ–ç®€å•ï¼ˆå•è¡¨æŸ¥è¯¢ï¼‰

     åŠ£åŠ¿:
       - æ•°æ®æ›´æ–°æ—¶éœ€åŒæ­¥ç»´æŠ¤ï¼ˆç”¨è§¦å‘å™¨æˆ–ä¸šåŠ¡å±‚ä¿è¯ï¼‰

  2. Redisç¼“å­˜ä¼šå‘˜ä¿¡æ¯:
     Key: camp:members:{campId}
     Value: JSONæ•°ç»„ï¼ˆæˆå‘˜å®Œæ•´ä¿¡æ¯ï¼‰
     TTL: 5åˆ†é’Ÿ

     æ›´æ–°ç­–ç•¥:
       - ä¼šå‘˜ä¿¡æ¯å˜æ›´æ—¶ä¸»åŠ¨åˆ é™¤ç¼“å­˜ï¼ˆCache Asideæ¨¡å¼ï¼‰
       - ä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡å»ºç¼“å­˜

  3. è¯»å†™åˆ†ç¦»æŸ¥è¯¢:
     // è¯»æ¥å£ï¼ˆå…è®¸5åˆ†é’Ÿå»¶è¿Ÿï¼‰
     GET /api/admin/camps/{id}/members
     â†’ ä¼˜å…ˆè¯»Redisç¼“å­˜
     â†’ ç¼“å­˜æœªå‘½ä¸­è¯»ä»åº“

     // å†™æ¥å£ï¼ˆå®æ—¶æ€§è¦æ±‚é«˜ï¼‰
     POST /api/admin/members/{id}/verify
     â†’ å†™ä¸»åº“ + åˆ é™¤ç¼“å­˜
```



**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­è¡¥å……ç¼“å­˜ç­–ç•¥ç« èŠ‚
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¯´æ˜è¯»å†™åˆ†ç¦»æ¶æ„
- [ ] è¯„ä¼°æ–¹æ¡ˆAå’Œæ–¹æ¡ˆBçš„æ€§èƒ½å·®å¼‚ï¼ˆå‹æµ‹éªŒè¯ï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ ‡æ³¨å“ªäº›æ¥å£ä½¿ç”¨ç¼“å­˜

---

### P1-3ï¼šæ”¯ä»˜å®‰å…¨å¢å¼ºï¼ˆé˜²é‡æ”¾ + å‰ç«¯å¤±è´¥è¡¥å¿ï¼‰ ğŸ”

**é—®é¢˜æè¿°**ï¼š
- **ç°çŠ¶**ï¼š`docs/v1/æ¥å£æ–‡æ¡£.md:188-199` ä»…ä½¿ç”¨ AccessToken ä¿æŠ¤ H5 æ¥å£
- **ç¼ºå¤±**ï¼š
  1. å¾®ä¿¡æ”¯ä»˜ `prepay_id` ç­¾åé˜²é‡æ”¾
  2. å‰ç«¯ JSAPI è°ƒç”¨å¤±è´¥çš„è¡¥å¿æœºåˆ¶
  3. æ”¯ä»˜å›è°ƒçš„æ—¶é—´çª—å£éªŒè¯

**å®‰å…¨é£é™©åœºæ™¯**ï¼š
```javascript
// åœºæ™¯1: å‰ç«¯é‡æ”¾æ”»å‡»
// æ”»å‡»è€…è·å–åˆ°åˆæ³•çš„accessTokenåï¼Œå¯é‡å¤æŸ¥è¯¢è®¢å•çŠ¶æ€
GET /api/h5/orders/{orderNo}/status
Authorization: Bearer <stolen_access_token>

// é—®é¢˜: æ— ä¸€æ¬¡æ€§ticketæœºåˆ¶ï¼Œtokenå¯é‡å¤ä½¿ç”¨

// åœºæ™¯2: æ”¯ä»˜å›è°ƒé‡æ”¾
// æ”»å‡»è€…æˆªè·æ”¯ä»˜å›è°ƒæŠ¥æ–‡ï¼Œé‡å¤å‘é€
POST /webhook/payment/callback
<xml>...</xml>

// é—®é¢˜: è™½æœ‰ç­¾åéªŒè¯ï¼Œä½†æ— æ—¶é—´æˆ³é˜²é‡æ”¾

// åœºæ™¯3: å‰ç«¯JSAPIè°ƒç”¨å¤±è´¥
// ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜ï¼Œå”¤èµ·å¾®ä¿¡æ”¯ä»˜åç‚¹å‡»å–æ¶ˆæˆ–ç½‘ç»œè¶…æ—¶
wx.chooseWXPay({
  success: function() { /* è½®è¯¢è®¢å•çŠ¶æ€ */ },
  fail: function() { /* ??? æ— è¡¥å¿é€»è¾‘ */ }
});
```

**å†³ç­–å»ºè®®**ï¼š

**å¢å¼ºæ–¹æ¡ˆï¼ˆåˆ†é˜¶æ®µå®æ–½ï¼‰**ï¼š

```yaml
é˜¶æ®µ1 - æ”¯ä»˜å›è°ƒå¢å¼ºï¼ˆP1ï¼Œå¿…é¡»ï¼‰:
  1. æ—¶é—´çª—å£éªŒè¯:
     if (System.currentTimeMillis() - notify.getTimestamp() > 5 * 60 * 1000) {
         return "FAIL"; // è¶…è¿‡5åˆ†é’Ÿçš„å›è°ƒæ‹’ç»
     }

  2. Rediså¹‚ç­‰æ€§æ£€æŸ¥:
     String key = "pay_callback:" + outTradeNo;
     Boolean acquired = redis.setIfAbsent(key, "1", 10, TimeUnit.MINUTES);

  3. æ•°æ®åº“å”¯ä¸€çº¦æŸ:
     ALTER TABLE payment_record
     ADD CONSTRAINT uk_order_no UNIQUE (order_no);

é˜¶æ®µ2 - å‰ç«¯ä¸€æ¬¡æ€§Ticketï¼ˆP1ï¼‰:
  è®¾è®¡:
    // åç«¯ç”Ÿæˆprepay_idåï¼ŒåŒæ—¶ç”Ÿæˆä¸€æ¬¡æ€§ticket
    POST /api/h5/payments
    Response:
    {
      "orderId": "ord_xxx",
      "prepayId": "wx2025...",
      "ticket": "tk_once_abc123",  // ä¸€æ¬¡æ€§ticketï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆï¼‰
      "sign": "..." // ç­¾å
    }

    // å‰ç«¯è½®è¯¢æ—¶å¿…é¡»æºå¸¦ticket
    GET /api/h5/orders/{orderNo}/status?ticket=tk_once_abc123

    // åç«¯æ ¡éªŒticket
    String ticket = request.getParameter("ticket");
    String cachedOrderNo = redis.get("ticket:" + ticket);
    if (cachedOrderNo == null || !cachedOrderNo.equals(orderNo)) {
        throw new InvalidTicketException();
    }
    // æŸ¥è¯¢åç«‹å³åˆ é™¤ticketï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰
    redis.delete("ticket:" + ticket);

é˜¶æ®µ3 - å‰ç«¯å¤±è´¥è¡¥å¿ï¼ˆP2ï¼‰:
  // æ”¯ä»˜å¤±è´¥/å–æ¶ˆåçš„è¡¥å¿é€»è¾‘
  wx.chooseWXPay({
    success: function(res) {
      // è½®è¯¢è®¢å•çŠ¶æ€
      pollOrderStatus();
    },
    fail: function(err) {
      if (err.errMsg === 'chooseWXPay:cancel') {
        // ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆï¼Œæ˜¾ç¤º"ç»§ç»­æ”¯ä»˜"æŒ‰é’®
        showResumePaymentButton();
      } else {
        // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ï¼Œä»ç„¶è½®è¯¢ï¼ˆå¯èƒ½å·²æ”¯ä»˜ï¼‰
        pollOrderStatus();
      }
    }
  });

  function showResumePaymentButton() {
    // è°ƒç”¨åç«¯é‡æ–°ç”Ÿæˆprepay_idï¼ˆåŸè®¢å•å·ä¸å˜ï¼‰
    POST /api/h5/payments/{orderNo}/resume
    // è¿”å›æ–°çš„prepay_idå’Œç­¾å
  }
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¡¥å……æ”¯ä»˜å®‰å…¨ç« èŠ‚
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­å¢åŠ  `POST /api/h5/payments/{orderNo}/resume` æ¥å£
- [ ] å‰ç«¯å¼€å‘è§„èŒƒä¸­å¢åŠ æ”¯ä»˜å¤±è´¥å¤„ç†æŒ‡å—
- [ ] ç¼–å†™æ”¯ä»˜å®‰å…¨æµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨¡æ‹Ÿé‡æ”¾æ”»å‡»ï¼‰

---

### P1-4ï¼šOAuth ç»‘å®šæ—¶åºæ˜ç¡®åŒ– ğŸ”—

**é—®é¢˜æè¿°**ï¼š
- OAuth å®Œæˆåå¦‚ä½•å†™å…¥ `user_planet_binding` è¡¨ï¼Œæµç¨‹ä¸æ˜ç¡®
- ä¸ P0-2 çš„ FastAuth æµç¨‹æ–­å±‚é—®é¢˜ç›¸å…³ï¼Œä½†ä¾§é‡å…·ä½“å®ç°æ—¶åº

**å†³ç­–å»ºè®®**ï¼š

**å®Œæ•´æ—¶åºå›¾ï¼ˆè¡¥å……åˆ°æŠ€æœ¯æ–¹æ¡ˆï¼‰**ï¼š

```mermaid
sequenceDiagram
    autonumber
    participant User as ç”¨æˆ·
    participant H5 as H5å‰ç«¯
    participant API as åç«¯API
    participant OAuth as FastAuth<br/>OAuth
    participant WXPay as å¾®ä¿¡æ”¯ä»˜
    participant Redis
    participant DB as PostgreSQL

    %% é˜¶æ®µ1: æ”¯ä»˜åˆ›å»º
    User->>H5: ç‚¹å‡»"ç«‹å³æŠ¥å"
    H5->>API: POST /api/h5/payments<br/>{campId, amount}
    API->>DB: INSERT payment_record<br/>status=WAIT_PAY
    API->>WXPay: åˆ›å»ºæ”¯ä»˜è®¢å•
    WXPay-->>API: è¿”å›prepay_id
    API->>Redis: ç”ŸæˆaccessToken<br/>SET tk_xxx â†’ {orderNo, campId}
    API-->>H5: {prepayId, accessToken, orderNo}
    H5->>User: å”¤èµ·å¾®ä¿¡æ”¯ä»˜

    %% é˜¶æ®µ2: æ”¯ä»˜å®Œæˆ
    User->>WXPay: å®Œæˆæ”¯ä»˜
    WXPay->>API: æ”¯ä»˜å›è°ƒ POST /webhook/payment
    API->>DB: UPDATE payment_record<br/>pay_status=SUCCESS<br/>bind_status=PENDING<br/>bind_deadline=NOW()+7å¤©
    API->>Redis: UPDATE accessToken<br/>status=activeï¼ˆå¯ç”¨äºç»‘å®šï¼‰
    API-->>WXPay: è¿”å›SUCCESS

    %% é˜¶æ®µ3: OAuthæˆæƒ
    WXPay-->>User: æ”¯ä»˜æˆåŠŸé¡µé¢
    User->>H5: è¿”å›H5é¡µé¢ï¼ˆæºå¸¦accessTokenï¼‰
    H5->>User: æç¤º"è¯·ç»‘å®šçŸ¥è¯†æ˜Ÿçƒè´¦å·"
    User->>H5: ç‚¹å‡»"ç«‹å³ç»‘å®š"
    H5->>API: GET /api/auth/authorize?<br/>returnUrl=.../bind&accessToken=tk_xxx
    API->>Redis: éªŒè¯accessTokenæœ‰æ•ˆæ€§
    API->>OAuth: é‡å®šå‘åˆ°FastAuthæˆæƒé¡µ
    User->>OAuth: åŒæ„æˆæƒ
    OAuth->>API: å›è°ƒ GET /api/auth/callback?<br/>code=xxx&state=yyy
    API->>OAuth: æ¢å–access_tokenå’Œopenid
    OAuth-->>API: {openid, unionid, ...}

    %% é˜¶æ®µ4: å†™å…¥wechat_userï¼ˆå…³é”®æ­¥éª¤ï¼‰
    API->>DB: INSERT INTO wechat_user<br/>(openid, unionid, ...)<br/>ON CONFLICT DO UPDATE

    %% é˜¶æ®µ5: å…³è”è®¢å•ä¸å¾®ä¿¡ç”¨æˆ·
    API->>Redis: GET tk_xxx â†’ {orderNo, campId}
    API->>DB: UPDATE payment_record<br/>SET wechat_user_id = ?<br/>WHERE order_no = ?

    %% é˜¶æ®µ6: é‡å®šå‘åˆ°ç»‘å®šé¡µé¢
    API-->>H5: é‡å®šå‘åˆ°returnUrl<br/>(æºå¸¦JWT token)

    %% é˜¶æ®µ7: ç»‘å®šæ˜Ÿçƒè´¦å·
    H5->>User: æ˜¾ç¤ºç»‘å®šè¡¨å•<br/>"è¯·è¾“å…¥çŸ¥è¯†æ˜Ÿçƒè´¦å·"
    User->>H5: å¡«å†™userNumber/å§“å
    H5->>API: POST /api/h5/orders/{orderNo}/planet-binding<br/>{userNumber, name}<br/>Authorization: Bearer <JWT>

    API->>DB: æŸ¥è¯¢planet_user<br/>WHERE user_number = ?
    alt æ˜Ÿçƒç”¨æˆ·å·²å­˜åœ¨
        DB-->>API: è¿”å›planet_userè®°å½•
    else ç”¨æˆ·ä¸å­˜åœ¨
        API->>DB: INSERT planet_user<br/>(æ¥æº: ç”¨æˆ·å¡«å†™)
    end

    %% é˜¶æ®µ8: å†™å…¥user_planet_bindingï¼ˆæ ¸å¿ƒï¼‰
    API->>DB: INSERT INTO user_planet_binding<br/>(wechat_user_id,<br/> planet_user_id,<br/> bind_method='h5_bindplanet',<br/> bind_source='user_fill')

    API->>DB: UPDATE payment_record<br/>SET bind_status='completed',<br/>    bound_at=NOW()

    API->>Redis: UPDATE accessToken<br/>status=boundï¼ˆå·²ç»‘å®šï¼‰

    API-->>H5: è¿”å›ç»‘å®šæˆåŠŸ
    H5->>User: æ˜¾ç¤º"ç»‘å®šæˆåŠŸï¼Œç­‰å¾…æ‰“å¡"
```

**å…³é”®è®¾è®¡å†³ç­–**ï¼š

1. **wechat_user è¡¨åœ¨ OAuth å›è°ƒæ—¶å†™å…¥**ï¼ˆæ­¥éª¤11ï¼‰
2. **user_planet_binding è¡¨åœ¨ç»‘å®šæ¥å£è°ƒç”¨æ—¶å†™å…¥**ï¼ˆæ­¥éª¤18ï¼‰
3. **payment_record é€šè¿‡ wechat_user_id å…³è”**ï¼ˆæ­¥éª¤13ï¼‰
4. **accessToken è´¯ç©¿æ•´ä¸ªæµç¨‹**ï¼Œç”¨äºï¼š
   - æ”¯ä»˜åæ ‡è¯†è®¢å•
   - OAuth æ—¶å…³è”åŸè®¢å•
   - ç»‘å®šæ—¶éªŒè¯æƒé™

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] å°†æ­¤æ—¶åºå›¾è¡¥å……åˆ° `docs/v1/æŠ€æœ¯æ–¹æ¡ˆ.md`
- [ ] åœ¨ `docs/v1/æ¥å£æ–‡æ¡£.md` çš„ OAuth ç« èŠ‚å¼•ç”¨æ­¤æ—¶åº
- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­æ˜ç¡®å„è¡¨çš„æ•°æ®æ¥æºï¼ˆå“ªä¸ªæ¥å£å†™å…¥ï¼‰

---

## ğŸŸ¡ ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¼˜åŒ–æœºä¼šï¼ˆå¼€å‘ä¸­è¿­ä»£ï¼‰

### P2-1ï¼šç›‘æ§æŒ‡æ ‡ç»†ç²’åº¦æå‡ ğŸ“ˆ

**é—®é¢˜æè¿°**ï¼š
- `docs/v1/å¼€å‘å‰å‡†å¤‡æ¸…å•.md:1244-1253` ä»…å®šä¹‰ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- ç¼ºå°‘ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ï¼Œæ— æ³•é‡åŒ– Stage éªŒæ”¶ç›®æ ‡

**å†³ç­–å»ºè®®**ï¼š

**åˆ†å±‚ç›‘æ§ä½“ç³»**ï¼š

```yaml
Layer 1 - ç³»ç»ŸæŒ‡æ ‡ï¼ˆå·²æœ‰ï¼‰:
  - CPUä½¿ç”¨ç‡ > 80%
  - å†…å­˜ä½¿ç”¨ç‡ > 85%
  - ç£ç›˜ä½¿ç”¨ç‡ > 90%
  - ç½‘ç»œå¼‚å¸¸

Layer 2 - åŸºç¡€è®¾æ–½æŒ‡æ ‡ï¼ˆæ–°å¢ï¼‰:
  PostgreSQL:
    - æ…¢æŸ¥è¯¢æ•°é‡ï¼ˆ>500msï¼‰
    - è¿æ¥æ± ä½¿ç”¨ç‡ > 80%
    - æ­»é”æ¬¡æ•°

  Redis:
    - ç¼“å­˜å‘½ä¸­ç‡ < 90%
    - Keyé©±é€ç‡
    - å†…å­˜ç¢ç‰‡ç‡

Layer 3 - åº”ç”¨æŒ‡æ ‡ï¼ˆæ–°å¢ï¼‰:
  æ¥å£æ€§èƒ½:
    - P99å“åº”æ—¶é—´ > 2s
    - æ¥å£é”™è¯¯ç‡ > 1%
    - QPSçªå¢ï¼ˆ5åˆ†é’Ÿå†…ç¿»å€ï¼‰

  å¼‚æ­¥ä»»åŠ¡:
    - ä»»åŠ¡é˜Ÿåˆ—ç§¯å‹ > 100
    - ä»»åŠ¡å¤±è´¥ç‡ > 5%

Layer 4 - ä¸šåŠ¡æŒ‡æ ‡ï¼ˆé‡ç‚¹æ–°å¢ï¼‰:
  æ”¯ä»˜æµç¨‹:
    - æ”¯ä»˜æˆåŠŸç‡ï¼ˆç›®æ ‡ >95%ï¼‰
      = æˆåŠŸæ”¯ä»˜æ•° / å‘èµ·æ”¯ä»˜æ•°
    - æ”¯ä»˜å›è°ƒå»¶è¿Ÿï¼ˆP95 < 3sï¼‰
    - è®¢å•ç»‘å®šå®Œæˆç‡ï¼ˆç›®æ ‡ >85%ï¼‰
      = bind_status=completed / æ€»è®¢å•æ•°ï¼ˆ7å¤©å†…ï¼‰

  èº«ä»½åŒ¹é…:
    - è‡ªåŠ¨åŒ¹é…æˆåŠŸç‡ï¼ˆç›®æ ‡ >80%ï¼‰
      = bind_method IN ('h5_bindplanet','user_fill') / æ€»è®¢å•
    - äººå·¥å®¡æ ¸å æ¯”ï¼ˆç›®æ ‡ <15%ï¼‰
      = bind_status='manual_review' / æ€»è®¢å•

  æ‰“å¡åŒæ­¥:
    - æ‰“å¡æ•°æ®åŒæ­¥å»¶è¿Ÿï¼ˆç›®æ ‡ <10åˆ†é’Ÿï¼‰
      = NOW() - MAX(checkin_record.synced_at)
    - åŒæ­¥å¤±è´¥ç‡ï¼ˆç›®æ ‡ <1%ï¼‰
      = å¤±è´¥æ¬¡æ•° / æ€»åŒæ­¥ä»»åŠ¡æ•°

  é€€æ¬¾å¤„ç†:
    - é€€æ¬¾æ‰§è¡Œå¹³å‡è€—æ—¶ï¼ˆç›®æ ‡ <30åˆ†é’Ÿï¼‰
      = AVG(refund_record.processed_at - created_at)
    - é€€æ¬¾æˆåŠŸç‡ï¼ˆç›®æ ‡ >99%ï¼‰
      = refund_status='SUCCESS' / æ€»é€€æ¬¾æ•°

Layer 5 - ç”¨æˆ·ä½“éªŒæŒ‡æ ‡:
  - H5é¡µé¢åŠ è½½æ—¶é—´ï¼ˆP95 < 2sï¼‰
  - æ”¯ä»˜è·³è½¬æˆåŠŸç‡ï¼ˆ>98%ï¼‰
  - é¡µé¢é”™è¯¯ç‡ï¼ˆJS Error < 0.1%ï¼‰
```

**å‘Šè­¦ç­–ç•¥**ï¼š

```yaml
å‘Šè­¦çº§åˆ«:
  P0 - ç´§æ€¥ï¼ˆç«‹å³å¤„ç†ï¼‰:
    - æ”¯ä»˜å›è°ƒå¤±è´¥ç‡ >10%ï¼ˆå½±å“èµ„é‡‘ï¼‰
    - æ•°æ®åº“è¿æ¥æ± è€—å°½
    - æœåŠ¡ä¸å¯ç”¨ï¼ˆ>1åˆ†é’Ÿï¼‰
    é€šçŸ¥: ç”µè¯ + ä¼ä¸šå¾®ä¿¡ + çŸ­ä¿¡

  P1 - ä¸¥é‡ï¼ˆ15åˆ†é’Ÿå†…å¤„ç†ï¼‰:
    - æ”¯ä»˜æˆåŠŸç‡ <90%
    - é€€æ¬¾æˆåŠŸç‡ <95%
    - æ¥å£P99å“åº”æ—¶é—´ >5s
    é€šçŸ¥: ä¼ä¸šå¾®ä¿¡ + é‚®ä»¶

  P2 - è­¦å‘Šï¼ˆ1å°æ—¶å†…å¤„ç†ï¼‰:
    - æ‰“å¡åŒæ­¥å»¶è¿Ÿ >30åˆ†é’Ÿ
    - ç¼“å­˜å‘½ä¸­ç‡ <80%
    - æ…¢æŸ¥è¯¢æ•°é‡ >50/å°æ—¶
    é€šçŸ¥: ä¼ä¸šå¾®ä¿¡

  P3 - ä¿¡æ¯ï¼ˆå·¥ä½œæ—¶é—´å¤„ç†ï¼‰:
    - äººå·¥å®¡æ ¸è®¢å•ç§¯å‹ >10
    - ç£ç›˜ä½¿ç”¨ç‡ >70%
    é€šçŸ¥: é‚®ä»¶
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åœ¨ `å¼€å‘å‰å‡†å¤‡æ¸…å•.md` ä¸­è¡¥å…… Layer 3-5 ç›‘æ§æŒ‡æ ‡
- [ ] åœ¨å„ Stage éªŒæ”¶æ ‡å‡†ä¸­å¼•ç”¨å¯¹åº”æŒ‡æ ‡
- [ ] å®ç° Prometheus è‡ªå®šä¹‰ Metrics
- [ ] é…ç½® Grafana ä»ªè¡¨ç›˜æ¨¡æ¿

---

### P2-2ï¼šDocker æœ¬åœ°å¼€å‘ç¯å¢ƒ ğŸ³

**é—®é¢˜æè¿°**ï¼š
- å¼€å‘å‰å‡†å¤‡æ¸…å•.md è¦æ±‚æ‰‹åŠ¨å®‰è£… PostgreSQL, Redis, é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸Šæ‰‹æˆæœ¬é«˜

**å†³ç­–å»ºè®®**ï¼š

**Docker Composeä¸€é”®å¯åŠ¨**ï¼š

```yaml
# docker-compose.yml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: camp_db
      POSTGRES_USER: camp_user
      POSTGRES_PASSWORD: dev_password
    ports:
      - "5432:5432"
    volumes:
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --requirepass dev_password

  adminer:
    image: adminer
    ports:
      - "8081:8080"  # æ•°æ®åº“ç®¡ç†ç•Œé¢

volumes:
  postgres_data:
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# æ–°äººå…¥èŒç¬¬ä¸€å¤©
git clone <repo>
cd backend
docker-compose up -d          # å¯åŠ¨ä¾èµ–æœåŠ¡
./gradlew bootRun             # å¯åŠ¨åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€ http://localhost:8080/doc.html æŸ¥çœ‹APIæ–‡æ¡£
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åˆ›å»º `docker-compose.yml` æ–‡ä»¶
- [ ] ç¼–å†™æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ `scripts/init.sql`
- [ ] æ›´æ–° README.md çš„å¿«é€Ÿå¯åŠ¨æŒ‡å—
- [ ] æ·»åŠ  `.env.example` ç¯å¢ƒå˜é‡æ¨¡æ¿



---

### P2-4ï¼šAPI RESTful è§„èŒƒåŒ– ğŸŒ

**é—®é¢˜æè¿°**ï¼š
- å½“å‰æ¥å£è®¾è®¡å­˜åœ¨ä¸ç¬¦åˆ RESTful æœ€ä½³å®è·µçš„æƒ…å†µ

**å†³ç­–å»ºè®®**ï¼š

**ä¸ç¬¦åˆRESTæœ€ä½³å®è·µçš„endpoint**ï¼š

| å½“å‰è®¾è®¡ | é—®é¢˜ | å»ºè®®æ”¹è¿› | HTTPæ–¹æ³• |
|---------|------|----------|---------|
| `/api/admin/camp/list` | åŠ¨è¯å‡ºç°åœ¨URL | `/api/admin/camps?page=1&size=20` | GET |
| `/api/admin/camp/create` | åŠ¨è¯createå†—ä½™ | `/api/admin/camps` | POST |
| `/api/admin/refund/approve` | åŠ¨ä½œå‹endpoint | `/api/admin/refunds/{id}/approval` | PUT |
| `/api/h5/order/bindPlanet` | é©¼å³°å‘½å | `/api/h5/orders/{orderNo}/planet-binding` | POST |
| `/api/h5/order/progress` | è¯­ä¹‰ä¸æ˜ | `/api/h5/orders/{orderNo}/refund-status` | GET |

**ç»Ÿä¸€å‘½åè§„èŒƒå»ºè®®**ï¼š
```yaml
èµ„æºå‘½å:
  - å¤æ•°åè¯: /camps, /members, /payments
  - å°å†™ + è¿å­—ç¬¦: /planet-binding (ä¸ç”¨é©¼å³°)
  - é¿å…åŠ¨è¯: ç”¨HTTPæ–¹æ³•è¡¨è¾¾åŠ¨ä½œ

å­èµ„æºåµŒå¥—:
  - å±‚çº§ â‰¤ 3: /camps/{id}/members/{memberId}/checkins âœ…
  - é¿å…è¿‡æ·±: /api/v1/admin/system/camps/... âŒ

æŸ¥è¯¢å‚æ•°:
  - åˆ†é¡µ: ?page=1&size=20&sort=createdAt,desc
  - è¿‡æ»¤: ?status=ONGOING&depositAmount=99
  - æœç´¢: ?q=21å¤©æ—©èµ·
```

**APIç‰ˆæœ¬æ§åˆ¶ç­–ç•¥**ï¼š
```yaml
å½“å‰: /api/admin/camp/detail/{id}
ä¼˜åŒ–: /api/v1/admin/camps/{id}

ä¼˜åŠ¿:
  âœ… å®¢æˆ·ç«¯æ˜ç¡®çŸ¥é“ä½¿ç”¨çš„APIç‰ˆæœ¬
  âœ… æ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜ï¼ˆv1, v2åŒæ—¶ç»´æŠ¤ï¼‰
  âœ… å‘åå…¼å®¹æ—¶å¯å¹³æ»‘å‡çº§
```

**é”™è¯¯å“åº”æ ‡å‡†åŒ–**ï¼ˆå‚è€ƒRFC 7807ï¼‰ï¼š
```json
{
  "type": "/errors/validation-failed",
  "title": "å‚æ•°æ ¡éªŒå¤±è´¥",
  "status": 400,
  "detail": "è®­ç»ƒè¥æŠ¼é‡‘é‡‘é¢å¿…é¡»åœ¨1-999ä¹‹é—´",
  "instance": "/api/v1/admin/camps",
  "errors": [
    {
      "field": "depositAmount",
      "message": "é‡‘é¢è¶…å‡ºå…è®¸èŒƒå›´",
      "rejectedValue": 1000
    }
  ],
  "traceId": "a1b2c3d4-5678-90ab-cdef"
}
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] åˆ¶å®šã€ŠAPIè®¾è®¡è§„èŒƒæ–‡æ¡£ã€‹
- [ ] å‰åç«¯è”åˆè¯„å®¡ç¡®è®¤è§„èŒƒ
- [ ] åœ¨ Stage 0 å®Œæˆè§„èŒƒåˆ¶å®š
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ ‡æ³¨ç‰ˆæœ¬å·

---

### P2-5ï¼šæµ‹è¯•æ•°æ®ç”Ÿæˆå·¥å…· ğŸ§ª

**é—®é¢˜æè¿°**ï¼š
- ç¼ºå°‘æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬ï¼Œå¼€å‘è°ƒè¯•éœ€æ‰‹åŠ¨åˆ›å»ºè®­ç»ƒè¥ã€ä¼šå‘˜ã€æ”¯ä»˜è®°å½•

**å†³ç­–å»ºè®®**ï¼š

**ä½¿ç”¨ JavaFaker + TestDataFactory**ï¼š

```java
// src/test/java/com/example/camp/TestDataFactory.java
@Component
public class TestDataFactory {

    @Autowired
    private CampMapper campMapper;

    private final Faker faker = new Faker(Locale.CHINA);

    public Camp createCamp(String name) {
        Camp camp = Camp.builder()
            .name(name != null ? name : faker.company().name() + "è®­ç»ƒè¥")
            .depositAmount(new BigDecimal(faker.number().numberBetween(50, 200)))
            .requiredDays(faker.number().numberBetween(10, 20))
            .totalDays(21)
            .startDate(LocalDate.now().plusDays(7))
            .endDate(LocalDate.now().plusDays(28))
            .status(CampStatus.DRAFT)
            .build();

        campMapper.insert(camp);
        return camp;
    }

    public PaymentRecord createPayment(Long campId, BindStatus bindStatus) {
        PaymentRecord payment = PaymentRecord.builder()
            .orderNo("ord_" + UUID.randomUUID().toString())
            .campId(campId)
            .amount(new BigDecimal("99.00"))
            .payStatus(PayStatus.SUCCESS)
            .bindStatus(bindStatus)
            .build();

        paymentMapper.insert(payment);
        return payment;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@SpringBootTest
class MemberServiceTest {
    @Autowired
    private TestDataFactory testData;

    @Test
    void testSyncMembers() {
        Camp camp = testData.createCamp("æµ‹è¯•è®­ç»ƒè¥");
        PaymentRecord payment = testData.createPayment(camp.getId(), BindStatus.COMPLETED);
        // å¼€å§‹æµ‹è¯•...
    }
}
```

**æœ¬åœ°å¼€å‘ç¯å¢ƒåˆå§‹åŒ–**ï¼š
```bash
# scripts/seed-dev-data.sh
#!/bin/bash
curl -X POST http://localhost:8080/api/dev/seed \
  -H "Content-Type: application/json" \
  -d '{
    "camps": 5,
    "membersPerCamp": 10,
    "paymentsPerCamp": 8
  }'
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] å¼•å…¥ JavaFaker ä¾èµ–
- [ ] å®ç° TestDataFactory
- [ ] ç¼–å†™å¼€å‘ç¯å¢ƒæ•°æ®åˆå§‹åŒ–è„šæœ¬
- [ ] åœ¨æµ‹è¯•æ–‡æ¡£ä¸­è¯´æ˜å¦‚ä½•ä½¿ç”¨

---

## ğŸŸ¢ ç¬¬å››éƒ¨åˆ†ï¼šæ”¹è¿›å»ºè®®ï¼ˆåç»­ç‰ˆæœ¬ï¼‰

### P3-1ï¼šæ–‡æ¡£é‡å¤é—®é¢˜ ğŸ“š

**é—®é¢˜æè¿°**ï¼š
- Stage è¯´æ˜åœ¨ `AIè¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’.md`ã€`æŠ€æœ¯æ–¹æ¡ˆ.md`ã€`å¼€å‘å‰å‡†å¤‡æ¸…å•.md` å‡æœ‰é‡å¤
- ä¿®æ”¹ä¸€å¤„éœ€åŒæ­¥æ›´æ–°å¤šå¤„ï¼Œç»´æŠ¤æˆæœ¬é«˜

**å†³ç­–å»ºè®®**ï¼š

**æ–¹æ¡ˆAï¼ˆæ¨èï¼‰ï¼šå•ä¸€æ•°æ®æºï¼ˆSSOTï¼‰**
```yaml
ç­–ç•¥:
  1. æƒå¨æ¥æº: docs/v1/æŠ€æœ¯æ–¹æ¡ˆ.md
     - ä¿ç•™å®Œæ•´çš„Stageå®šä¹‰ï¼ˆç›®æ ‡ã€äº¤ä»˜ç‰©ã€éªŒæ”¶æ ‡å‡†ï¼‰

  2. å…¶ä»–æ–‡æ¡£: å¼•ç”¨ + ç®€åŒ–æ‘˜è¦
     - docs/v1/AIè¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’.md:
       ## Stage 1
       > è¯¦ç»†å†…å®¹è§ [æŠ€æœ¯æ–¹æ¡ˆ.md - Stage 1](./æŠ€æœ¯æ–¹æ¡ˆ.md#stage-1)

       å¿«é€Ÿå‚è€ƒ:
       - ç›®æ ‡: æ”¯ä»˜é—­ç¯
       - äº¤ä»˜: H5æ”¯ä»˜é¡µé¢ + åç«¯API
       - æ—¶é—´: 2å‘¨

     - docs/v1/å¼€å‘å‰å‡†å¤‡æ¸…å•.md:
       ä»…ä¿ç•™ç¯å¢ƒé…ç½®æ¸…å•ï¼Œåˆ é™¤Stageæè¿°

  3. ç»´æŠ¤æµç¨‹:
     - Stageè°ƒæ•´: ä»…ä¿®æ”¹æŠ€æœ¯æ–¹æ¡ˆ.md
     - å…¶ä»–æ–‡æ¡£: é€šè¿‡è„šæœ¬æˆ–æ‰‹åŠ¨åŒæ­¥æ‘˜è¦éƒ¨åˆ†
```

**è¡ŒåŠ¨é¡¹**ï¼š
- [ ] æŒ‡å®š `æŠ€æœ¯æ–¹æ¡ˆ.md` ä¸ºæƒå¨æ¥æº
- [ ] ç²¾ç®€å…¶ä»–æ–‡æ¡£ï¼Œæ”¹ä¸ºå¼•ç”¨é“¾æ¥
- [ ] åœ¨ `README.md` ä¸­è¯´æ˜æ–‡æ¡£ç»´æŠ¤è§„èŒƒ
- [ ] åˆ¶å®šæ–‡æ¡£æ›´æ–°æ£€æŸ¥æ¸…å•

---

### P3-2ï¼šæ•°æ®åº“ä¼˜åŒ–å»ºè®® ğŸ’¾

**ç´¢å¼•ç­–ç•¥è¡¥å……**ï¼š
```sql
-- 1. æ”¯ä»˜è®°å½•æŒ‰çŠ¶æ€å’Œæ—¶é—´æŸ¥è¯¢ï¼ˆç®¡ç†åå°åˆ—è¡¨é¡µé«˜é¢‘æŸ¥è¯¢ï¼‰
CREATE INDEX idx_payment_status_time
ON payment_record(pay_status, created_at DESC)
WHERE pay_status IN ('SUCCESS', 'PENDING');

-- 2. æ‰“å¡è®°å½•æŒ‰è®­ç»ƒè¥å’Œæ—¥æœŸæŸ¥è¯¢ï¼ˆåŒæ­¥ä»»åŠ¡é«˜é¢‘ï¼‰
CREATE INDEX idx_checkin_camp_date
ON checkin_record(camp_id, checkin_date DESC);

-- 3. é€€æ¬¾è®°å½•æŒ‰å®¡æ‰¹çŠ¶æ€æŸ¥è¯¢ï¼ˆç®¡ç†å‘˜å·¥ä½œå°ï¼‰
CREATE INDEX idx_refund_approval_status
ON refund_record(approval_status, created_at DESC)
WHERE approval_status = 'PENDING';

-- 4. éƒ¨åˆ†ç´¢å¼•ä¼˜åŒ– - ä»…ç´¢å¼•æ´»è·ƒçŠ¶æ€çš„è®­ç»ƒè¥
CREATE INDEX idx_camp_active
ON training_camp(status, start_date)
WHERE status IN ('ENROLLING', 'ONGOING');
```

**JSONB ä½¿ç”¨åœºæ™¯æ˜ç¡®**ï¼š
```yaml
å»ºè®®ä½¿ç”¨JSONBçš„å­—æ®µ:
  - payment_record.api_response: å¾®ä¿¡æ”¯ä»˜å›è°ƒåŸå§‹JSON
  - refund_record.api_response: é€€æ¬¾æ¥å£è¿”å›çš„å®Œæ•´å“åº”
  - checkin_record.topic_content: çŸ¥è¯†æ˜Ÿçƒæ‰“å¡å†…å®¹ï¼ˆå¯Œæ–‡æœ¬/å›¾ç‰‡æ•°ç»„ï¼‰
  - camp_config.rules: è®­ç»ƒè¥è‡ªå®šä¹‰è§„åˆ™ï¼ˆåŠ¨æ€é…ç½®ï¼‰

ä¸åº”ä½¿ç”¨JSONBçš„åœºæ™¯:
  âŒ ç»å¸¸æŸ¥è¯¢çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ç”¨æˆ·æ‰‹æœºå·ã€å§“åï¼‰
  âŒ éœ€è¦å»ºç´¢å¼•çš„å­—æ®µ
  âŒ éœ€è¦å¤–é”®å…³è”çš„å­—æ®µ
```

**è½¯åˆ é™¤ç­–ç•¥ç»Ÿä¸€**ï¼š
```sql
-- éœ€è¦è½¯åˆ é™¤çš„è¡¨ï¼ˆç”¨æˆ·å¯è§æ•°æ®ï¼‰:
ALTER TABLE training_camp ADD COLUMN deleted_at TIMESTAMP;
ALTER TABLE camp_member ADD COLUMN deleted_at TIMESTAMP;

-- ä¸éœ€è¦è½¯åˆ é™¤çš„è¡¨ï¼ˆç³»ç»Ÿæ—¥å¿—/æµæ°´è¡¨ï¼‰:
-- payment_record, refund_record, checkin_record
-- ç†ç”±: è´¢åŠ¡/å®¡è®¡æ•°æ®ä¸å…è®¸åˆ é™¤ï¼Œä»…å½’æ¡£
```

---

### P3-3ï¼šå®‰å…¨å¢å¼ºå»ºè®® ğŸ”’

**OAuth PKCE å¢å¼º**ï¼š
```java
// PKCE (Proof Key for Code Exchange) - é˜²æ­¢æˆæƒç æ‹¦æˆª
@GetMapping("/oauth/authorize")
public String authorize(HttpSession session) {
    // ç”Ÿæˆcode_verifier (éšæœºå­—ç¬¦ä¸²)
    String codeVerifier = generateCodeVerifier();
    String codeChallenge = sha256(codeVerifier); // S256ç®—æ³•

    session.setAttribute("code_verifier", codeVerifier);

    String authUrl = String.format(
        "https://open.weixin.qq.com/...?code_challenge=%s&code_challenge_method=S256",
        codeChallenge
    );
    return "redirect:" + authUrl;
}
```

**æ—¥å¿—è„±æ•**ï¼š
```java
@Slf4j
public class PaymentServiceImpl {
    public void createPayment(PaymentRequest req) {
        log.info("åˆ›å»ºæ”¯ä»˜è®¢å•: phone={}, amount={}",
            maskPhone(req.getPhone()),  // 138****8000
            req.getAmount()
        );
    }

    private String maskPhone(String phone) {
        return phone.replaceAll("(\\d{3})\\d{4}(\\d{4})", "$1****$2");
    }
}
```

---

### P3-4ï¼šå¼€å‘ä½“éªŒä¼˜åŒ– ğŸ› ï¸

**Git Hooks è§„èŒƒåŒ–**ï¼š
```bash
# .husky/pre-commit
#!/bin/sh
./gradlew spotlessCheck      # ä»£ç æ ¼å¼æ£€æŸ¥
./gradlew test --parallel    # å¹¶è¡Œè¿è¡Œæµ‹è¯•

# .husky/commit-msg
#!/bin/sh
commit_msg=$(cat $1)
pattern="^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,100}"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo "âŒ Commit messageæ ¼å¼é”™è¯¯"
  echo "æ ¼å¼: <type>(<scope>): <subject>"
  echo "ç¤ºä¾‹: feat(camp): æ–°å¢è®­ç»ƒè¥å½’æ¡£åŠŸèƒ½"
  exit 1
fi
```

**Knife4j é…ç½®ä¼˜åŒ–**ï¼š
```java
@Configuration
public class Knife4jConfig {
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
            .info(new Info()
                .title("è®­ç»ƒè¥æŠ¼é‡‘é€€æ¬¾ç³»ç»Ÿ API")
                .version("v1.0")
                .description("""
                    ## è®¤è¯è¯´æ˜
                    - Adminç«¯: JWTï¼ŒHeader: `Authorization: Bearer <token>`
                    - H5ç«¯: OAuthååŒæ ·ä½¿ç”¨Beareræ–¹å¼

                    ## ç¯å¢ƒåœ°å€
                    - å¼€å‘: https://dev-api.example.com
                    - æµ‹è¯•: https://test-api.example.com
                    """))
            .addServersItem(new Server()
                .url("http://localhost:8080")
                .description("æœ¬åœ°å¼€å‘"));
    }
}
```

---

### P3-5ï¼šæµ‹è¯•ç­–ç•¥ä¼˜åŒ– ğŸ§ª

**æµ‹è¯•é‡‘å­—å¡”**ï¼š
```
        E2E (5%)            <-- å…³é”®ä¸šåŠ¡æµç¨‹
       /        \
      /          \
  é›†æˆæµ‹è¯• (15%)      <-- API + DB + Redis
    /              \
   /                \
å•å…ƒæµ‹è¯• (80%)          <-- Service + Util

ç›®æ ‡è¦†ç›–ç‡:
  - å•å…ƒæµ‹è¯•: 85% (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘100%)
  - é›†æˆæµ‹è¯•: è¦†ç›–æ‰€æœ‰Controller endpoint
  - E2Eæµ‹è¯•: æ”¯ä»˜â†’æ‰“å¡â†’é€€æ¬¾ å®Œæ•´é“¾è·¯
```

**WireMock é›†æˆæµ‹è¯•**ï¼š
```java
@SpringBootTest
@AutoConfigureWireMock(port = 8089)
class PlanetApiIntegrationTest {

    @Test
    void shouldSyncMembers() {
        // æ¨¡æ‹ŸçŸ¥è¯†æ˜ŸçƒAPIå“åº”
        stubFor(get(urlEqualTo("/v2/groups/12345/members"))
            .willReturn(aResponse()
                .withStatus(200)
                .withBody("""
                    {
                      "succeeded": true,
                      "data": [
                        {"user_id": "123", "name": "æµ‹è¯•ç”¨æˆ·"}
                      ]
                    }
                    """)));

        memberService.syncMembers(campId);

        List<Member> members = memberMapper.selectByCampId(campId);
        assertThat(members).hasSize(1);
    }
}
```

---

### P3-6ï¼šå¯è§‚æµ‹æ€§å¢å¼º ğŸ“Š

**OpenTelemetry é›†æˆ**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
  tracing:
    sampling:
      probability: 0.1  # ç”Ÿäº§ç¯å¢ƒé‡‡æ ·10%
```

**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š
```java
@Service
public class PaymentServiceImpl {
    private final Counter paymentCounter =
        Metrics.counter("payment.created", "status", "success");
    private final Timer paymentTimer =
        Metrics.timer("payment.processing.duration");

    public Payment createPayment(PaymentRequest req) {
        return paymentTimer.record(() -> {
            Payment payment = doCreatePayment(req);
            paymentCounter.increment();
            return payment;
        });
    }
}
```

---

## ğŸ“‹ ç»¼åˆå†³ç­–çŸ©é˜µ

### æŒ‰ä¼˜å…ˆçº§æ’åºçš„è¡ŒåŠ¨æ¸…å•

| ç¼–å· | ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | å½±å“é¢ | å»ºè®®å®Œæˆæ—¶é—´ | è´Ÿè´£äºº |
|------|--------|--------|--------|--------|------------|--------|
| 1 | EP02æ–‡æ¡£è¡¥å…… | ğŸ”´ P0 | 4h | å…¨æµç¨‹ | Stage 0 å‰ | äº§å“+åç«¯ |
| 2 | bind_statusç»Ÿä¸€ | ğŸ”´ P0 | 2h | æ¥å£+å‰ç«¯ | Stage 0 å‰ | åç«¯è´Ÿè´£äºº |
| 3 | FastAuthæ—¶åºæ˜ç¡® | ğŸ”´ P0 | 4h | OAuthæµç¨‹ | Stage 0 å‰ | æ¶æ„å¸ˆ |
| 4 | é˜¶æ®µè§„åˆ’è°ƒæ•´ | ğŸŸ  P1 | 4h | å¼€å‘èŠ‚å¥ | Stage 0 ä¸­ | æŠ€æœ¯è´Ÿè´£äºº |
| 5 | æ”¯ä»˜å®‰å…¨å¢å¼º | ğŸŸ  P1 | 8h | æ”¯ä»˜è·¯å¾„ | Stage 1 å‰ | åç«¯+å®‰å…¨ |
| 6 | OAuthç»‘å®šæ—¶åºå›¾ | ğŸŸ  P1 | 2h | æŠ€æœ¯æ–¹æ¡ˆ | Stage 0 ä¸­ | æ¶æ„å¸ˆ |
| 7 | æ¥å£DBè€¦åˆä¼˜åŒ– | ğŸŸ  P1 | 16h | æ€§èƒ½ | Stage 1 ä¸­ | åç«¯+DBA |
| 8 | Dockerå¼€å‘ç¯å¢ƒ | ğŸŸ¡ P2 | 4h | å¼€å‘ä½“éªŒ | Stage 0 å‰ | è¿ç»´+åç«¯ |
| 9 | ç›‘æ§æŒ‡æ ‡ç»†åŒ– | ğŸŸ¡ P2 | 6h | è¿ç»´è´¨é‡ | Stage 1 å‰ | è¿ç»´+åç«¯ |
| 10 | APIå‘½åè§„èŒƒ | ğŸŸ¡ P2 | 8h | å‰åç«¯å¯¹æ¥ | Stage 0 ä¸­ | å…¨å‘˜è¯„å®¡ |
| 11 | Managerå±‚è¯„ä¼° | ğŸŸ¡ P2 | 4h | æ¶æ„ | Stage 0 ä¸­ | æ¶æ„å¸ˆ |
| 12 | æµ‹è¯•æ•°æ®å·¥å…· | ğŸŸ¡ P2 | 6h | æµ‹è¯•æ•ˆç‡ | Stage 1 ä¸­ | æµ‹è¯•+åç«¯ |
| 13 | æ–‡æ¡£é‡å¤æ¸…ç† | ğŸŸ¢ P3 | 2h | ç»´æŠ¤æ•ˆç‡ | Stage 1 å | æŠ€æœ¯æ–‡æ¡£ |
| 14 | Git Hooksé…ç½® | ğŸŸ¢ P3 | 2h | ä»£ç è´¨é‡ | Stage 1 å‰ | åç«¯è´Ÿè´£äºº |
| 15 | Knife4jä¼˜åŒ– | ğŸŸ¢ P3 | 2h | APIæ–‡æ¡£ | Stage 1 ä¸­ | åç«¯ |

### æ—¶é—´çº¿è§„åˆ’

```
Week 1 (Stage 0 å‡†å¤‡é˜¶æ®µ):
  â”œâ”€ Day 1-2: #1 EP02æ–‡æ¡£ + #2 çŠ¶æ€ç»Ÿä¸€ + #3 FastAuthæ—¶åº
  â”œâ”€ Day 3: #4 é˜¶æ®µè§„åˆ’è°ƒæ•´è¯„å®¡ä¼š
  â”œâ”€ Day 4: #8 Dockerç¯å¢ƒ + #10 APIè§„èŒƒè¯„å®¡
  â””â”€ Day 5: #11 Managerå±‚è¯„ä¼° + #14 Git Hooks

Week 2-3 (Stage 1 æ”¯ä»˜é—­ç¯):
  â”œâ”€ å®æ–½: #5 æ”¯ä»˜å®‰å…¨å¢å¼ºï¼ˆå¹¶è¡Œå¼€å‘ä¸­ï¼‰
  â”œâ”€ å®æ–½: #6 OAuthæ—¶åºå›¾è½åœ°
  â”œâ”€ å®æ–½: #9 ç›‘æ§æŒ‡æ ‡åŸ‹ç‚¹
  â””â”€ è¯„ä¼°: #7 æ¥å£DBè€¦åˆä¼˜åŒ–æ–¹æ¡ˆ

Week 4+ (Stage 2 åŠåç»­):
  â”œâ”€ å®æ–½: #7 Redisç¼“å­˜å±‚ï¼ˆå¦‚æœæ€§èƒ½ç“¶é¢ˆå‡ºç°ï¼‰
  â”œâ”€ å®æ–½: #12 æµ‹è¯•æ•°æ®å·¥å…·
  â”œâ”€ å®æ–½: #15 Knife4jä¼˜åŒ–
  â””â”€ ä¼˜åŒ–: #13 æ–‡æ¡£é‡å¤æ¸…ç†
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**ç”Ÿæˆæ—¶é—´**ï¼š2025-12-04
**æœ‰æ•ˆæœŸ**ï¼š6ä¸ªæœˆï¼ˆéœ€æ ¹æ®å®é™…å¼€å‘åé¦ˆè°ƒæ•´ï¼‰
**ç»´æŠ¤è€…**ï¼šæŠ€æœ¯æ¶æ„ç»„
**è”ç³»æ–¹å¼**ï¼šå¦‚éœ€è®¨è®ºå…·ä½“å®æ–½ç»†èŠ‚ï¼Œè¯·å‚è€ƒå„ç« èŠ‚ä»£ç ç¤ºä¾‹æˆ–å‘èµ·æŠ€æœ¯è¯„å®¡ä¼š
