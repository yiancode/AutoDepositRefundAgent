#!/bin/bash

# v1 è®¾è®¡ä¼˜åŒ– GitHub Issues åˆ›å»ºè„šæœ¬
# ä½¿ç”¨å‰è¯·ç¡®ä¿å·²å®‰è£…å¹¶ç™»å½• gh CLIï¼š
#   brew install gh
#   gh auth login

set -e

echo "ğŸš€ å¼€å§‹åˆ›å»º v1 è®¾è®¡ä¼˜åŒ– GitHub Issues..."
echo ""

# æ£€æŸ¥ gh CLI æ˜¯å¦å·²å®‰è£…å’Œç™»å½•
if ! command -v gh &> /dev/null; then
    echo "âŒ é”™è¯¯: gh CLI æœªå®‰è£…"
    echo "è¯·è¿è¡Œ: brew install gh"
    exit 1
fi

if ! gh auth status &> /dev/null; then
    echo "âŒ é”™è¯¯: gh CLI æœªç™»å½•"
    echo "è¯·è¿è¡Œ: gh auth login"
    exit 1
fi

echo "âœ… gh CLI æ£€æŸ¥é€šè¿‡"
echo ""

# ============================================
# ğŸ”´ P0 - é˜»å¡æ€§é—®é¢˜ (å¿…é¡»åœ¨ Stage 0 å‰å®Œæˆ)
# ============================================

echo "ğŸ“‹ åˆ›å»º P0 é˜»å¡æ€§é—®é¢˜..."

# P0-1: EP02 ç”¨æˆ·æ•…äº‹æ–‡æ¡£ç¼ºå¤±
gh issue create \
  --title "[P0] è¡¥å…… EP02-ä¼šå‘˜æŠ¥åä¸æ”¯ä»˜ ç”¨æˆ·æ•…äº‹æ–‡æ¡£" \
  --label "P0-é˜»å¡,documentation,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

\`docs/v1/user-stories/EP02-ä¼šå‘˜æŠ¥åä¸æ”¯ä»˜.md\` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯¼è‡´æ ¸å¿ƒæ”¯ä»˜æµç¨‹ç¼ºå°‘ Gherkin éªŒæ”¶æ ‡å‡†ã€‚

## å½±å“èŒƒå›´

- ğŸ¯ ä¸šåŠ¡æµç¨‹ï¼šæ”¯ä»˜ç»‘å®šè·¯å¾„ã€OAuthé›†æˆã€AccessTokenæœºåˆ¶
- ğŸ‘¨â€ğŸ’» å¼€å‘å›¢é˜Ÿï¼šå‰åç«¯å¯¹æ¥å£ç†è§£å¯èƒ½ä¸ä¸€è‡´
- ğŸ§ª æµ‹è¯•éªŒæ”¶ï¼šæ— æ˜ç¡®éªŒæ”¶æ¡ä»¶

## ä»»åŠ¡æ¸…å•

- [ ] äº§å“è´Ÿè´£äººç¼–å†™ S2.1-S2.7 ç”¨æˆ·æ•…äº‹è‰ç¨¿
- [ ] æŠ€æœ¯è´Ÿè´£äººè¡¥å……æŠ€æœ¯çº¦æŸå’Œè¾¹ç•Œæ¡ä»¶
- [ ] å‰åç«¯è¯„å®¡ç¡®è®¤éªŒæ”¶æ ‡å‡†

## æ•…äº‹ç»“æ„å‚è€ƒ

- S2.1: H5ç«¯OAuthæˆæƒç™»å½•
- S2.2: åˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆåŠ¨æ€äºŒç»´ç è·¯å¾„ï¼‰
- S2.3: å¾®ä¿¡æ”¯ä»˜JSAPIè°ƒç”¨
- S2.4: æ”¯ä»˜å›è°ƒå¤„ç†ä¸AccessTokenç”Ÿæˆ
- S2.5: ç”¨æˆ·ç»‘å®šæ˜Ÿçƒè´¦å·
- S2.6: å›ºå®šäºŒç»´ç å…œåº•è·¯å¾„
- S2.7: è®¢å•çŠ¶æ€æŸ¥è¯¢

## å‚è€ƒæ–‡æ¡£

- EP01 ç¤ºä¾‹: \`docs/v1/user-stories/EP01-è®­ç»ƒè¥ç®¡ç†.md\`
- è¯¦ç»†æ–¹æ¡ˆ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p0-1\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 4 å°æ—¶

## ä¼˜å…ˆçº§è¯´æ˜

ğŸ”´ **P0 é˜»å¡æ€§** - å¿…é¡»åœ¨å¼€å‘å‰å®Œæˆï¼Œå¦åˆ™å­˜åœ¨é«˜è¿”å·¥é£é™©"

echo "âœ… P0-1 åˆ›å»ºæˆåŠŸ"

# P0-2: FastAuth ä¼šå‘˜éªŒè¯æµç¨‹æ–­å±‚
gh issue create \
  --title "[P0] æ˜ç¡® FastAuth/OAuth ä¼šå‘˜éªŒè¯æµç¨‹å’Œæ•°æ®å†™å…¥æ—¶åº" \
  --label "P0-é˜»å¡,architecture,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

OAuth å®Œæˆåå¦‚ä½•å†™å…¥ \`user_planet_binding\` è¡¨çš„æµç¨‹ä¸æ˜ç¡®ï¼Œå­˜åœ¨ä»¥ä¸‹ç¼ºå£ï¼š
- OAuth å›è°ƒåå¦‚ä½•å…³è” \`payment_record\`
- \`user_planet_binding\` æ•°æ®åœ¨å“ªä¸ªæ¥å£å†™å…¥
- \`wechat_user\` è¡¨çš„å†™å…¥æ—¶æœº

## å½±å“èŒƒå›´

- ğŸ”— æ•°æ®æµ: æ”¯ä»˜ â†’ OAuth â†’ ç»‘å®šçš„å®Œæ•´é“¾è·¯
- ğŸ“Š æ•°æ®ä¸€è‡´æ€§: å¤šè¡¨å…³è”çš„æ­£ç¡®æ€§
- ğŸ› æ½œåœ¨ Bug: æ•°æ®å†™å…¥æ—¶æœºé”™è¯¯å¯¼è‡´ä¸šåŠ¡å¼‚å¸¸

## ä»»åŠ¡æ¸…å•

- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¡¥å……å®Œæ•´æ—¶åºå›¾ï¼ˆæ”¯ä»˜ â†’ OAuth â†’ ç»‘å®šï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ˜ç¡® \`/api/auth/callback\` çš„ç»‘å®šé€»è¾‘
- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­è¯´æ˜å„è¡¨çš„æ•°æ®æ¥æºï¼ˆå“ªä¸ªæ¥å£å†™å…¥ï¼‰
- [ ] æ˜ç¡® accessToken åœ¨æ•´ä¸ªæµç¨‹ä¸­çš„ä½œç”¨

## æ¨èæ–¹æ¡ˆ

**æ–¹æ¡ˆAï¼ˆæ¨èï¼‰**ï¼šåœ¨ OAuth å›è°ƒä¸­ä¸»åŠ¨ç»‘å®š
1. OAuth å›è°ƒ â†’ è·å– openid
2. å†™å…¥ \`wechat_user\` è¡¨
3. é€šè¿‡ accessToken å…³è” \`payment_record\`
4. å¼•å¯¼ç”¨æˆ·å¡«å†™æ˜Ÿçƒä¿¡æ¯
5. å†™å…¥ \`user_planet_binding\` è¡¨

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†æ—¶åºå›¾: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p1-4\`
- FastAuthæ–¹æ¡ˆ: \`docs/v1/FastAuthæ¥å…¥æ–¹æ¡ˆ.md\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 4 å°æ—¶ï¼ˆåŒ…å«æ—¶åºå›¾ç»˜åˆ¶å’Œæ–‡æ¡£æ›´æ–°ï¼‰

## ä¼˜å…ˆçº§è¯´æ˜

ğŸ”´ **P0 é˜»å¡æ€§** - å¿…é¡»æ˜ç¡®åæ‰èƒ½å¼€å§‹ OAuth å’Œæ”¯ä»˜æ¥å£å¼€å‘"

echo "âœ… P0-2 åˆ›å»ºæˆåŠŸ"

# P0-3: bind_status çŠ¶æ€å®šä¹‰ä¸ä¸€è‡´
gh issue create \
  --title "[P0] ç»Ÿä¸€ bind_status çŠ¶æ€å®šä¹‰" \
  --label "P0-é˜»å¡,documentation,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

\`bind_status\` çŠ¶æ€å®šä¹‰åœ¨ä¸åŒæ–‡æ¡£ä¸­ä¸ä¸€è‡´ï¼š
- **æŠ€æœ¯æ–¹æ¡ˆ**: \`pending | completed | expired | manual_review | closed\`
- **æ¥å£æ–‡æ¡£**: éƒ¨åˆ†æ¥å£è¿”å› \`bind_status: \"success\"\`ï¼ˆéæ ‡å‡†å€¼ï¼‰

## å½±å“èŒƒå›´

- ğŸ“± å‰ç«¯: çŠ¶æ€æšä¸¾å®šä¹‰é”™è¯¯
- ğŸ”„ ä¸šåŠ¡é€»è¾‘: çŠ¶æ€åˆ¤æ–­é€»è¾‘æ··ä¹±
- ğŸ§ª æµ‹è¯•: éªŒæ”¶æ ‡å‡†ä¸æ˜ç¡®

## ä»»åŠ¡æ¸…å•

- [ ] å…¨å±€æœç´¢æ›¿æ¢ \`\"success\"\` â†’ \`\"completed\"\`
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­å¢åŠ çŠ¶æ€æœºå›¾ä¾‹ï¼ˆ5 çŠ¶æ€ + è½¬æ¢æ¡ä»¶ï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ·»åŠ çŠ¶æ€æšä¸¾è¯´æ˜ç« èŠ‚
- [ ] å‰ç«¯åŒæ­¥ä¿®æ”¹çŠ¶æ€æšä¸¾å¸¸é‡
- [ ] æ•°æ®åº“æ·»åŠ çº¦æŸ: \`CHECK (bind_status IN (...))\`

## æ ‡å‡†çŠ¶æ€å€¼ï¼ˆæœ€ç»ˆå®šä¹‰ï¼‰

\`\`\`yaml
pending:        æ”¯ä»˜å®Œæˆï¼Œå¾…ç”¨æˆ·ç»‘å®šï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
completed:      ç»‘å®šå®Œæˆ
expired:        è¶…è¿‡7å¤©æœªç»‘å®š
manual_review:  ç³»ç»Ÿæ— æ³•è‡ªåŠ¨åŒ¹é…ï¼Œè¿›å…¥äººå·¥å®¡æ ¸
closed:         äººå·¥å®¡æ ¸åˆ¤å®šæ— æ³•åŒ¹é…
\`\`\`

## å‚è€ƒæ–‡æ¡£

- çŠ¶æ€æœºè®¾è®¡: \`docs/v1/æŠ€æœ¯æ–¹æ¡ˆ.md#bind_statusçŠ¶æ€æœº\`
- ä¼˜åŒ–æ–¹æ¡ˆ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p0-3\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 2 å°æ—¶

## ä¼˜å…ˆçº§è¯´æ˜

ğŸ”´ **P0 é˜»å¡æ€§** - å½±å“å‰åç«¯æ¥å£å¯¹æ¥ï¼Œå¿…é¡»åœ¨å¼€å‘å‰ç»Ÿä¸€"

echo "âœ… P0-3 åˆ›å»ºæˆåŠŸ"
echo ""

# ============================================
# ğŸŸ  P1 - é«˜é£é™©é—®é¢˜ (Stage 1 å‰å®Œæˆ)
# ============================================

echo "ğŸ“‹ åˆ›å»º P1 é«˜é£é™©é—®é¢˜..."

# P1-1: é˜¶æ®µè§„åˆ’ä¸å‚ç›´åˆ‡ç‰‡åŸåˆ™å†²çª
gh issue create \
  --title "[P1] è¯„å®¡å¹¶è°ƒæ•´ Stage è§„åˆ’ä¸ºå‚ç›´åˆ‡ç‰‡æ¨¡å¼" \
  --label "P1-é«˜ä¼˜å…ˆçº§,architecture,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

å½“å‰ Stage 1 è§„åˆ’ï¼ˆOAuth + ç®¡ç†åå°éª¨æ¶ï¼‰è¿èƒŒ\"å…ˆåšä½ä¾èµ–å‚ç›´åˆ‡ç‰‡\"åŸåˆ™ï¼š
- OAuth å¼€å‘é˜»å¡æ•´ä¸ª H5 ç«¯
- ç®¡ç†åå°å’Œæ”¯ä»˜æµç¨‹æ— ä¾èµ–å…³ç³»ï¼Œå´ä¸²è¡Œå¼€å‘
- æ”¯ä»˜æ ¸å¿ƒè·¯å¾„åœ¨ Stage 2 æ‰èƒ½å®Œæ•´æµ‹è¯•ï¼Œé£é™©æš´éœ²æ™š

## å»ºè®®è°ƒæ•´æ–¹æ¡ˆ

### æ–° Stage 1: æ”¯ä»˜é—­ç¯ MVP
**ç›®æ ‡**: å®Œæˆ\"ç”¨æˆ·æŠ¥åâ†’æ”¯ä»˜â†’ç»‘å®š\"ç«¯åˆ°ç«¯è·¯å¾„

**åç«¯**:
- OAuth æˆæƒï¼ˆä»… H5 å¿…éœ€éƒ¨åˆ†ï¼‰
- æ”¯ä»˜è®¢å•åˆ›å»º (\`/api/h5/payments\`)
- å¾®ä¿¡æ”¯ä»˜å¯¹æ¥ï¼ˆJSAPI + å›è°ƒï¼‰
- AccessToken ç”Ÿæˆä¸éªŒè¯
- ç»‘å®šæ˜Ÿçƒè´¦å· (\`/api/h5/orders/{id}/planet-binding\`)

**å‰ç«¯**:
- H5 æ”¯ä»˜é¡µé¢ï¼ˆç®€åŒ–ç‰ˆï¼‰
- å¾®ä¿¡æˆæƒè·³è½¬
- æ”¯ä»˜ç»“æœè½®è¯¢
- ç»‘å®šè¡¨å•

**ä»·å€¼**:
- ğŸ’° æå‰æš´éœ²æ”¯ä»˜è·¯å¾„é£é™©ï¼ˆå¾®ä¿¡æ”¯ä»˜å¯¹æ¥ã€ç½‘ç»œé‡è¯•ï¼‰
- ğŸ’° å‰åç«¯å¯å¹¶è¡Œå¼€å‘ï¼ˆæ¥å£æ˜ç¡®ï¼‰
- ğŸ’° æœ€æ—©å¯æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### æ–° Stage 2: ç®¡ç†åå° + æ‰“å¡åŒæ­¥
- è®­ç»ƒè¥ç®¡ç†ï¼ˆCRUD + å‘å¸ƒï¼‰
- ä¼šå‘˜åˆ—è¡¨æŸ¥è¯¢
- çŸ¥è¯†æ˜Ÿçƒæ‰“å¡æ•°æ®åŒæ­¥
- èº«ä»½åŒ¹é…ç®—æ³•

## ä»»åŠ¡æ¸…å•

- [ ] å¬å¼€æŠ€æœ¯è¯„å®¡ä¼šï¼Œç¡®è®¤ Stage é‡æ–°åˆ’åˆ†æ–¹æ¡ˆ
- [ ] æ›´æ–° \`AIè¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’.md\` çš„ Stage å®šä¹‰
- [ ] æ›´æ–° \`æŠ€æœ¯æ–¹æ¡ˆ.md\` çš„å®æ–½è·¯çº¿å›¾
- [ ] é‡æ–°è¯„ä¼°å„ Stage çš„æ—¶é—´ä¼°ç®—

## å¯¹æ¯”åˆ†æ

| ç»´åº¦ | å½“å‰è§„åˆ’ | å»ºè®®è§„åˆ’ |
|------|---------|---------|
| é£é™©æš´éœ²æ—¶æœº | Stage 2ï¼ˆæ™šï¼‰âŒ | Stage 1ï¼ˆæ—©ï¼‰âœ… |
| å‰ç«¯å¯æµ‹åŠŸèƒ½ | Stage 1 æ— å¯ç”¨åŠŸèƒ½ âŒ | Stage 1 å³å¯æ”¯ä»˜ âœ… |
| å¹¶è¡Œå¼€å‘åº¦ | ä½ï¼ˆOAuth é˜»å¡ï¼‰âŒ | é«˜ï¼ˆæ¥å£å…ˆè¡Œï¼‰âœ… |

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†æ–¹æ¡ˆ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p1-1\`
- ç®¡ç†å±‚æ‘˜è¦: \`docs/v1/ç®¡ç†å±‚å†³ç­–æ‘˜è¦.md#å†³ç­–2\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 4 å°æ—¶ï¼ˆè¯„å®¡ä¼š + æ–‡æ¡£æ›´æ–°ï¼‰

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ  **P1 é«˜é£é™©** - å½±å“å¼€å‘èŠ‚å¥å’Œé£é™©æ§åˆ¶ç­–ç•¥"

echo "âœ… P1-1 åˆ›å»ºæˆåŠŸ"

# P1-2: æ¥å£/æ•°æ®åº“è€¦åˆä¸æ€§èƒ½é£é™©
gh issue create \
  --title "[P1] ä¼˜åŒ–æ¥å£/æ•°æ®åº“è€¦åˆï¼Œå¼•å…¥ç¼“å­˜å±‚é˜²æ­¢æ€§èƒ½ç“¶é¢ˆ" \
  --label "P1-é«˜ä¼˜å…ˆçº§,performance,Stage-1" \
  --milestone "Stage 1" \
  --body "## é—®é¢˜æè¿°

æ¥å£è¿”å›å­—æ®µï¼ˆ\`planetUserId\`, \`userNumber\`ï¼‰éœ€è¦ JOIN 3 å¼ è¡¨æŸ¥è¯¢ï¼š
\`\`\`sql
SELECT ... FROM camp_member cm
LEFT JOIN planet_user pu ON ...
LEFT JOIN payment_record pr ON ...
\`\`\`

**æ€§èƒ½é£é™©**:
- æ¯æ¬¡æŸ¥è¯¢éƒ½ JOIN 3 å¼ è¡¨
- é«˜å¹¶å‘åœºæ™¯ä¸‹ DB æˆä¸ºç“¶é¢ˆ
- \`planetUserId\` å¯èƒ½ä¸ºç©ºï¼ŒLEFT JOIN æ€§èƒ½å·®

## æ¨èæ–¹æ¡ˆ

**æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰**: Redis ç¼“å­˜ + æ•°æ®å†—ä½™

1. **camp_member è¡¨å¢åŠ å†—ä½™å­—æ®µ**:
   \`\`\`sql
   ALTER TABLE camp_member
   ADD COLUMN planet_user_name VARCHAR(50),
   ADD COLUMN planet_user_number VARCHAR(50),
   ADD COLUMN order_no VARCHAR(64);
   \`\`\`

2. **Redis ç¼“å­˜ä¼šå‘˜ä¿¡æ¯**:
   - Key: \`camp:members:{campId}\`
   - TTL: 5 åˆ†é’Ÿ
   - æ›´æ–°ç­–ç•¥: Cache Asideï¼ˆå˜æ›´æ—¶åˆ é™¤ç¼“å­˜ï¼‰

3. **è¯»å†™åˆ†ç¦»**:
   - è¯»æ¥å£ â†’ Redis ç¼“å­˜ â†’ ä»åº“
   - å†™æ¥å£ â†’ ä¸»åº“ + åˆ é™¤ç¼“å­˜

## å¤‡é€‰æ–¹æ¡ˆ

**æ–¹æ¡ˆ B**: CQRS è§†å›¾è¡¨ï¼ˆç»´æŠ¤å¤æ‚åº¦è¾ƒé«˜ï¼‰
**æ–¹æ¡ˆ C**: ä¿æŒ JOIN + æ•°æ®åº“ä¼˜åŒ–ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰

## ä»»åŠ¡æ¸…å•

- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­è¡¥å……ç¼“å­˜ç­–ç•¥ç« èŠ‚
- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¯´æ˜è¯»å†™åˆ†ç¦»æ¶æ„
- [ ] è¯„ä¼°æ–¹æ¡ˆ A å’Œæ–¹æ¡ˆ B çš„æ€§èƒ½å·®å¼‚ï¼ˆå‹æµ‹éªŒè¯ï¼‰
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­æ ‡æ³¨å“ªäº›æ¥å£ä½¿ç”¨ç¼“å­˜
- [ ] å®æ–½æ–¹æ¡ˆï¼ˆæ ¹æ®å®é™…æ€§èƒ½ç›‘æ§å†³å®šæ—¶æœºï¼‰

## å®æ–½æ—¶æœº

â° **æŒ‰éœ€æ‰§è¡Œ**: å…ˆä¸Šçº¿åŸºç¡€åŠŸèƒ½ï¼Œé€šè¿‡ç›‘æ§æŒ‡æ ‡åˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–
- è§¦å‘æ¡ä»¶: æ¥å£ P99 å“åº”æ—¶é—´ > 2s æˆ– QPS > 100

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†æ–¹æ¡ˆ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p1-2\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 16 å°æ—¶ï¼ˆæ–¹æ¡ˆ A å®Œæ•´å®æ–½ï¼‰

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ  **P1 é«˜é£é™©** - è™½å¯å»¶åå®æ–½ï¼Œä½†å¿…é¡»æå‰è®¾è®¡å¥½æ–¹æ¡ˆ"

echo "âœ… P1-2 åˆ›å»ºæˆåŠŸ"

# P1-3: æ”¯ä»˜å®‰å…¨å¢å¼º
gh issue create \
  --title "[P1] æ”¯ä»˜å®‰å…¨å¢å¼ºï¼šé˜²é‡æ”¾ + å¹‚ç­‰æ€§ + å‰ç«¯å¤±è´¥è¡¥å¿" \
  --label "P1-é«˜ä¼˜å…ˆçº§,security,Stage-1" \
  --milestone "Stage 1" \
  --body "## é—®é¢˜æè¿°

å½“å‰æ”¯ä»˜è®¾è®¡ç¼ºå°‘ä»¥ä¸‹å®‰å…¨æœºåˆ¶ï¼š
1. âŒ å¾®ä¿¡æ”¯ä»˜å›è°ƒæ— æ—¶é—´çª—å£éªŒè¯ï¼ˆæ˜“è¢«é‡æ”¾æ”»å‡»ï¼‰
2. âŒ å‰ç«¯ JSAPI è°ƒç”¨å¤±è´¥æ— è¡¥å¿æœºåˆ¶
3. âŒ AccessToken å¯é‡å¤ä½¿ç”¨ï¼ˆæ— ä¸€æ¬¡æ€§ ticketï¼‰

## åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ

### é˜¶æ®µ 1 - æ”¯ä»˜å›è°ƒå¢å¼ºï¼ˆP1ï¼Œå¿…é¡»ï¼‰

\`\`\`java
// 1. æ—¶é—´çª—å£éªŒè¯
if (System.currentTimeMillis() - notify.getTimestamp() > 5 * 60 * 1000) {
    return \"FAIL\"; // è¶…è¿‡5åˆ†é’Ÿçš„å›è°ƒæ‹’ç»
}

// 2. Redis å¹‚ç­‰æ€§æ£€æŸ¥
String key = \"pay_callback:\" + outTradeNo;
Boolean acquired = redis.setIfAbsent(key, \"1\", 10, TimeUnit.MINUTES);

// 3. æ•°æ®åº“å”¯ä¸€çº¦æŸ
ALTER TABLE payment_record ADD CONSTRAINT uk_order_no UNIQUE (order_no);
\`\`\`

### é˜¶æ®µ 2 - å‰ç«¯ä¸€æ¬¡æ€§ Ticketï¼ˆP1ï¼‰

\`\`\`json
// ç”Ÿæˆæ”¯ä»˜è®¢å•æ—¶è¿”å›ä¸€æ¬¡æ€§ ticket
{
  \"orderId\": \"ord_xxx\",
  \"prepayId\": \"wx2025...\",
  \"ticket\": \"tk_once_abc123\",  // 5åˆ†é’Ÿæœ‰æ•ˆï¼ŒæŸ¥è¯¢åç«‹å³åˆ é™¤
  \"sign\": \"...\"
}
\`\`\`

### é˜¶æ®µ 3 - å‰ç«¯å¤±è´¥è¡¥å¿ï¼ˆP2ï¼‰

\`\`\`javascript
wx.chooseWXPay({
  success: () => pollOrderStatus(),
  fail: (err) => {
    if (err.errMsg === 'chooseWXPay:cancel') {
      showResumePaymentButton(); // æ˜¾ç¤º\"ç»§ç»­æ”¯ä»˜\"
    } else {
      pollOrderStatus(); // ç½‘ç»œé”™è¯¯ä»éœ€è½®è¯¢ï¼ˆå¯èƒ½å·²æ”¯ä»˜ï¼‰
    }
  }
});
\`\`\`

## ä»»åŠ¡æ¸…å•

- [ ] åœ¨æŠ€æœ¯æ–¹æ¡ˆä¸­è¡¥å……æ”¯ä»˜å®‰å…¨ç« èŠ‚
- [ ] å®ç°æ”¯ä»˜å›è°ƒæ—¶é—´çª—å£éªŒè¯
- [ ] å®ç° Redis å¹‚ç­‰æ€§æ£€æŸ¥
- [ ] æ·»åŠ æ•°æ®åº“å”¯ä¸€çº¦æŸ
- [ ] å®ç°ä¸€æ¬¡æ€§ ticket æœºåˆ¶
- [ ] åœ¨æ¥å£æ–‡æ¡£ä¸­å¢åŠ  \`POST /api/h5/payments/{orderNo}/resume\` æ¥å£
- [ ] å‰ç«¯å¢åŠ æ”¯ä»˜å¤±è´¥å¤„ç†é€»è¾‘
- [ ] ç¼–å†™æ”¯ä»˜å®‰å…¨æµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨¡æ‹Ÿé‡æ”¾æ”»å‡»ï¼‰

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†æ–¹æ¡ˆ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p1-3\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 8 å°æ—¶ï¼ˆé˜¶æ®µ 1+2ï¼‰

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ  **P1 é«˜é£é™©** - æ¶‰åŠèµ„é‡‘å®‰å…¨ï¼Œå¿…é¡»åœ¨ Stage 1 å®Œæˆ"

echo "âœ… P1-3 åˆ›å»ºæˆåŠŸ"

# P1-4: OAuth ç»‘å®šæ—¶åºæ˜ç¡®åŒ–
gh issue create \
  --title "[P1] è¡¥å…… OAuth ç»‘å®šå®Œæ•´æ—¶åºå›¾åˆ°æŠ€æœ¯æ–¹æ¡ˆ" \
  --label "P1-é«˜ä¼˜å…ˆçº§,documentation,architecture,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

OAuth å®Œæˆåå¦‚ä½•å†™å…¥ \`user_planet_binding\` è¡¨ï¼Œæµç¨‹ä¸æ˜ç¡®ã€‚éœ€è¦ä¸€ä¸ªå®Œæ•´çš„æ—¶åºå›¾å±•ç¤ºï¼š
- æ”¯ä»˜åˆ›å»º â†’ å¾®ä¿¡æ”¯ä»˜ â†’ å›è°ƒå¤„ç†
- OAuth æˆæƒ â†’ å›è°ƒ â†’ å†™å…¥ wechat_user
- ç»‘å®šæ˜Ÿçƒè´¦å· â†’ å†™å…¥ user_planet_binding
- accessToken åœ¨æ•´ä¸ªæµç¨‹ä¸­çš„ä½œç”¨

## å…³é”®è®¾è®¡å†³ç­–ï¼ˆéœ€åœ¨æ—¶åºå›¾ä¸­ä½“ç°ï¼‰

1. **wechat_user è¡¨åœ¨ OAuth å›è°ƒæ—¶å†™å…¥**
2. **user_planet_binding è¡¨åœ¨ç»‘å®šæ¥å£è°ƒç”¨æ—¶å†™å…¥**
3. **payment_record é€šè¿‡ wechat_user_id å…³è”**
4. **accessToken è´¯ç©¿æ•´ä¸ªæµç¨‹**:
   - æ”¯ä»˜åæ ‡è¯†è®¢å•
   - OAuth æ—¶å…³è”åŸè®¢å•
   - ç»‘å®šæ—¶éªŒè¯æƒé™

## ä»»åŠ¡æ¸…å•

- [ ] ç»˜åˆ¶å®Œæ•´ Mermaid æ—¶åºå›¾ï¼ˆè‡³å°‘ 20 æ­¥ï¼‰
- [ ] å°†æ—¶åºå›¾è¡¥å……åˆ° \`docs/v1/æŠ€æœ¯æ–¹æ¡ˆ.md\`
- [ ] åœ¨ \`docs/v1/æ¥å£æ–‡æ¡£.md\` çš„ OAuth ç« èŠ‚å¼•ç”¨æ­¤æ—¶åº
- [ ] åœ¨æ•°æ®åº“è®¾è®¡ä¸­æ˜ç¡®å„è¡¨çš„æ•°æ®æ¥æºï¼ˆå“ªä¸ªæ¥å£å†™å…¥ï¼‰
- [ ] æ ‡æ³¨å…³é”®æ­¥éª¤çš„é”™è¯¯å¤„ç†é€»è¾‘

## æ—¶åºå›¾å…³é”®èŠ‚ç‚¹ï¼ˆå‚è€ƒï¼‰

\`\`\`
1. ç”¨æˆ·ç‚¹å‡»\"ç«‹å³æŠ¥å\"
2. POST /api/h5/paymentsï¼ˆåˆ›å»ºè®¢å•ï¼‰
3. å¾®ä¿¡æ”¯ä»˜ JSAPI è°ƒç”¨
4. æ”¯ä»˜å›è°ƒ POST /webhook/payment
5. ç”Ÿæˆ accessTokenï¼ˆstatus=activeï¼‰
6. ç”¨æˆ·ç‚¹å‡»\"ç»‘å®šæ˜Ÿçƒè´¦å·\"
7. GET /api/auth/authorizeï¼ˆOAuth æˆæƒï¼‰
8. å¾®ä¿¡ OAuth å›è°ƒ
9. å†™å…¥ wechat_user è¡¨ â† å…³é”®ï¼
10. æ›´æ–° payment_record.wechat_user_id â† å…³é”®ï¼
11. é‡å®šå‘åˆ°ç»‘å®šé¡µé¢
12. ç”¨æˆ·å¡«å†™æ˜Ÿçƒä¿¡æ¯
13. POST /api/h5/orders/{orderNo}/planet-binding
14. å†™å…¥ user_planet_binding è¡¨ â† å…³é”®ï¼
15. æ›´æ–° payment_record.bind_status=completed
\`\`\`

## å‚è€ƒæ–‡æ¡£

- å®Œæ•´æ—¶åºå›¾: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p1-4\`
- å¯ç›´æ¥å¤åˆ¶ Mermaid ä»£ç 

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 2 å°æ—¶

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ  **P1 é«˜é£é™©** - ä¸ P0-2 å¼ºå…³è”ï¼Œå¿…é¡»åœ¨å¼€å‘å‰æ˜ç¡®"

echo "âœ… P1-4 åˆ›å»ºæˆåŠŸ"
echo ""

# ============================================
# ğŸŸ¡ P2 - ä¼˜åŒ–æœºä¼š (å¼€å‘ä¸­è¿­ä»£)
# ============================================

echo "ğŸ“‹ åˆ›å»º P2 ä¼˜åŒ–æœºä¼šï¼ˆç²¾é€‰ï¼‰..."

# P2-1: ç›‘æ§æŒ‡æ ‡ç»†ç²’åº¦æå‡
gh issue create \
  --title "[P2] è¡¥å……ä¸šåŠ¡ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼ˆLayer 3-5ï¼‰" \
  --label "P2-ä¼˜åŒ–,monitoring,Stage-1" \
  --milestone "Stage 1" \
  --body "## é—®é¢˜æè¿°

å½“å‰ç›‘æ§ä»…è¦†ç›–ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰ï¼Œç¼ºå°‘ä¸šåŠ¡æŒ‡æ ‡ï¼Œæ— æ³•é‡åŒ– Stage éªŒæ”¶ç›®æ ‡ã€‚

## éœ€è¦è¡¥å……çš„ç›‘æ§å±‚çº§

### Layer 3 - åº”ç”¨æŒ‡æ ‡
- æ¥å£ P99 å“åº”æ—¶é—´ > 2s
- æ¥å£é”™è¯¯ç‡ > 1%
- å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ç§¯å‹ > 100

### Layer 4 - ä¸šåŠ¡æŒ‡æ ‡ï¼ˆé‡ç‚¹ï¼‰
**æ”¯ä»˜æµç¨‹**:
- æ”¯ä»˜æˆåŠŸç‡ï¼ˆç›®æ ‡ >95%ï¼‰
- è®¢å•ç»‘å®šå®Œæˆç‡ï¼ˆç›®æ ‡ >85%ï¼Œ7å¤©å†…ï¼‰

**èº«ä»½åŒ¹é…**:
- è‡ªåŠ¨åŒ¹é…æˆåŠŸç‡ï¼ˆç›®æ ‡ >80%ï¼‰
- äººå·¥å®¡æ ¸å æ¯”ï¼ˆç›®æ ‡ <15%ï¼‰

**æ‰“å¡åŒæ­¥**:
- æ‰“å¡æ•°æ®åŒæ­¥å»¶è¿Ÿï¼ˆç›®æ ‡ <10åˆ†é’Ÿï¼‰
- åŒæ­¥å¤±è´¥ç‡ï¼ˆç›®æ ‡ <1%ï¼‰

**é€€æ¬¾å¤„ç†**:
- é€€æ¬¾æ‰§è¡Œå¹³å‡è€—æ—¶ï¼ˆç›®æ ‡ <30åˆ†é’Ÿï¼‰
- é€€æ¬¾æˆåŠŸç‡ï¼ˆç›®æ ‡ >99%ï¼‰

### Layer 5 - ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- H5 é¡µé¢åŠ è½½æ—¶é—´ï¼ˆP95 < 2sï¼‰
- æ”¯ä»˜è·³è½¬æˆåŠŸç‡ï¼ˆ>98%ï¼‰

## ä»»åŠ¡æ¸…å•

- [ ] åœ¨ \`å¼€å‘å‰å‡†å¤‡æ¸…å•.md\` ä¸­è¡¥å…… Layer 3-5 ç›‘æ§æŒ‡æ ‡
- [ ] åœ¨å„ Stage éªŒæ”¶æ ‡å‡†ä¸­å¼•ç”¨å¯¹åº”æŒ‡æ ‡
- [ ] å®ç° Prometheus è‡ªå®šä¹‰ Metrics
- [ ] é…ç½® Grafana ä»ªè¡¨ç›˜æ¨¡æ¿
- [ ] è®¾ç½®å‘Šè­¦è§„åˆ™ï¼ˆP0-P3 å››çº§ï¼‰

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†æŒ‡æ ‡å®šä¹‰: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p2-1\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 6 å°æ—¶

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ¡ **P2 ä¼˜åŒ–** - Stage 1 å‰å®Œæˆï¼Œç”¨äºéªŒæ”¶å’Œè¿ç»´"

echo "âœ… P2-1 åˆ›å»ºæˆåŠŸ"

# P2-2: Docker æœ¬åœ°å¼€å‘ç¯å¢ƒ
gh issue create \
  --title "[P2] æ­å»º Docker Compose ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ" \
  --label "P2-ä¼˜åŒ–,developer-experience,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

å½“å‰å¼€å‘ç¯å¢ƒæ­å»ºéœ€è¦æ‰‹åŠ¨å®‰è£… PostgreSQLã€Redisã€é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ–°äººä¸Šæ‰‹æˆæœ¬é«˜ï¼ˆçº¦ 2 å¤©ï¼‰ã€‚

## ç›®æ ‡

æ–°äººå…¥èŒç¬¬ä¸€å¤©å³å¯å¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒï¼š
\`\`\`bash
git clone <repo>
cd backend
docker-compose up -d    # å¯åŠ¨ä¾èµ–æœåŠ¡
./gradlew bootRun       # å¯åŠ¨åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€ http://localhost:8080/doc.html
\`\`\`

## ä»»åŠ¡æ¸…å•

- [ ] åˆ›å»º \`docker-compose.yml\` æ–‡ä»¶
  - PostgreSQL 15ï¼ˆå«åˆå§‹åŒ–è„šæœ¬ï¼‰
  - Redis 7
  - Adminerï¼ˆæ•°æ®åº“ç®¡ç†ç•Œé¢ï¼‰
- [ ] ç¼–å†™æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ \`scripts/init.sql\`
  - åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
  - æ‰§è¡Œå»ºè¡¨ DDL
- [ ] æ›´æ–° \`README.md\` çš„å¿«é€Ÿå¯åŠ¨æŒ‡å—
- [ ] æ·»åŠ  \`.env.example\` ç¯å¢ƒå˜é‡æ¨¡æ¿
- [ ] æµ‹è¯•éªŒè¯æ–°äººå¯ä»¥æŒ‰æ–‡æ¡£ä¸€é”®å¯åŠ¨

## é¢„æœŸæ”¶ç›Š

- æ–°äººä¸Šæ‰‹æ—¶é—´: 2 å¤© â†’ 0.5 å¤©ï¼ˆâ†“75%ï¼‰
- ç¯å¢ƒä¸€è‡´æ€§: é¿å…\"æˆ‘æœ¬åœ°èƒ½è·‘\"é—®é¢˜
- CI/CD å‹å¥½: å¯ç›´æ¥ç”¨äºæµ‹è¯•ç¯å¢ƒ

## å‚è€ƒæ–‡æ¡£

- docker-compose.yml ç¤ºä¾‹: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p2-2\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 4 å°æ—¶

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ¡ **P2 ä¼˜åŒ–** - å»ºè®®åœ¨ Stage 0 å®Œæˆï¼ŒROI æé«˜"

echo "âœ… P2-2 åˆ›å»ºæˆåŠŸ"

# P2-3: API RESTful è§„èŒƒåŒ–
gh issue create \
  --title "[P2] åˆ¶å®š API å‘½åè§„èŒƒå¹¶ä¼˜åŒ–ç°æœ‰æ¥å£è®¾è®¡" \
  --label "P2-ä¼˜åŒ–,api-design,Stage-0" \
  --milestone "Stage 0" \
  --body "## é—®é¢˜æè¿°

å½“å‰æ¥å£è®¾è®¡å­˜åœ¨ä¸ç¬¦åˆ RESTful æœ€ä½³å®è·µçš„æƒ…å†µï¼š
- \`/api/admin/camp/list\` - åŠ¨è¯å‡ºç°åœ¨ URL
- \`/api/admin/camp/create\` - åŠ¨è¯ create å†—ä½™
- \`/api/h5/order/bindPlanet\` - é©¼å³°å‘½å

## ä¼˜åŒ–å»ºè®®

### å‘½åè§„èŒƒ
\`\`\`yaml
èµ„æºå‘½å:
  - å¤æ•°åè¯: /camps, /members, /payments
  - å°å†™ + è¿å­—ç¬¦: /planet-bindingï¼ˆä¸ç”¨é©¼å³°ï¼‰
  - é¿å…åŠ¨è¯: ç”¨ HTTP æ–¹æ³•è¡¨è¾¾åŠ¨ä½œ

å­èµ„æºåµŒå¥—:
  - å±‚çº§ â‰¤ 3: /camps/{id}/members/{memberId}/checkins âœ…

æŸ¥è¯¢å‚æ•°:
  - åˆ†é¡µ: ?page=1&size=20&sort=createdAt,desc
  - è¿‡æ»¤: ?status=ONGOING&depositAmount=99
\`\`\`

### API ç‰ˆæœ¬æ§åˆ¶
\`\`\`
å½“å‰: /api/admin/camp/detail/{id}
ä¼˜åŒ–: /api/v1/admin/camps/{id}
\`\`\`

### é”™è¯¯å“åº”æ ‡å‡†åŒ–ï¼ˆRFC 7807ï¼‰
\`\`\`json
{
  \"type\": \"/errors/validation-failed\",
  \"title\": \"å‚æ•°æ ¡éªŒå¤±è´¥\",
  \"status\": 400,
  \"detail\": \"è®­ç»ƒè¥æŠ¼é‡‘é‡‘é¢å¿…é¡»åœ¨1-999ä¹‹é—´\",
  \"instance\": \"/api/v1/admin/camps\",
  \"errors\": [{
    \"field\": \"depositAmount\",
    \"message\": \"é‡‘é¢è¶…å‡ºå…è®¸èŒƒå›´\",
    \"rejectedValue\": 1000
  }],
  \"traceId\": \"a1b2c3d4-5678-90ab-cdef\"
}
\`\`\`

## ä»»åŠ¡æ¸…å•

- [ ] åˆ¶å®šã€ŠAPI è®¾è®¡è§„èŒƒæ–‡æ¡£ã€‹
- [ ] å‰åç«¯è”åˆè¯„å®¡ç¡®è®¤è§„èŒƒ
- [ ] æ›´æ–°æ¥å£æ–‡æ¡£ä¸­çš„ URL è·¯å¾„
- [ ] å®ç°ç»Ÿä¸€é”™è¯¯å“åº”å¤„ç†å™¨
- [ ] åœ¨ Stage 0 å®Œæˆè§„èŒƒåˆ¶å®šï¼ˆé¿å…åç»­è¿”å·¥ï¼‰

## éœ€è¦é‡æ„çš„æ¥å£ç¤ºä¾‹

| å½“å‰ | ä¼˜åŒ–å | æ–¹æ³• |
|------|--------|------|
| \`/api/admin/camp/list\` | \`/api/v1/admin/camps?page=1\` | GET |
| \`/api/admin/camp/create\` | \`/api/v1/admin/camps\` | POST |
| \`/api/admin/refund/approve\` | \`/api/v1/admin/refunds/{id}/approval\` | PUT |
| \`/api/h5/order/bindPlanet\` | \`/api/v1/h5/orders/{orderNo}/planet-binding\` | POST |

## å‚è€ƒæ–‡æ¡£

- è¯¦ç»†è§„èŒƒ: \`docs/v1/è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p2-4\`

## é¢„è®¡å·¥ä½œé‡

â±ï¸ 8 å°æ—¶ï¼ˆè§„èŒƒåˆ¶å®š 4h + æ¥å£æ–‡æ¡£æ›´æ–° 4hï¼‰

## ä¼˜å…ˆçº§è¯´æ˜

ğŸŸ¡ **P2 ä¼˜åŒ–** - Stage 0 å®Œæˆï¼Œé¿å…å¼€å‘ä¸­è¿”å·¥"

echo "âœ… P2-3 åˆ›å»ºæˆåŠŸ"
echo ""

# ============================================
# æ€»ç»“
# ============================================

echo ""
echo "âœ… GitHub Issues åˆ›å»ºå®Œæˆï¼"
echo ""
echo "ğŸ“Š åˆ›å»ºç»Ÿè®¡:"
echo "  - ğŸ”´ P0 é˜»å¡æ€§é—®é¢˜: 3 ä¸ª"
echo "  - ğŸŸ  P1 é«˜é£é™©é—®é¢˜: 4 ä¸ª"
echo "  - ğŸŸ¡ P2 ä¼˜åŒ–æœºä¼š: 3 ä¸ª"
echo "  - æ€»è®¡: 10 ä¸ª Issues"
echo ""
echo "ğŸ”— æŸ¥çœ‹ Issues: gh issue list --label 'P0-é˜»å¡,P1-é«˜ä¼˜å…ˆçº§,P2-ä¼˜åŒ–'"
echo "ğŸ“‹ æŸ¥çœ‹çœ‹æ¿: gh project list"
echo ""
echo "ğŸ’¡ æç¤º: æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç®¡ç† Issues:"
echo "  - gh issue list                    # åˆ—å‡ºæ‰€æœ‰ Issues"
echo "  - gh issue view <number>           # æŸ¥çœ‹è¯¦æƒ…"
echo "  - gh issue edit <number> --add-assignee @me  # åˆ†é…ç»™è‡ªå·±"
echo "  - gh issue close <number>          # å…³é—­ Issue"
