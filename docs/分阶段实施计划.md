# 知识星球训练营自动押金退款系统 - 分阶段实施计划

## 文档信息
- **文档版本**：v2.0
- **更新日期**：2025-12-02
- **项目周期**：27天
- **开发模式**：AI 辅助敏捷开发（Vibe Coding）
- **对齐文档**：`docs/v1/技术方案.md`、`docs/v1/AI辅助敏捷开发计划.md`

---

## 一、项目总览

### 1.1 目标
在27天内完成 v1 完整版系统开发，采用 6 Stage 迭代方式，每个 Stage 都有独立可测试的交付物。

### 1.2 Stage 划分

| Stage | 名称 | 周期 | 主要目标 | 对应技术方案 |
|-------|------|------|----------|--------------|
| **Stage 0** | 环境搭建和项目骨架 | 3天 | 搭建开发环境，创建前后端骨架，初始化 16 张表 | - |
| **Stage 1** | 基础框架 + 训练营 CRUD | 4天 | JWT 认证 + 训练营管理接口 | ✅ Stage 1 |
| **Stage 2** | 支付集成（混合方案） | 5天 | 动态二维码 + 支付后绑定机制 | ✅ Stage 2 |
| **Stage 3** | 打卡同步 | 4天 | 知识星球 API 集成 + 定时任务 | ✅ Stage 3 |
| **Stage 4** | 混合匹配算法 | 3天 | bind_status 优先匹配 + 智能匹配 | ✅ Stage 4 |
| **Stage 5** | 退款流程 | 4天 | 审核 + 执行 + 通知 | ✅ Stage 5 |
| **Stage 6** | 前端开发 + 系统管理 | 4天 | H5 端 + 管理后台 + 统计报表 | ✅ Stage 6 |

### 1.3 里程碑时间线

```
Day 0   Day 3     Day 7      Day 12     Day 16     Day 19     Day 23     Day 27
  │       │         │          │          │          │          │          │
  └───────┴─────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
  环境搭建  基础框架   支付集成    打卡同步    匹配算法    退款流程    前端开发   上线
  Stage 0  Stage 1   Stage 2    Stage 3    Stage 4    Stage 5    Stage 6   完成
```

### 1.4 核心技术决策

> 详细说明见 `docs/v1/技术方案.md`

| 领域 | 决策 |
|------|------|
| **身份匹配方案** | 混合匹配：动态二维码(80%) + 用户填写(15%) + 智能匹配(4%) + 人工处理(1%) |
| **支付绑定状态** | `bind_status`: pending → completed/expired → manual_required → closed |
| **绑定方式类型** | `bind_method`: dynamic_qrcode / user_fill / smart_match / manual |
| **H5 访问票据** | accessToken（UUID v4，前缀 `tk_`），有效期至训练营结束后 7 天 |
| **数据库表数量** | 16 张表：6 核心 + 4 系统 + 5 状态日志 + 1 通知 |

---

## 二、Stage 0：环境搭建和项目骨架（Day 0-3）

### 2.1 目标
- 搭建完整的开发环境
- 创建前后端项目骨架
- 完成 16 张数据库表初始化

### 2.2 任务清单

#### 2.2.1 后端项目骨架（Day 1）
- [ ] 创建 Spring Boot 3.2+ 项目
  - Gradle 构建，Java 17
  - 配置 MyBatis Plus 3.5.5+
  - 配置 PostgreSQL + Redis
  - 配置 Knife4j 4.x API 文档
- [ ] 创建项目目录结构
  ```
  backend/src/main/java/com/camp/
  ├── config/          # 配置类
  ├── common/          # 统一响应、异常处理
  ├── controller/      # admin/, h5/, webhook/
  ├── service/
  ├── mapper/
  ├── entity/
  ├── dto/
  ├── enums/           # 包含 BindStatus, PaymentBindMethod 等
  ├── manager/         # 第三方 API 封装
  ├── schedule/        # 定时任务
  └── util/
  ```
- [ ] 配置统一响应格式
  ```json
  {"code": 200, "message": "成功", "data": {}, "timestamp": 1234567890}
  ```

**验收标准**：
- ✅ `./gradlew bootRun` 启动成功
- ✅ 访问 http://localhost:8080/doc.html 显示 API 文档
- ✅ 健康检查接口 `/api/health` 返回 200

---

#### 2.2.2 数据库初始化（Day 1-2）
- [ ] 创建 16 张数据库表

| 分类 | 表名 | 说明 |
|------|------|------|
| 核心业务表（6张） | training_camp | 训练营基本信息 |
| | camp_member | 训练营会员 |
| | planet_user | 知识星球用户 |
| | payment_record | 支付记录（含 bind_status, bind_method, bind_deadline） |
| | refund_record | 退款记录 |
| | checkin_record | 打卡记录 |
| 系统管理表（4张） | system_user | 系统用户 |
| | system_config | 系统配置 |
| | operation_log | 操作日志 |
| | camp_member_relation | 训练营人员关系 |
| 状态日志表（5张） | camp_status_log | 训练营状态日志 |
| | payment_bind_status_log | 支付绑定状态日志 |
| | order_status_log | 订单状态日志 |
| | refund_status_log | 退款状态日志 |
| | member_status_log | 会员状态日志 |
| 通知表（1张） | notification_message | 通知消息 |

- [ ] 创建索引和触发器
- [ ] 导入初始数据（管理员账号、系统配置）

**验收标准**：
- ✅ 执行 SQL 脚本成功创建 16 张表
- ✅ 索引创建成功
- ✅ 初始数据导入成功

---

#### 2.2.3 前端项目骨架（Day 2-3）

**H5 会员端**（Vue 3 + Vant 4）：
- [ ] 创建项目 `frontend/h5-member/`
- [ ] 配置 Axios 封装（含 `X-Access-Token` Header）
- [ ] 配置路由（训练营列表、详情、绑定页、群二维码、进度查询）

**Web 管理后台**（Vue 3 + Element Plus）：
- [ ] 创建项目 `frontend/admin-web/`
- [ ] 配置登录页和基础布局
- [ ] 配置 JWT Token 注入

**验收标准**：
- ✅ 两个前端项目 `npm run dev` 启动成功
- ✅ H5 端 Axios 请求能正确携带 accessToken

---

## 三、Stage 1：基础框架 + 训练营 CRUD（Day 4-7）

### 3.1 目标
完成 JWT 认证体系和训练营管理接口

### 3.2 任务清单

#### 3.2.1 JWT 认证基础设施（Day 4）
- [ ] JwtUtil.java - Token 生成/解析/验证
- [ ] SecurityConfig.java - Spring Security 配置
- [ ] JwtAuthenticationFilter.java - JWT 过滤器
- [ ] AccessTokenFilter.java - H5 accessToken 过滤器

**安全配置**：
| 路径 | 认证方式 |
|------|----------|
| `/api/h5/camps`, `/api/h5/payments` 等 | 白名单（无需认证） |
| `/api/admin/**` | JWT Token |
| `/api/h5/payments/bind`, `/api/h5/progress/**` 等 | accessToken（H5 敏感接口） |

**验收标准**：
- ✅ 登录接口返回有效 Token
- ✅ 访问 /api/admin/** 需要 Token
- ✅ H5 公开接口无需 Token

---

#### 3.2.2 登录接口（Day 4）
- [ ] POST /api/auth/login - 用户登录
  - 密码校验（BCrypt）
  - 生成 JWT Token

**验收标准**：
- ✅ 登录成功返回 Token
- ✅ 密码错误返回 401

---

#### 3.2.3 训练营 CRUD 接口（Day 5-6）

**管理端接口**：
| 方法 | 路径 | 功能 |
|------|------|------|
| POST | /api/admin/camps | 创建训练营 |
| GET | /api/admin/camps | 训练营列表（分页） |
| GET | /api/admin/camps/{id} | 训练营详情 |
| PUT | /api/admin/camps/{id} | 更新训练营 |
| DELETE | /api/admin/camps/{id} | 删除（软删除） |
| POST | /api/admin/camps/{id}/publish | 发布训练营 |

**H5 端接口**：
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | /api/h5/camps | 训练营列表（公开） |
| GET | /api/h5/camps/{id}?planetUserId=xxx | 训练营详情（含预填信息） |

**训练营状态机**：
```
draft → pending → enrolling → ongoing → ended → settling → archived
```
每次状态变更记录到 `camp_status_log` 表

**验收标准**：
- ✅ 所有接口通过 Postman 测试
- ✅ 分页查询正常
- ✅ 状态变更有日志记录

---

#### 3.2.4 训练营状态自动更新（Day 7）
- [ ] 定时任务（每日 00:05 执行）
  - enrolling → ongoing（到达开始日期）
  - ongoing → ended（到达结束日期）

**验收标准**：
- ✅ 定时任务正常执行
- ✅ 状态自动更新

---

### 3.3 Stage 1 验收清单
- [ ] JWT 认证体系完整
- [ ] 训练营 CRUD 接口可用
- [ ] H5 训练营列表/详情接口可用
- [ ] 训练营状态自动更新

---

## 四、Stage 2：支付集成（混合方案）（Day 8-12）

### 4.1 目标
实现企业微信支付集成，完成动态二维码 + 支付后绑定混合方案

### 4.2 核心概念

> 详细设计见 `docs/v1/技术方案.md` 第 5.3 节

**混合匹配方案**：

| 方式 | 覆盖率 | 准确率 | 场景 |
|------|--------|--------|------|
| `dynamic_qrcode` | 80% | 100% | 从知识星球动态二维码扫码，attach 携带 planet_user_id |
| `user_fill` | 15% | 95% | 固定二维码支付后，用户在 H5 页面填写星球信息 |
| `smart_match` | 4% | 70% | 用户未填写，系统通过 Levenshtein 算法智能匹配 |
| `manual` | 1% | 100% | 智能匹配失败，管理员人工处理 |

**绑定状态流转**：
```
pending → completed     (用户主动绑定成功)
pending → expired       (超过 bind_deadline 未绑定)
expired → completed     (智能匹配成功)
expired → manual_required (智能匹配失败)
manual_required → completed (人工处理完成)
completed → closed      (退款完成)
```

### 4.3 任务清单

#### 4.3.1 企业微信支付 SDK 封装（Day 8）
- [ ] WechatPayManager.java
  - createOrder(orderNo, amount, description, attach) → 支付参数
  - queryOrder(orderNo) → 查询状态
  - refund(orderNo, refundAmount) → 发起退款

**attach 字段**：
- 动态二维码：`{"campId":1,"planetUserId":"123456789","orderNo":"ord_xxx"}`
- 固定二维码：空

**验收标准**：
- ✅ 能成功创建支付订单
- ✅ 签名正确

---

#### 4.3.2 创建支付订单接口（Day 8-9）
- [ ] POST /api/h5/payments

**请求体**：
```json
{
  "campId": 1,
  "planetUserId": "123456789",     // 动态二维码场景必传
  "planetNickname": "小明同学",     // 动态二维码场景必传
  "wechatNickname": "小明"          // 可选
}
```

**业务逻辑**：
1. 生成订单号：`ord_` + UUID（防枚举攻击）
2. 判断支付入口：
   - 有 planetUserId → `bind_status=completed`, `bind_method=dynamic_qrcode`
   - 无 planetUserId → `bind_status=pending`, `bind_deadline=now+7days`
3. 调用微信支付创建订单

**验收标准**：
- ✅ 订单号格式正确
- ✅ 区分动态/固定二维码场景

---

#### 4.3.3 支付回调处理（Day 9-10）
- [ ] POST /api/webhook/wechat/payment

**业务逻辑**：
1. 验证签名（防伪造）
2. 幂等性处理（Redis 分布式锁）
3. 解析 attach 字段：
   - **有 attach**（动态二维码）：
     - 更新 `bind_status=completed`, `bind_method=dynamic_qrcode`
     - 创建/更新 `camp_member` 记录
     - 生成 accessToken 存入 Redis
   - **无 attach**（固定二维码）：
     - 更新 `bind_status=pending`, `bind_deadline=7天后`
     - 生成 accessToken 存入 Redis
4. 记录状态日志

**accessToken 生成**：
```java
String accessToken = "tk_" + UUID.randomUUID().toString();
// Redis 存储，有效期 = 训练营结束日期 + 7天
```

**验收标准**：
- ✅ 签名验证正确
- ✅ 幂等处理有效
- ✅ 两种场景处理正确

---

#### 4.3.4 查询支付状态（Day 10）
- [ ] GET /api/h5/payments/{orderNo}/status

**响应**：
```json
{
  "orderNo": "ord_xxx",
  "status": "paid",
  "bindStatus": "pending",
  "bindMethod": null,
  "accessToken": "tk_xxx",
  "bindDeadline": "2025-12-08T10:00:00"
}
```

**验收标准**：
- ✅ 支付成功时返回 accessToken
- ✅ 返回 bindStatus 和 bindMethod

---

#### 4.3.5 用户绑定接口（Day 11）
- [ ] POST /api/h5/payments/bind
- [ ] Header: `X-Access-Token: {accessToken}`

**安全校验**：
1. 验证 accessToken 有效且未过期
2. 验证 accessToken 绑定的 orderNo 与请求一致
3. 验证订单 bind_status = pending
4. 验证未超过 bind_deadline

**业务逻辑**：
1. 更新 `bind_status=completed`, `bind_method=user_fill`
2. 创建/关联 camp_member 记录
3. 更新 accessToken 状态为 bound
4. 记录状态日志

**验收标准**：
- ✅ accessToken 验证正确
- ✅ 绑定成功后返回群二维码

---

#### 4.3.6 获取群二维码（Day 11）
- [ ] GET /api/h5/payments/{orderNo}/qrcode
- [ ] Header: `X-Access-Token: {accessToken}`

**验收标准**：
- ✅ `bind_status=completed` 才返回二维码

---

#### 4.3.7 绑定超时定时任务（Day 12）
- [ ] BindExpireTask（每日 02:00 执行）
  - 检查 `bind_status=pending` 且超过 bind_deadline 的记录
  - 更新为 `expired`
  - 加入智能匹配队列

**验收标准**：
- ✅ 超时订单正确标记为 expired

---

### 4.4 Stage 2 验收清单
- [ ] 企业微信支付 SDK 封装完成
- [ ] 创建订单接口支持两种入口
- [ ] 支付回调正确处理 attach 字段
- [ ] 用户绑定接口正常工作
- [ ] accessToken 机制完整

---

## 五、Stage 3：打卡同步（Day 13-16）

### 5.1 目标
实现知识星球打卡数据同步

### 5.2 任务清单

#### 5.2.1 知识星球 API 封装（Day 13）
- [ ] PlanetApiManager.java
  - getCheckinRanking(groupId, checkinId) → 打卡排行榜
  - 自动翻页（每页 100 条，最多 200 人）
  - validateCookie() → 验证 Cookie 有效性

**打卡天数计算**：
```
实际打卡天数 = API 返回天数 + GRACE_DAYS（默认 1 天）
```

**验收标准**：
- ✅ 能成功获取打卡数据
- ✅ 自动翻页正常
- ✅ Cookie 过期能告警

---

#### 5.2.2 打卡数据同步定时任务（Day 14）
- [ ] CheckinSyncTask（每日 01:00 执行）
  - 同步所有进行中训练营的打卡数据
  - 更新 camp_member.checkin_count
  - 计算 eligible_for_refund

**验收标准**：
- ✅ 定时任务正常执行
- ✅ 打卡统计准确

---

#### 5.2.3 手动同步接口（Day 15）
- [ ] POST /api/admin/checkins/sync/{campId}
  - Redis 分布式锁防止并发
  - 返回同步结果

**验收标准**：
- ✅ 手动触发同步正常
- ✅ 返回更新人数、新增打卡数

---

#### 5.2.4 打卡统计接口（Day 16）
- [ ] GET /api/admin/checkins/stats/{campId}
  - 每日打卡人数趋势
  - 打卡天数分布

**验收标准**：
- ✅ 统计数据准确

---

### 5.3 Stage 3 验收清单
- [ ] 知识星球 API 封装完成
- [ ] 打卡数据每日自动同步
- [ ] 手动同步功能可用
- [ ] 打卡统计接口可用

---

## 六、Stage 4：混合匹配算法（Day 17-19）

### 6.1 目标
实现 bind_status 优先匹配 + 智能匹配算法

### 6.2 匹配算法设计

> 详细设计见 `docs/v1/技术方案.md` 第 5.2.7 节

**匹配优先级**：
```java
switch (payment.getBindStatus()) {
    case COMPLETED:
        // 直接使用已绑定映射，置信度 100%
        break;
    case PENDING:
        if (isExpired(payment.getBindDeadline())) {
            // 超时，启动智能匹配
            updateBindStatus(payment, EXPIRED);
            smartMatch(member, payment);
        } else {
            // 未超时，跳过等待用户绑定
        }
        break;
    case EXPIRED:
        // 智能匹配
        smartMatch(member, payment);
        break;
}
```

**智能匹配算法**（Levenshtein）：
- 星球 ID 精确匹配 → 得分 50%
- 昵称相似度 → 得分 50%
- 总分 ≥ 80% → 匹配成功，`bind_method=smart_match`
- 总分 50-79% → 待审核
- 总分 < 50% → 需人工，`bind_method=manual`

### 6.3 任务清单

#### 6.3.1 混合匹配服务（Day 17-18）
- [ ] MatchService.java
  - matchMembersForRefund(campId) → 为退款匹配所有合格用户
  - smartMatch(member, payment) → 智能匹配算法
  - manualMatch(memberId, planetUserId) → 手动匹配

**验收标准**：
- ✅ bind_status=completed 直接使用，置信度 100%
- ✅ bind_status=expired 启动智能匹配
- ✅ Levenshtein 算法正确

---

#### 6.3.2 匹配管理接口（Day 19）
- [ ] GET /api/admin/members?matchStatus=pending - 待匹配列表
- [ ] POST /api/admin/members/{id}/match - 手动匹配

**验收标准**：
- ✅ 待匹配列表正常显示
- ✅ 手动匹配后 bind_status=completed, bind_method=manual

---

### 6.4 Stage 4 验收清单
- [ ] 混合匹配算法完整实现
- [ ] 智能匹配准确率达标
- [ ] 手动匹配功能可用
- [ ] 所有状态变更有日志

---

## 七、Stage 5：退款流程（Day 20-23）

### 7.1 目标
完成退款列表生成、审核、执行、通知

### 7.2 任务清单

#### 7.2.1 退款名单生成（Day 20）
- [ ] RefundService.generateRefundList()
  - 筛选 eligible_for_refund = true 的会员
  - 调用 MatchService 进行匹配
  - 创建 refund_record（状态=pending）

**验收标准**：
- ✅ 退款名单生成正确
- ✅ 匹配结果关联正确

---

#### 7.2.2 退款审核接口（Day 20-21）
- [ ] POST /api/admin/refunds/{id}/approve - 单个审核
- [ ] POST /api/admin/refunds/batch-approve - 批量审核
- [ ] POST /api/admin/refunds/{id}/reject - 拒绝退款

**验收标准**：
- ✅ 批量审核支持最低置信度阈值
- ✅ 记录审核人和审核时间

---

#### 7.2.3 退款执行（Day 21-22）
- [ ] RefundService.executeRefund()

**业务逻辑**：
```java
try {
    wechatPayManager.refund(orderNo, refundAmount);
    record.setRefundStatus("success");
    sendRefundNotification(record, true);
} catch (Exception e) {
    handleRefundFailure(record, e);
}

void handleRefundFailure(record, e) {
    record.setRetryCount(record.getRetryCount() + 1);
    if (record.getRetryCount() < 3) {
        scheduleRetry(record, retryCount * 5 * 60);
    } else {
        record.setRefundStatus("manual_required");
        sendAlertToAdmin(record);
    }
}
```

**验收标准**：
- ✅ 退款调用成功
- ✅ 失败自动重试（最多 3 次）
- ✅ 超过重试次数标记为人工处理

---

#### 7.2.4 通知服务（Day 22-23）
- [ ] NotificationService.java
  - 退款成功通知会员
  - 退款失败告警管理员
  - 消息记录到 notification_message 表

**验收标准**：
- ✅ 退款成功通知发送
- ✅ 失败告警发送

---

#### 7.2.5 退款结果 Webhook（Day 23）
- [ ] POST /api/webhook/wechat/refund
  - 更新退款状态
  - 触发通知

**验收标准**：
- ✅ 退款状态同步正确

---

### 7.3 Stage 5 验收清单
- [ ] 退款名单生成正确
- [ ] 审核流程完整
- [ ] 退款执行成功
- [ ] 失败重试机制有效
- [ ] 通知发送正常

---

## 八、Stage 6：前端开发 + 系统管理（Day 24-27）

### 8.1 目标
完成 H5 会员端、Web 管理后台、统计报表

### 8.2 任务清单

#### 8.2.1 H5 会员端（Day 24-25）

| 页面 | 功能 |
|------|------|
| CampList.vue | 训练营列表（卡片式布局） |
| CampDetail.vue | 训练营详情（支持预填星球信息） |
| PaymentBind.vue | 支付后绑定（表单校验） |
| GroupQrcode.vue | 群二维码展示 |
| ProgressQuery.vue | 打卡进度查询（日历视图） |

**验收标准**：
- ✅ 完整支付流程可用
- ✅ 绑定页面表单校验正确
- ✅ 进度查询显示准确

---

#### 8.2.2 管理后台（Day 25-26）

| 页面 | 功能 |
|------|------|
| CampManage.vue | 训练营管理（表格 + CRUD） |
| MemberManage.vue | 会员管理（匹配状态筛选） |
| RefundManage.vue | 退款审核（批量操作、置信度显示） |
| Dashboard.vue | 统计报表（ECharts 图表） |

**验收标准**：
- ✅ 训练营 CRUD 正常
- ✅ 退款批量审核可用
- ✅ 统计图表显示正确

---

#### 8.2.3 系统管理（Day 26-27）

| 功能 | 说明 |
|------|------|
| 用户管理 | CRUD + 角色分配 |
| 配置管理 | 系统配置可更新 |
| 操作日志 | 敏感操作审计 |

**验收标准**：
- ✅ 用户管理完整
- ✅ 配置可修改
- ✅ 操作日志可查询

---

### 8.3 Stage 6 验收清单
- [ ] H5 会员端功能完整
- [ ] 管理后台功能完整
- [ ] 统计报表正常
- [ ] 系统管理功能可用

---

## 九、开发规范

### 9.1 Git 工作流
```bash
# 功能分支
git checkout -b feature/camp-management

# 提交规范
git commit -m "feat: 实现训练营创建功能"

# 分支合并
git checkout develop && git merge feature/camp-management
```

### 9.2 测试要求
| 类型 | 要求 |
|------|------|
| 单元测试 | 核心业务逻辑必须有，覆盖率 ≥ 80% |
| 集成测试 | 每个接口都要用 Postman 测试 |
| 端到端测试 | 每个 Stage 结束后运行完整流程 |

### 9.3 代码审查清单
- [ ] 代码是否符合项目规范？
- [ ] 是否有单元测试？
- [ ] 错误处理是否完善？
- [ ] 状态变更是否记录到日志表？

---

## 十、关键里程碑检查点

| 时间点 | 检查内容 | 交付物 |
|--------|---------|--------|
| Day 3 | Stage 0 完成 | 可运行的前后端骨架 + 16 张表 |
| Day 7 | Stage 1 完成 | JWT 认证 + 训练营管理 |
| Day 12 | Stage 2 完成 | 支付流程 + 混合绑定机制 |
| Day 16 | Stage 3 完成 | 打卡数据同步 |
| Day 19 | Stage 4 完成 | 匹配算法 |
| Day 23 | Stage 5 完成 | 退款流程 |
| Day 27 | Stage 6 完成 | 前端 + 系统管理 → 上线 |

---

## 十一、风险管理

| 风险 | 应对措施 |
|------|---------|
| 技术难点卡壳 | 最多尝试 3 次，然后调整方案 |
| 知识星球 Cookie 过期 | Cookie 失效告警 + 手动更新 |
| 微信支付对接问题 | 准备沙箱测试环境 |
| 时间不足 | 砍掉非核心功能，后续迭代补充 |

---

## 十二、成功标准

### 12.1 功能完整性
- [ ] 所有核心功能正常运行
- [ ] 完整业务流程：创建训练营 → 报名支付 → 同步打卡 → 退款审核 → 退款成功

### 12.2 匹配准确率
- [ ] 动态二维码匹配：100%
- [ ] 用户填写匹配：95%
- [ ] 智能匹配：≥ 70%
- [ ] 整体匹配成功率：≥ 95%

### 12.3 性能指标
- [ ] H5 页面首屏加载 < 2 秒
- [ ] 管理后台响应 < 1 秒
- [ ] 支持单训练营 1000 人并发

---

## 附录：Stage 依赖关系

```
Stage 0（环境搭建）
    │
    ▼
Stage 1（基础框架）──────────────┐
    │                          │
    ▼                          ▼
Stage 2（支付集成）          Stage 6（前端开发）
    │                          ▲
    ▼                          │
Stage 3（打卡同步）            │
    │                          │
    ▼                          │
Stage 4（匹配算法）            │
    │                          │
    ▼                          │
Stage 5（退款流程）────────────┘
```

---