# EP01: 训练营管理

## Epic 概述

| 字段 | 内容 |
|------|------|
| **Epic ID** | EP01 |
| **Epic 名称** | 训练营管理 |
| **业务目标** | 管理员能够完整管理训练营的生命周期 |
| **涉及角色** | 超级管理员、管理员 |
| **优先级** | P0 |

---

## Story 1.1: 创建训练营

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.1 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够创建一个新的训练营 |
| **价值** | 以便于开始新一期的训练营招募 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 创建训练营
  作为一名管理员
  我希望能够创建一个新的训练营
  以便于开始新一期的训练营招募

  Background:
    Given 管理员已登录系统
    And 管理员具有创建训练营权限

  Scenario: 成功创建训练营
    Given 填写训练营名称为 "21天早起打卡训练营"
    And 填写押金金额为 99 元
    And 填写打卡要求为 15 天
    And 填写训练营总天数为 21 天
    And 填写开始日期为 "2025-01-01"
    And 填写结束日期为 "2025-01-21"
    When 点击创建按钮
    Then 训练营创建成功
    And 返回训练营ID
    And 训练营状态为 "草稿"

  Scenario: 训练营名称重复
    Given 已存在名为 "21天早起打卡训练营" 的训练营
    And 填写训练营名称为 "21天早起打卡训练营"
    When 点击创建按钮
    Then 返回错误 "训练营名称已存在"

  Scenario: 必填项缺失
    Given 训练营名称为空
    When 点击创建按钮
    Then 返回错误 "请填写训练营名称"

  Scenario: 日期校验失败
    Given 填写开始日期为 "2025-01-21"
    And 填写结束日期为 "2025-01-01"
    When 点击创建按钮
    Then 返回错误 "结束日期不能早于开始日期"

  Scenario: 打卡天数超过总天数
    Given 填写打卡要求为 25 天
    And 填写训练营总天数为 21 天
    When 点击创建按钮
    Then 返回错误 "打卡要求不能超过训练营总天数"
```

### 任务拆分

- [ ] Task 1.1.1: 设计训练营表结构
- [ ] Task 1.1.2: 实现 CampController.create 接口
- [ ] Task 1.1.3: 实现 CampService.createCamp 方法
- [ ] Task 1.1.4: 实现参数校验（Validation）
- [ ] Task 1.1.5: 编写单元测试
- [ ] Task 1.1.6: 编写集成测试

---

## Story 1.2: 编辑训练营

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.2 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够编辑草稿状态的训练营 |
| **价值** | 以便于完善训练营信息 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 编辑训练营
  作为一名管理员
  我希望能够编辑草稿状态的训练营
  以便于完善训练营信息

  Scenario: 成功编辑草稿训练营
    Given 训练营状态为 "草稿"
    And 修改训练营名称为 "21天早起打卡训练营-第2期"
    When 点击保存按钮
    Then 训练营更新成功

  Scenario: 编辑已发布训练营
    Given 训练营状态为 "报名中"
    When 尝试编辑训练营
    Then 返回错误 "已发布的训练营不可编辑"

  Scenario: 编辑进行中训练营
    Given 训练营状态为 "进行中"
    When 尝试编辑训练营
    Then 返回错误 "进行中的训练营不可编辑"
```

### 任务拆分

- [ ] Task 1.2.1: 实现 CampController.update 接口
- [ ] Task 1.2.2: 实现状态校验逻辑
- [ ] Task 1.2.3: 编写测试用例

---

## Story 1.3: 发布训练营

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.3 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够发布训练营 |
| **价值** | 以便于会员可以报名参加 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 发布训练营
  作为一名管理员
  我希望能够发布训练营
  以便于会员可以报名参加

  Scenario: 成功发布训练营
    Given 训练营状态为 "待发布"
    And 训练营信息完整
    When 点击发布按钮
    Then 训练营状态变为 "报名中"
    And 生成报名二维码

  Scenario: 信息不完整时发布
    Given 训练营状态为 "草稿"
    And 群二维码未上传
    When 点击发布按钮
    Then 返回错误 "请上传群二维码"

  Scenario: 发布已过期训练营
    Given 训练营开始日期已过
    When 点击发布按钮
    Then 返回错误 "训练营开始日期已过，无法发布"
```

### 任务拆分

- [ ] Task 1.3.1: 实现 CampController.publish 接口
- [ ] Task 1.3.2: 实现完整性校验
- [ ] Task 1.3.3: 实现二维码生成
- [ ] Task 1.3.4: 编写测试用例

---

## Story 1.4: 查看训练营列表

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.4 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够查看所有训练营列表 |
| **价值** | 以便于了解训练营整体情况 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 查看训练营列表
  作为一名管理员
  我希望能够查看所有训练营列表
  以便于了解训练营整体情况

  Scenario: 查看全部列表
    Given 系统中存在 20 个训练营
    When 访问训练营列表页
    Then 返回分页列表
    And 每页显示 10 条
    And 按创建时间倒序排列

  Scenario: 按状态筛选
    Given 选择状态筛选为 "进行中"
    When 查询列表
    Then 只返回状态为 "进行中" 的训练营

  Scenario: 按名称搜索
    Given 输入搜索关键词 "早起"
    When 查询列表
    Then 返回名称包含 "早起" 的训练营
```

### 任务拆分

- [ ] Task 1.4.1: 实现 CampController.list 接口
- [ ] Task 1.4.2: 实现分页和筛选
- [ ] Task 1.4.3: 编写测试用例

---

## Story 1.5: 查看训练营详情

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.5 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够查看训练营详情 |
| **价值** | 以便于了解训练营具体信息和统计数据 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 查看训练营详情
  作为一名管理员
  我希望能够查看训练营详情
  以便于了解训练营具体信息和统计数据

  Scenario: 查看详情
    Given 训练营ID为 1
    When 访问详情页
    Then 返回训练营基本信息
    And 返回报名人数统计
    And 返回打卡进度统计
    And 返回退款状态统计

  Scenario: 训练营不存在
    Given 训练营ID为 999
    When 访问详情页
    Then 返回错误 "训练营不存在"
```

### 任务拆分

- [ ] Task 1.5.1: 实现 CampController.getDetail 接口
- [ ] Task 1.5.2: 实现统计数据聚合
- [ ] Task 1.5.3: 编写测试用例

---

## Story 1.6: 触发结算与归档

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.6 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够对已结束的训练营触发结算并最终归档 |
| **价值** | 以便于完成退款流程并保持列表整洁 |
| **优先级** | P0 |

### 验收标准

```gherkin
Feature: 触发结算与归档
  作为一名管理员
  我希望能够对已结束的训练营触发结算并最终归档
  以便于完成退款流程并保持列表整洁

  Scenario: 成功触发结算
    Given 训练营状态为 "已结束"
    When 点击开始结算按钮
    Then 训练营状态变为 "结算中"
    And 系统生成待处理的退款记录

  Scenario: 成功归档
    Given 训练营状态为 "结算中"
    And 所有退款已处理完成
    When 点击归档按钮
    Then 训练营状态变为 "已归档"

  Scenario: 未完成退款时归档
    Given 训练营状态为 "结算中"
    And 存在未处理的退款
    When 点击归档按钮
    Then 返回错误 "存在未处理的退款，无法归档"

  Scenario: 未触发结算时归档
    Given 训练营状态为 "已结束"
    When 点击归档按钮
    Then 返回错误 "请先触发结算流程"
```

### 任务拆分

- [ ] Task 1.6.1: 实现 CampController.startSettlement 接口（触发结算）
- [ ] Task 1.6.2: 实现 CampController.archive 接口（归档）
- [ ] Task 1.6.3: 实现前置校验和退款记录生成逻辑
- [ ] Task 1.6.4: 编写测试用例

---

## Story 1.7: 撤回发布

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.7 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够撤回待发布状态的训练营 |
| **价值** | 以便于返回草稿状态进行修改 |
| **优先级** | P1 |

### 验收标准

```gherkin
Feature: 撤回发布
  作为一名管理员
  我希望能够撤回待发布状态的训练营
  以便于返回草稿状态进行修改

  Scenario: 成功撤回
    Given 训练营状态为 "待发布"
    When 点击撤回按钮
    Then 训练营状态变为 "草稿"

  Scenario: 已发布无法撤回
    Given 训练营状态为 "报名中"
    When 尝试撤回
    Then 返回错误 "已发布的训练营无法撤回"
```

### 任务拆分

- [ ] Task 1.7.1: 实现 CampController.withdraw 接口
- [ ] Task 1.7.2: 实现状态校验逻辑
- [ ] Task 1.7.3: 编写测试用例

---

## Story 1.8: 删除草稿训练营

| 字段 | 内容 |
|------|------|
| **Story ID** | S1.8 |
| **角色** | 作为一名管理员 |
| **目标** | 我希望能够删除草稿状态的训练营 |
| **价值** | 以便于清理无用的草稿数据 |
| **优先级** | P2 |

### 验收标准

```gherkin
Feature: 删除草稿训练营
  作为一名管理员
  我希望能够删除草稿状态的训练营
  以便于清理无用的草稿数据

  Scenario: 成功删除草稿
    Given 训练营状态为 "草稿"
    When 点击删除按钮
    And 确认删除操作
    Then 训练营被删除（软删除）

  Scenario: 非草稿状态无法删除
    Given 训练营状态为 "报名中"
    When 尝试删除
    Then 返回错误 "只有草稿状态的训练营可以删除"
```

### 任务拆分

- [ ] Task 1.8.1: 实现 CampController.delete 接口
- [ ] Task 1.8.2: 实现状态校验和软删除逻辑
- [ ] Task 1.8.3: 编写测试用例

---

## 相关文档

- [技术方案](../design/技术方案.md)
- [状态枚举定义](../design/状态枚举定义.md)
- [EP02: 会员报名支付](./EP02-会员报名与支付.md)
