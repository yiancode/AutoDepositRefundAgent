# çŠ¶æ€æšä¸¾å®šä¹‰

> **æ–‡æ¡£ç›®çš„**ï¼šç»Ÿä¸€å®šä¹‰ç³»ç»Ÿä¸­æ‰€æœ‰çŠ¶æ€æšä¸¾å€¼ï¼Œç¡®ä¿å‰åç«¯ã€æ•°æ®åº“ã€æ–‡æ¡£çš„ä¸€è‡´æ€§
> **ç»´æŠ¤åŸåˆ™**ï¼šæœ¬æ–‡æ¡£ä¸º**å•ä¸€æ•°æ®æº(SSOT)**ï¼Œå…¶ä»–æ–‡æ¡£å¼•ç”¨æ­¤å¤„å®šä¹‰

---

## ğŸ“‹ æ ¸å¿ƒçŠ¶æ€æšä¸¾

### 1. bind_status - æ”¯ä»˜ç»‘å®šçŠ¶æ€

**æ•°æ®åº“å­—æ®µ**: `payment_record.bind_status`
**Javaæšä¸¾**: `com.camp.enums.BindStatus`
**å‰ç«¯æšä¸¾**: `src/enums/bindStatus.ts`

| æšä¸¾å€¼ | å«ä¹‰ | è§¦å‘æ¡ä»¶ | åç»­æ“ä½œ |
|--------|------|---------|---------|
| `pending` | å¾…ç»‘å®š | æ”¯ä»˜æˆåŠŸï¼Œ7å¤©å†…å¾…ç”¨æˆ·ä¸»åŠ¨ç»‘å®š | ç”¨æˆ·ç»‘å®š æˆ– 7å¤©åè½¬expired |
| `completed` | å·²å®Œæˆ | â‘  ç”¨æˆ·ä¸»åŠ¨ç»‘å®š<br>â‘¡ æ™ºèƒ½åŒ¹é…æˆåŠŸ<br>â‘¢ äººå·¥å®¡æ ¸é€šè¿‡ | æ— ï¼ˆç»ˆæ€ï¼‰ |
| `expired` | å·²è¿‡æœŸ | æ”¯ä»˜å7å¤©æœªç»‘å®š | åŠ å…¥æ™ºèƒ½åŒ¹é…é˜Ÿåˆ— |
| `manual_review` | å¾…äººå·¥å®¡æ ¸ | æ™ºèƒ½åŒ¹é…ç½®ä¿¡åº¦50-79% | ç®¡ç†å‘˜å®¡æ ¸ |
| `closed` | å·²å…³é—­ | äººå·¥å®¡æ ¸åˆ¤å®šæ— æ³•åŒ¹é… | æ— ï¼ˆç»ˆæ€ï¼‰ |

#### çŠ¶æ€æœºå›¾

```mermaid
stateDiagram-v2
    [*] --> pending: æ”¯ä»˜æˆåŠŸ
    pending --> completed: ç”¨æˆ·ä¸»åŠ¨ç»‘å®š
    pending --> expired: è¶…è¿‡7å¤©æœªç»‘å®š
    expired --> completed: æ™ºèƒ½åŒ¹é…æˆåŠŸ(â‰¥80%)
    expired --> manual_review: æ™ºèƒ½åŒ¹é…ä½ç½®ä¿¡åº¦(50-79%)
    manual_review --> completed: äººå·¥å®¡æ ¸é€šè¿‡
    manual_review --> closed: äººå·¥å®¡æ ¸æ‹’ç»
    completed --> [*]
    closed --> [*]

    note right of pending
        â° bind_deadline = æ”¯ä»˜æˆåŠŸ + 7å¤©
        ğŸ”‘ accessTokençŠ¶æ€ = active
        ğŸ“ ç”¨æˆ·å¯ä¸»åŠ¨ç»‘å®šæ˜Ÿçƒè´¦å·
    end note

    note right of completed
        âœ… å·²å…³è”æ˜Ÿçƒç”¨æˆ·
        ğŸ”‘ accessTokençŠ¶æ€ = bound
        ğŸ“ å¯æŸ¥çœ‹ç¾¤äºŒç»´ç 
    end note

    note right of expired
        âš ï¸ è¶…æ—¶æœªç»‘å®š
        ğŸ¤– è‡ªåŠ¨åŠ å…¥æ™ºèƒ½åŒ¹é…é˜Ÿåˆ—
        ğŸ“ ç³»ç»Ÿå°è¯•è‡ªåŠ¨åŒ¹é…
    end note

    note right of manual_review
        ğŸ‘¤ éœ€è¦ç®¡ç†å‘˜åˆ¤æ–­
        ğŸ“Š åŒ¹é…ç½®ä¿¡åº¦: 50-79%
        ğŸ“ å¾…ç®¡ç†åå°å®¡æ ¸
    end note
```

#### çŠ¶æ€è½¬æ¢è§„åˆ™

| ä»çŠ¶æ€ | åˆ°çŠ¶æ€ | æ¡ä»¶ | è§¦å‘è€… | bind_method |
|--------|--------|------|--------|-------------|
| pending | completed | ç”¨æˆ·å¡«å†™æ˜Ÿçƒä¿¡æ¯ | ç”¨æˆ·H5æ“ä½œ | `user_fill` |
| pending | expired | NOW() > bind_deadline | å®šæ—¶ä»»åŠ¡(æ¯æ—¥02:00) | ä¿æŒNULL |
| expired | completed | æ™ºèƒ½åŒ¹é…ç½®ä¿¡åº¦â‰¥80% | åŒ¹é…ä»»åŠ¡ | `smart_match` |
| expired | manual_review | æ™ºèƒ½åŒ¹é…ç½®ä¿¡åº¦50-79% | åŒ¹é…ä»»åŠ¡ | ä¿æŒNULL |
| manual_review | completed | ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ | ç®¡ç†å‘˜ | `manual` |
| manual_review | closed | ç®¡ç†å‘˜å®¡æ ¸æ‹’ç» | ç®¡ç†å‘˜ | ä¿æŒNULL |

#### Javaæšä¸¾å®šä¹‰

```java
// src/main/java/com/camp/enums/BindStatus.java
package com.camp.enums;

import com.baomidou.mybatisplus.annotation.EnumValue;
import com.fasterxml.jackson.annotation.JsonValue;
import lombok.Getter;

@Getter
public enum BindStatus {
    PENDING("pending", "å¾…ç»‘å®š"),
    COMPLETED("completed", "å·²å®Œæˆ"),
    EXPIRED("expired", "å·²è¿‡æœŸ"),
    MANUAL_REVIEW("manual_review", "å¾…äººå·¥å®¡æ ¸"),
    CLOSED("closed", "å·²å…³é—­");

    @EnumValue
    @JsonValue
    private final String value;
    private final String description;

    BindStatus(String value, String description) {
        this.value = value;
        this.description = description;
    }

    public static BindStatus fromValue(String value) {
        for (BindStatus status : values()) {
            if (status.value.equals(value)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Unknown bind_status: " + value);
    }
}
```

#### TypeScriptæšä¸¾å®šä¹‰

```typescript
// frontend/h5-member/src/enums/bindStatus.ts
export enum BindStatus {
  PENDING = 'pending',
  COMPLETED = 'completed',
  EXPIRED = 'expired',
  MANUAL_REVIEW = 'manual_review',
  CLOSED = 'closed'
}

export const BindStatusLabels: Record<BindStatus, string> = {
  [BindStatus.PENDING]: 'å¾…ç»‘å®š',
  [BindStatus.COMPLETED]: 'å·²å®Œæˆ',
  [BindStatus.EXPIRED]: 'å·²è¿‡æœŸ',
  [BindStatus.MANUAL_REVIEW]: 'å¾…äººå·¥å®¡æ ¸',
  [BindStatus.CLOSED]: 'å·²å…³é—­'
}

export const BindStatusColors: Record<BindStatus, string> = {
  [BindStatus.PENDING]: 'warning',
  [BindStatus.COMPLETED]: 'success',
  [BindStatus.EXPIRED]: 'danger',
  [BindStatus.MANUAL_REVIEW]: 'primary',
  [BindStatus.CLOSED]: 'info'
}
```

---

### 2. pay_status - æ”¯ä»˜çŠ¶æ€

**æ•°æ®åº“å­—æ®µ**: `payment_record.pay_status`
**Javaæšä¸¾**: `com.camp.enums.PayStatus`

| æšä¸¾å€¼ | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| `PENDING` | å¾…æ”¯ä»˜ | è®¢å•å·²åˆ›å»ºï¼Œç­‰å¾…æ”¯ä»˜ |
| `SUCCESS` | æ”¯ä»˜æˆåŠŸ | å¾®ä¿¡æ”¯ä»˜å›è°ƒç¡®è®¤ |
| `FAILED` | æ”¯ä»˜å¤±è´¥ | å¾®ä¿¡æ”¯ä»˜å¤±è´¥æˆ–è®¢å•è¶…æ—¶ |
| `REFUNDED` | å·²é€€æ¬¾ | é€€æ¬¾æˆåŠŸåæ›´æ–° |

**æ³¨æ„**ï¼š`pay_status` ä½¿ç”¨å¤§å†™æšä¸¾ï¼ˆç¬¦åˆJavaå¸¸é‡å‘½åè§„èŒƒï¼‰ï¼Œä¸ `bind_status` çš„å°å†™é£æ ¼ä¸åŒï¼Œè¿™æ˜¯**å†å²é—ç•™é—®é¢˜**ã€‚å»ºè®®æ–°é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨å°å†™ã€‚

#### Javaæšä¸¾å®šä¹‰

```java
package com.camp.enums;

import com.baomidou.mybatisplus.annotation.EnumValue;
import lombok.Getter;

@Getter
public enum PayStatus {
    PENDING("PENDING", "å¾…æ”¯ä»˜"),
    SUCCESS("SUCCESS", "æ”¯ä»˜æˆåŠŸ"),
    FAILED("FAILED", "æ”¯ä»˜å¤±è´¥"),
    REFUNDED("REFUNDED", "å·²é€€æ¬¾");

    @EnumValue
    private final String value;
    private final String description;

    PayStatus(String value, String description) {
        this.value = value;
        this.description = description;
    }
}
```

---

### 3. bind_method - ç»‘å®šæ–¹å¼

**æ•°æ®åº“å­—æ®µ**: `payment_record.bind_method`
**Javaæšä¸¾**: `com.camp.enums.BindMethod`

| æšä¸¾å€¼ | å«ä¹‰ | è§¦å‘åœºæ™¯ | ç½®ä¿¡åº¦ |
|--------|------|---------|--------|
| `user_fill` | ç”¨æˆ·å¡«å†™ | æ”¯ä»˜åç”¨æˆ·ä¸»åŠ¨å¡«å†™æ˜Ÿçƒä¿¡æ¯ | 100% |
| `smart_match` | æ™ºèƒ½åŒ¹é… | ç³»ç»Ÿé€šè¿‡ç®—æ³•åŒ¹é… | â‰¥80% |
| `manual` | äººå·¥åŒ¹é… | ç®¡ç†å‘˜æ‰‹åŠ¨å…³è” | 100% |

**NULLå€¼å«ä¹‰**ï¼šæœªå®Œæˆç»‘å®šï¼ˆbind_status=pending/expired/manual_reviewæ—¶ï¼‰

#### Javaæšä¸¾å®šä¹‰

```java
package com.camp.enums;

import com.baomidou.mybatisplus.annotation.EnumValue;
import lombok.Getter;

@Getter
public enum BindMethod {
    USER_FILL("user_fill", "ç”¨æˆ·å¡«å†™"),
    SMART_MATCH("smart_match", "æ™ºèƒ½åŒ¹é…"),
    MANUAL("manual", "äººå·¥åŒ¹é…");

    @EnumValue
    private final String value;
    private final String description;

    BindMethod(String value, String description) {
        this.value = value;
        this.description = description;
    }
}
```

---

### 4. refund_status - é€€æ¬¾çŠ¶æ€

**æ•°æ®åº“å­—æ®µ**: `refund_record.refund_status`
**Javaæšä¸¾**: `com.camp.enums.RefundStatus`

| æšä¸¾å€¼ | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| `PENDING` | å¾…å¤„ç† | é€€æ¬¾ç”³è¯·å·²åˆ›å»ºï¼Œå¾…å®¡æ ¸ |
| `APPROVED` | å®¡æ ¸é€šè¿‡ | ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ï¼Œå¾…æ‰§è¡Œé€€æ¬¾ |
| `REJECTED` | å®¡æ ¸æ‹’ç» | ç®¡ç†å‘˜æ‹’ç»é€€æ¬¾ç”³è¯· |
| `PROCESSING` | å¤„ç†ä¸­ | æ­£åœ¨è°ƒç”¨å¾®ä¿¡é€€æ¬¾API |
| `SUCCESS` | é€€æ¬¾æˆåŠŸ | å¾®ä¿¡é€€æ¬¾å®Œæˆ |
| `FAILED` | é€€æ¬¾å¤±è´¥ | å¾®ä¿¡é€€æ¬¾å¤±è´¥ï¼Œå¾…é‡è¯• |

#### çŠ¶æ€æœºå›¾

```mermaid
stateDiagram-v2
    [*] --> PENDING: åˆ›å»ºé€€æ¬¾ç”³è¯·
    PENDING --> APPROVED: ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡
    PENDING --> REJECTED: ç®¡ç†å‘˜å®¡æ ¸æ‹’ç»
    APPROVED --> PROCESSING: è°ƒç”¨å¾®ä¿¡é€€æ¬¾API
    PROCESSING --> SUCCESS: é€€æ¬¾æˆåŠŸ
    PROCESSING --> FAILED: é€€æ¬¾å¤±è´¥
    FAILED --> PROCESSING: é‡è¯•(æœ€å¤š3æ¬¡)
    SUCCESS --> [*]
    REJECTED --> [*]
    FAILED --> [*]: è¶…è¿‡é‡è¯•æ¬¡æ•°
```

---

### 5. camp_status - è®­ç»ƒè¥çŠ¶æ€

**æ•°æ®åº“å­—æ®µ**: `training_camp.status`
**Javaæšä¸¾**: `com.camp.enums.CampStatus`

| æšä¸¾å€¼ | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| `DRAFT` | è‰ç¨¿ | è®­ç»ƒè¥åˆ›å»ºä¸­ï¼Œæœªå‘å¸ƒ |
| `PENDING` | å¾…å‘å¸ƒ | ç¼–è¾‘å®Œæˆï¼Œç­‰å¾…å‘å¸ƒ |
| `ENROLLING` | æŠ¥åä¸­ | å·²å‘å¸ƒï¼Œæ¥å—æŠ¥å |
| `ONGOING` | è¿›è¡Œä¸­ | è®­ç»ƒè¥å·²å¼€å§‹ |
| `ENDED` | å·²ç»“æŸ | è®­ç»ƒè¥ç»“æŸï¼Œç­‰å¾…ç»“ç®— |
| `SETTLING` | ç»“ç®—ä¸­ | æ­£åœ¨å¤„ç†é€€æ¬¾ |
| `ARCHIVED` | å·²å½’æ¡£ | é€€æ¬¾å®Œæˆï¼Œå·²å½’æ¡£ |

#### çŠ¶æ€æœºå›¾

```mermaid
stateDiagram-v2
    [*] --> DRAFT: åˆ›å»ºè®­ç»ƒè¥
    DRAFT --> PENDING: ç¼–è¾‘å®Œæˆ
    PENDING --> ENROLLING: ç®¡ç†å‘˜å‘å¸ƒ
    ENROLLING --> ONGOING: åˆ°è¾¾å¼€å§‹æ—¥æœŸ(å®šæ—¶ä»»åŠ¡)
    ONGOING --> ENDED: åˆ°è¾¾ç»“æŸæ—¥æœŸ(å®šæ—¶ä»»åŠ¡)
    ENDED --> SETTLING: ç®¡ç†å‘˜è§¦å‘ç»“ç®—
    SETTLING --> ARCHIVED: é€€æ¬¾å®Œæˆ
    ARCHIVED --> [*]

    DRAFT --> DRAFT: ç¼–è¾‘ä¸­
    PENDING --> DRAFT: æ’¤å›ä¿®æ”¹
    ENROLLING --> ENROLLING: æŠ¥åä¸­
```

---

### 6. accessTokençŠ¶æ€

**å­˜å‚¨ä½ç½®**: Redis (`access_token:{token}`)
**æ•°æ®ç»“æ„**: JSON
```json
{
  "orderNo": "ord_xxx",
  "campId": 1,
  "wechatUserId": 10001,
  "status": "active",
  "expireAt": "2025-12-31T23:59:59"
}
```

| çŠ¶æ€å€¼ | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| `inactive` | æœªæ¿€æ´» | è®¢å•å·²åˆ›å»ºï¼Œæœªæ”¯ä»˜ |
| `active` | å·²æ¿€æ´» | æ”¯ä»˜æˆåŠŸï¼Œå¯ç”¨äºç»‘å®šæ“ä½œ |
| `bound` | å·²ç»‘å®š | ç»‘å®šå®Œæˆï¼Œä»…å¯æŸ¥è¯¢çŠ¶æ€ |
| `expired` | å·²è¿‡æœŸ | è¶…è¿‡æœ‰æ•ˆæœŸæˆ–è®­ç»ƒè¥ç»“æŸ+7å¤© |

#### çŠ¶æ€æœºå›¾

```mermaid
stateDiagram-v2
    [*] --> inactive: åˆ›å»ºè®¢å•
    inactive --> active: æ”¯ä»˜æˆåŠŸ
    active --> bound: ç»‘å®šå®Œæˆ
    active --> expired: è¶…è¿‡æœ‰æ•ˆæœŸ
    bound --> expired: è¶…è¿‡æœ‰æ•ˆæœŸ
    expired --> [*]

    note right of inactive
        æœªæ”¯ä»˜ï¼Œtokenä¸å¯ç”¨
    end note

    note right of active
        å·²æ”¯ä»˜ï¼Œå¯è¿›è¡Œç»‘å®šæ“ä½œ
        æœ‰æ•ˆæœŸï¼šè®­ç»ƒè¥ç»“æŸ + 7å¤©
    end note

    note right of bound
        å·²ç»‘å®šï¼Œä»…å¯æŸ¥è¯¢
        ä¸å¯é‡å¤ç»‘å®š
    end note
```

---

## ğŸ”’ æ•°æ®ä¸€è‡´æ€§çº¦æŸ

### 1. bind_status ä¸ bind_method çš„å…³è”è§„åˆ™

| bind_status | bind_method å…è®¸å€¼ | è¯´æ˜ |
|-------------|------------------|------|
| `pending` | NULL | æœªç»‘å®šï¼Œä¸å­˜åœ¨ç»‘å®šæ–¹å¼ |
| `completed` | `user_fill` / `smart_match` / `manual` | **å¿…å¡«**ï¼Œè®°å½•ç»‘å®šæ¥æº |
| `expired` | NULL | è¶…æ—¶æœªç»‘å®š |
| `manual_review` | NULL | å¾…å®¡æ ¸ï¼Œæœªç¡®å®šç»‘å®šæ–¹å¼ |
| `closed` | NULL | å·²å…³é—­ï¼Œæ— ç»‘å®šæ–¹å¼ |

### 2. pay_status ä¸ bind_status çš„å…³è”è§„åˆ™

| pay_status | bind_status å…è®¸å€¼ | è¯´æ˜ |
|------------|------------------|------|
| `PENDING` | ä¸å­˜åœ¨ | æœªæ”¯ä»˜æ—¶ä¸äº§ç”Ÿbind_status |
| `SUCCESS` | `pending` / `completed` / `expired` / `manual_review` / `closed` | æ”¯ä»˜æˆåŠŸåæ‰æœ‰ç»‘å®šçŠ¶æ€ |
| `FAILED` | ä¸å­˜åœ¨ | æ”¯ä»˜å¤±è´¥ï¼Œæ— ç»‘å®šæµç¨‹ |
| `REFUNDED` | ä»»æ„ | é€€æ¬¾ä¸å½±å“å·²æœ‰ç»‘å®šçŠ¶æ€ |

### 3. æ•°æ®åº“çº¦æŸå»ºè®®

```sql
-- payment_recordè¡¨çº¦æŸ
ALTER TABLE payment_record
ADD CONSTRAINT chk_bind_status CHECK (
    bind_status IN ('pending', 'completed', 'expired', 'manual_review', 'closed')
);

ALTER TABLE payment_record
ADD CONSTRAINT chk_bind_method CHECK (
    bind_method IN ('user_fill', 'smart_match', 'manual') OR bind_method IS NULL
);

ALTER TABLE payment_record
ADD CONSTRAINT chk_pay_status CHECK (
    pay_status IN ('PENDING', 'SUCCESS', 'FAILED', 'REFUNDED')
);

-- ä¸šåŠ¡é€»è¾‘çº¦æŸï¼ˆåº”ç”¨å±‚ä¿è¯ï¼‰
-- è§„åˆ™ï¼šbind_status=completed æ—¶ bind_method å¿…é¡»éNULL
-- è§„åˆ™ï¼šbind_status!=completed æ—¶ bind_method å¿…é¡»ä¸ºNULL
```

---

## ğŸ“ æ¥å£å“åº”ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæŸ¥è¯¢è®¢å•çŠ¶æ€ï¼ˆå¾…ç»‘å®šï¼‰

```json
GET /api/h5/orders/ord_123/status

Response:
{
  "code": 200,
  "data": {
    "orderNo": "ord_123",
    "payStatus": "SUCCESS",
    "bindStatus": "pending",
    "bindMethod": null,
    "remainingBindTime": 518400,  // 6å¤©(ç§’)
    "bindDeadline": "2025-12-10T23:59:59",
    "campName": "21å¤©æ—©èµ·è®­ç»ƒè¥",
    "amount": 99.00,
    "accessToken": "tk_xxx",
    "bindingUrl": "/bind?token=tk_xxx"
  }
}
```

### ç¤ºä¾‹2ï¼šæŸ¥è¯¢è®¢å•çŠ¶æ€ï¼ˆå·²å®Œæˆï¼‰

```json
GET /api/h5/orders/ord_456/status

Response:
{
  "code": 200,
  "data": {
    "orderNo": "ord_456",
    "payStatus": "SUCCESS",
    "bindStatus": "completed",
    "bindMethod": "user_fill",
    "boundAt": "2025-12-04T15:30:00",
    "planetUserId": "123456789",
    "planetNickname": "å°æ˜",
    "groupQrcodeUrl": "https://cdn.example.com/qrcode.jpg",
    "campName": "21å¤©æ—©èµ·è®­ç»ƒè¥",
    "amount": 99.00
  }
}
```

### ç¤ºä¾‹3ï¼šç®¡ç†åå°ä¼šå‘˜åˆ—è¡¨ï¼ˆåŒ…å«åŒ¹é…çŠ¶æ€ï¼‰

```json
GET /api/admin/camps/1/members

Response:
{
  "code": 200,
  "data": {
    "items": [
      {
        "memberId": 10001,
        "wechatNickname": "å°æ˜åŒå­¦",
        "planetNickname": "å°æ˜",
        "bindStatus": "completed",
        "bindMethod": "user_fill",
        "matchConfidence": 100,
        "payAmount": 99.00,
        "checkinCount": 18,
        "eligibleForRefund": false
      },
      {
        "memberId": 10002,
        "wechatNickname": "å°çº¢",
        "planetNickname": null,
        "bindStatus": "manual_review",
        "bindMethod": null,
        "matchConfidence": 65,
        "payAmount": 99.00,
        "checkinCount": 20,
        "eligibleForRefund": true
      }
    ],
    "total": 2,
    "page": 1,
    "pageSize": 20
  }
}
```

---

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯1ï¼šä½¿ç”¨éæ ‡å‡†çŠ¶æ€å€¼

```diff
- "bindStatus": "success"  // âŒ é”™è¯¯ï¼šsuccessä¸æ˜¯æ ‡å‡†å€¼
+ "bindStatus": "completed"  // âœ… æ­£ç¡®ï¼šä½¿ç”¨completed
```

### é”™è¯¯2ï¼šbind_status=completedä½†bind_methodä¸ºNULL

```diff
{
  "bindStatus": "completed",
- "bindMethod": null  // âŒ é”™è¯¯ï¼šå®ŒæˆçŠ¶æ€å¿…é¡»æœ‰ç»‘å®šæ–¹å¼
+ "bindMethod": "user_fill"  // âœ… æ­£ç¡®
}
```

### é”™è¯¯3ï¼šbind_status=pendingä½†bind_methodæœ‰å€¼

```diff
{
  "bindStatus": "pending",
- "bindMethod": "user_fill"  // âŒ é”™è¯¯ï¼šæœªå®Œæˆä¸åº”æœ‰ç»‘å®šæ–¹å¼
+ "bindMethod": null  // âœ… æ­£ç¡®
}
```

### é”™è¯¯4ï¼šæ··æ·†pay_statuså’Œbind_status

```diff
// payment_recordè¡¨
{
- "pay_status": "completed",  // âŒ é”™è¯¯ï¼špay_statusåº”ä¸ºSUCCESS
+ "pay_status": "SUCCESS",  // âœ… æ­£ç¡®
  "bind_status": "completed"  // âœ… æ­£ç¡®
}
```

---

## ğŸ”„ çŠ¶æ€å˜æ›´æ—¥å¿—è¡¨

æ‰€æœ‰çŠ¶æ€å˜æ›´å¿…é¡»è®°å½•åˆ°å¯¹åº”çš„çŠ¶æ€æ—¥å¿—è¡¨ï¼š

| ä¸šåŠ¡çŠ¶æ€ | æ—¥å¿—è¡¨ | è®°å½•å­—æ®µ |
|---------|--------|---------|
| bind_status | `payment_bind_status_log` | from_status, to_status, bind_method, operator_id, reason |
| camp_status | `camp_status_log` | from_status, to_status, event, operator_id |
| refund_status | `refund_status_log` | from_status, to_status, operator_id, remark |
| pay_status | `payment_status_log` | from_status, to_status, transaction_id |

**æ—¥å¿—è®°å½•ç¤ºä¾‹**ï¼š

```java
// è®°å½•bind_statuså˜æ›´
PaymentBindStatusLog log = PaymentBindStatusLog.builder()
    .paymentRecordId(paymentRecord.getId())
    .fromStatus(BindStatus.PENDING)
    .toStatus(BindStatus.COMPLETED)
    .bindMethod(BindMethod.USER_FILL)
    .operatorId(userId)
    .reason("ç”¨æˆ·ä¸»åŠ¨ç»‘å®š")
    .build();
bindStatusLogMapper.insert(log);
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æŠ€æœ¯æ–¹æ¡ˆ - 5.4.1 çŠ¶æ€æœºè®¾è®¡](./æŠ€æœ¯æ–¹æ¡ˆ.md#541-çŠ¶æ€æœºè®¾è®¡)
- [æ•°æ®åº“è®¾è®¡ - payment_recordè¡¨](./æ•°æ®åº“è®¾è®¡.md#42-payment_record-æ”¯ä»˜è®°å½•è¡¨)
- [æ¥å£æ–‡æ¡£ - 1.5 çŠ¶æ€æšä¸¾](./æ¥å£æ–‡æ¡£.md#15-çŠ¶æ€æšä¸¾)
- [è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£ - P0-3](./è®¾è®¡ä¼˜åŒ–å†³ç­–æ–‡æ¡£.md#p0-3bind_status-çŠ¶æ€å®šä¹‰ä¸ä¸€è‡´)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-12-04
**ç»´æŠ¤è€…**ï¼šæŠ€æœ¯æ¶æ„ç»„
**å˜æ›´å†å²**ï¼š
- 2025-12-04: åˆå§‹ç‰ˆæœ¬ï¼Œç»Ÿä¸€å®šä¹‰æ‰€æœ‰çŠ¶æ€æšä¸¾
