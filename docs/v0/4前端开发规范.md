# 前端开发规范 - Vue 3 项目

## 📋 文档信息
- **版本**: v1.0
- **创建日期**: 2025-10-27
- **适用项目**: 知识星球训练营退款系统 v0
- **技术栈**: Vue 3.3+ / Vite 5.x / Element Plus 2.4+
- **参考标准**: Vue 官方风格指南 + 阿里巴巴前端规约

---

## 目录

- [一、编程规约](#一编程规约)
- [二、Vue 3 编码规范](#二vue-3-编码规范)
- [三、命名规范](#三命名规范)
- [四、注释规范](#四注释规范)
- [五、组件规范](#五组件规范)
- [六、状态管理规范](#六状态管理规范)
- [七、API 调用规范](#七api-调用规范)
- [八、样式规范](#八样式规范)
- [九、测试规范](#九测试规范)
- [十、性能优化规范](#十性能优化规范)

---

## 一、编程规约

### 1.1 核心原则

#### ✅ 文档先行原则
- **【强制】** 开发新组件前,必须先编写组件文档(Props、Events、Slots)
- **【推荐】** 使用 JSDoc 或 TypeScript 声明组件接口

**示例**:
```vue
<script setup>
/**
 * 统计卡片组件
 *
 * @component StatisticsCard
 * @description 展示训练营退款统计数据
 *
 * @props {number} totalCount - 总人数
 * @props {number} qualifiedCount - 合格人数
 * @props {number} qualifiedRate - 合格率(百分比)
 *
 * @emits {void} refresh - 点击刷新按钮时触发
 *
 * @example
 * <StatisticsCard
 *   :total-count="99"
 *   :qualified-count="85"
 *   :qualified-rate="85.86"
 *   @refresh="handleRefresh"
 * />
 */
const props = defineProps({
  totalCount: { type: Number, required: true },
  qualifiedCount: { type: Number, required: true },
  qualifiedRate: { type: Number, required: true }
});

const emit = defineEmits(['refresh']);
</script>
```

---

#### ✅ 组件化开发原则
- **【强制】** 单个组件文件不超过 300 行代码
- **【推荐】** 复杂页面拆分为多个小组件
- **【推荐】** 通用组件提取到 `components/` 目录

**示例**:
```
// ❌ 错误: 单个文件600行
RefundList.vue (600 lines)

// ✅ 正确: 拆分为多个组件
RefundList.vue (150 lines)
  ├── StatisticsCard.vue (50 lines)
  ├── QualifiedNamesList.vue (80 lines)
  └── RefundTable.vue (120 lines)
```

---

#### ✅ 测试驱动开发(TDD)原则
- **【推荐】** 核心业务组件必须有单元测试
- **【推荐】** 使用 Vitest 或 Vue Test Utils 进行测试

**示例**:
```javascript
// StatisticsCard.test.js
import { mount } from '@vue/test-utils';
import StatisticsCard from '@/components/StatisticsCard.vue';

describe('StatisticsCard', () => {
  it('应该正确显示统计数据', () => {
    const wrapper = mount(StatisticsCard, {
      props: {
        totalCount: 99,
        qualifiedCount: 85,
        qualifiedRate: 85.86
      }
    });

    expect(wrapper.text()).toContain('99');
    expect(wrapper.text()).toContain('85');
    expect(wrapper.text()).toContain('85.86%');
  });

  it('点击刷新按钮应该触发 refresh 事件', async () => {
    const wrapper = mount(StatisticsCard, {
      props: { totalCount: 99, qualifiedCount: 85, qualifiedRate: 85.86 }
    });

    await wrapper.find('.refresh-btn').trigger('click');
    expect(wrapper.emitted('refresh')).toBeTruthy();
  });
});
```

---

### 1.2 基本编码规范

#### 【强制】使用 ESLint + Prettier
```json
// .eslintrc.cjs
module.exports = {
  extends: [
    'plugin:vue/vue3-recommended',
    'eslint:recommended',
    '@vue/prettier'
  ],
  rules: {
    'vue/multi-word-component-names': 'error',
    'vue/no-unused-vars': 'error',
    'vue/require-default-prop': 'warn',
    'prettier/prettier': 'error'
  }
};
```

---

## 二、Vue 3 编码规范

### 2.1 Composition API 规范

#### 【强制】优先使用 Composition API
```vue
<script setup>
// ✅ 推荐: 使用 Composition API
import { ref, computed, onMounted } from 'vue';

const count = ref(0);
const doubleCount = computed(() => count.value * 2);

onMounted(() => {
  console.log('组件已挂载');
});
</script>

<!-- ❌ 不推荐: Options API (除非有特殊需求) -->
<script>
export default {
  data() {
    return { count: 0 };
  },
  computed: {
    doubleCount() { return this.count * 2; }
  },
  mounted() {
    console.log('组件已挂载');
  }
};
</script>
```

---

#### 【强制】逻辑复用使用 Composables
```javascript
// composables/useRefundList.js
import { ref } from 'vue';
import { getRefundList } from '@/api/camps.api';

/**
 * 退款名单管理 Composable
 *
 * @param {Ref<number>} checkinId - 训练营ID
 * @returns {Object} 退款名单数据和方法
 */
export function useRefundList(checkinId) {
  const refundList = ref([]);
  const statistics = ref({});
  const loading = ref(false);

  const fetchRefundList = async (requiredDays) => {
    loading.value = true;
    try {
      const data = await getRefundList(checkinId.value, requiredDays);
      refundList.value = data.refund_list;
      statistics.value = data.statistics;
    } finally {
      loading.value = false;
    }
  };

  return {
    refundList,
    statistics,
    loading,
    fetchRefundList
  };
}
```

**使用**:
```vue
<script setup>
import { useRefundList } from '@/composables/useRefundList';

const checkinId = ref(123);
const { refundList, statistics, loading, fetchRefundList } = useRefundList(checkinId);
</script>
```

---

### 2.2 响应式数据规范

#### 【强制】使用 ref/reactive 正确声明响应式数据
```javascript
// ✅ 正确: 基本类型使用 ref
const count = ref(0);
const name = ref('张三');
const isLoading = ref(false);

// ✅ 正确: 对象类型可使用 reactive
const formData = reactive({
  username: '',
  password: ''
});

// ❌ 错误: 基本类型不能用 reactive
const count = reactive(0); // 错误!
```

#### 【推荐】解构 reactive 对象使用 toRefs
```javascript
// ✅ 正确
import { toRefs } from 'vue';

const state = reactive({ count: 0, name: '张三' });
const { count, name } = toRefs(state);

// ❌ 错误: 直接解构会丢失响应性
const { count, name } = state;
```

---

## 三、命名规范

### 3.1 文件命名

#### 【强制】组件文件使用大驼峰命名(PascalCase)
```
// ✅ 正确
CampList.vue
RefundList.vue
StatisticsCard.vue
ConfigDialog.vue

// ❌ 错误
campList.vue
refund-list.vue
statistics_card.vue
```

#### 【推荐】页面文件放在 views/ 目录
```
views/
├── CampList.vue        # 页面
└── RefundList.vue      # 页面

components/
├── StatisticsCard.vue  # 通用组件
└── ConfigDialog.vue    # 通用组件
```

---

### 3.2 变量命名

#### 【强制】响应式变量使用小驼峰命名
```javascript
// ✅ 正确
const userName = ref('');
const refundList = ref([]);
const isLoading = ref(false);

// ❌ 错误
const user_name = ref('');
const RefundList = ref([]);
```

#### 【推荐】常量使用全大写+下划线
```javascript
// ✅ 正确
const MAX_PAGE_SIZE = 100;
const API_BASE_URL = '/api';
const DEFAULT_REQUIRED_DAYS = 7;

// ❌ 错误
const maxPageSize = 100;
const apiBaseUrl = '/api';
```

---

### 3.3 组件命名

#### 【强制】组件名必须多个单词
```vue
<!-- ✅ 正确 -->
<template>
  <StatisticsCard />
  <RefundTable />
</template>

<!-- ❌ 错误: 单个单词 -->
<template>
  <Card />
  <Table />
</template>
```

#### 【推荐】基础组件使用 Base 前缀
```
components/
├── BaseButton.vue
├── BaseInput.vue
└── BaseTable.vue
```

---

## 四、注释规范

### 4.1 组件注释

#### 【强制】组件必须有描述注释
```vue
<script setup>
/**
 * 退款名单页面
 *
 * @component RefundList
 * @description 显示训练营的退款名单,支持数据总览、一键复制、导出Excel/图片
 *
 * @route /refund/:checkin_id
 * @param {string} checkin_id - 训练营ID(路由参数)
 * @query {string} title - 训练营名称
 * @query {number} total_days - 总天数
 *
 * @author 张三
 * @date 2025-10-27
 */
</script>
```

---

### 4.2 复杂逻辑注释

#### 【推荐】复杂逻辑添加行内注释
```javascript
const handleCalculate = async () => {
  // 校验: 完成天数不能超过总天数
  if (requiredDays.value > totalDays.value) {
    ElMessage.warning(`完成天数不能超过训练营总天数(${totalDays.value}天)`);
    return;
  }

  // 操作确认弹窗
  try {
    await ElMessageBox.confirm(
      `确定要按照 ${requiredDays.value} 天的标准生成退款名单吗?`,
      '操作确认',
      { type: 'warning' }
    );
  } catch {
    return; // 用户取消
  }

  // 调用接口生成退款名单
  loading.value = true;
  try {
    const data = await getRefundList(checkinId, requiredDays.value);
    refundList.value = data.refund_list;
    statistics.value = data.statistics;
    ElMessage.success('计算完成!');
  } finally {
    loading.value = false;
  }
};
```

---

## 五、组件规范

### 5.1 Props 规范

#### 【强制】Props 必须声明类型和默认值
```vue
<script setup>
// ✅ 正确: 完整的 Props 声明
const props = defineProps({
  totalCount: {
    type: Number,
    required: true,
    validator: (value) => value >= 0
  },
  title: {
    type: String,
    default: '未命名训练营'
  },
  showActions: {
    type: Boolean,
    default: false
  }
});

// ❌ 错误: 缺少类型声明
const props = defineProps({
  totalCount: Number, // 缺少 required/default
  title: String
});
</script>
```

---

### 5.2 Emits 规范

#### 【强制】Events 必须显式声明
```vue
<script setup>
// ✅ 正确: 声明所有事件
const emit = defineEmits(['refresh', 'delete', 'update']);

const handleRefresh = () => {
  emit('refresh');
};

// ❌ 错误: 未声明事件
const emit = defineEmits();
emit('unknownEvent'); // 不推荐
</script>
```

#### 【推荐】事件名使用短横线命名
```vue
<template>
  <!-- ✅ 正确 -->
  <button @click="emit('refresh-data')">刷新</button>
  <button @click="emit('update-status')">更新</button>

  <!-- ❌ 错误 -->
  <button @click="emit('refreshData')">刷新</button>
  <button @click="emit('updateStatus')">更新</button>
</template>
```

---

### 5.3 组件通信规范

#### 【强制】父子组件通信使用 Props + Emits
```vue
<!-- 父组件 -->
<template>
  <StatisticsCard
    :total-count="statistics.total_count"
    :qualified-count="statistics.qualified_count"
    @refresh="handleRefresh"
  />
</template>

<!-- 子组件 -->
<script setup>
const props = defineProps({
  totalCount: { type: Number, required: true },
  qualifiedCount: { type: Number, required: true }
});

const emit = defineEmits(['refresh']);
</script>
```

#### 【推荐】跨组件通信使用 Pinia
```javascript
// stores/refund.store.js
import { defineStore } from 'pinia';

export const useRefundStore = defineStore('refund', () => {
  const refundList = ref([]);
  const statistics = ref({});

  const setRefundList = (data) => {
    refundList.value = data.refund_list;
    statistics.value = data.statistics;
  };

  return {
    refundList,
    statistics,
    setRefundList
  };
});
```

---

## 六、状态管理规范

### 6.1 Pinia Store 规范

#### 【强制】Store 文件命名使用 xxx.store.js
```
stores/
├── user.store.js
├── refund.store.js
└── config.store.js
```

#### 【推荐】使用 Setup Store 风格
```javascript
// stores/refund.store.js
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import { getRefundList } from '@/api/camps.api';

export const useRefundStore = defineStore('refund', () => {
  // State
  const refundList = ref([]);
  const statistics = ref({});
  const loading = ref(false);

  // Getters
  const qualifiedList = computed(() =>
    refundList.value.filter(item => item.is_qualified)
  );

  // Actions
  const fetchRefundList = async (checkinId, requiredDays) => {
    loading.value = true;
    try {
      const data = await getRefundList(checkinId, requiredDays);
      refundList.value = data.refund_list;
      statistics.value = data.statistics;
    } finally {
      loading.value = false;
    }
  };

  return {
    refundList,
    statistics,
    loading,
    qualifiedList,
    fetchRefundList
  };
});
```

---

## 七、API 调用规范

### 7.1 API 封装规范

#### 【强制】所有 API 调用必须封装在 api/ 目录
```javascript
// api/camps.api.js
import request from './request';

/**
 * 获取训练营列表
 *
 * @param {string} scope - 状态筛选: ongoing/over/closed
 * @returns {Promise<Object>} 训练营列表
 */
export function getCamps(scope) {
  return request.get('/camps', { params: { scope } });
}

/**
 * 生成退款名单
 *
 * @param {number} checkinId - 训练营ID
 * @param {number} requiredDays - 要求打卡天数
 * @returns {Promise<Object>} 退款名单和统计数据
 */
export function getRefundList(checkinId, requiredDays) {
  return request.post(`/camps/${checkinId}/refund-list`, {
    required_days: requiredDays
  });
}
```

---

### 7.2 错误处理规范

#### 【强制】使用 Axios 拦截器统一处理错误
```javascript
// api/request.js
import axios from 'axios';
import { ElMessage } from 'element-plus';

const request = axios.create({
  baseURL: '/api',
  timeout: 30000
});

// 响应拦截器
request.interceptors.response.use(
  response => {
    const { code, message, data } = response.data;

    if (code === 200) {
      return data;
    } else {
      ElMessage.error(message || '请求失败');
      return Promise.reject(new Error(message));
    }
  },
  error => {
    if (error.response) {
      const { status, data } = error.response;

      // Cookie 失效特殊处理
      if (status === 403 && data.message?.includes('Cookie')) {
        ElMessage.error({
          message: '知识星球 Cookie 已过期,请点击右上角"更新 Cookie"按钮',
          duration: 5000
        });
      } else {
        ElMessage.error(data.message || '请求失败');
      }
    } else {
      ElMessage.error('网络错误,请检查服务器是否启动');
    }

    return Promise.reject(error);
  }
);

export default request;
```

---

## 八、样式规范

### 8.1 Scoped CSS

#### 【强制】组件样式必须使用 scoped
```vue
<template>
  <div class="refund-list">
    <h1 class="title">退款名单</h1>
  </div>
</template>

<style scoped>
/* ✅ 正确: 使用 scoped,样式不会污染全局 */
.refund-list {
  padding: 20px;
}

.title {
  font-size: 24px;
  font-weight: bold;
}
</style>

<!-- ❌ 错误: 缺少 scoped,样式会污染全局 -->
<style>
.refund-list {
  padding: 20px;
}
</style>
```

---

### 8.2 CSS 命名规范

#### 【推荐】使用 BEM 命名规范
```vue
<template>
  <div class="statistics-card">
    <div class="statistics-card__header">
      <h3 class="statistics-card__title">数据总览</h3>
      <button class="statistics-card__refresh-btn">刷新</button>
    </div>
    <div class="statistics-card__body">
      <div class="statistics-card__item statistics-card__item--highlight">
        合格人数: 85
      </div>
    </div>
  </div>
</template>

<style scoped>
/* Block */
.statistics-card {
  border: 1px solid #ddd;
  border-radius: 4px;
}

/* Element */
.statistics-card__header {
  padding: 10px;
  background-color: #f5f7fa;
}

.statistics-card__title {
  font-size: 18px;
}

.statistics-card__refresh-btn {
  float: right;
}

/* Modifier */
.statistics-card__item--highlight {
  color: #67c23a;
  font-weight: bold;
}
</style>
```

---

### 8.3 样式变量

#### 【推荐】使用 CSS 变量统一管理颜色
```css
/* styles/variables.css */
:root {
  --color-primary: #409eff;
  --color-success: #67c23a;
  --color-warning: #e6a23c;
  --color-danger: #f56c6c;
  --color-info: #909399;

  --font-size-large: 18px;
  --font-size-medium: 16px;
  --font-size-small: 14px;

  --spacing-large: 20px;
  --spacing-medium: 16px;
  --spacing-small: 12px;
}
```

**使用**:
```vue
<style scoped>
.title {
  font-size: var(--font-size-large);
  color: var(--color-primary);
  margin-bottom: var(--spacing-medium);
}
</style>
```

---

## 九、测试规范

### 9.1 单元测试

#### 【推荐】核心组件必须有单元测试
```javascript
// RefundList.test.js
import { mount } from '@vue/test-utils';
import { describe, it, expect, vi } from 'vitest';
import RefundList from '@/views/RefundList.vue';
import { getRefundList } from '@/api/camps.api';

// Mock API
vi.mock('@/api/camps.api');

describe('RefundList.vue', () => {
  it('应该正确渲染组件', () => {
    const wrapper = mount(RefundList);
    expect(wrapper.find('.refund-list-container').exists()).toBe(true);
  });

  it('点击"开始计算"应该调用 API', async () => {
    getRefundList.mockResolvedValue({
      refund_list: [],
      statistics: { total_count: 99, qualified_count: 85 }
    });

    const wrapper = mount(RefundList);
    await wrapper.find('.calculate-btn').trigger('click');

    expect(getRefundList).toHaveBeenCalled();
  });

  it('应该正确显示统计数据', async () => {
    getRefundList.mockResolvedValue({
      refund_list: [],
      statistics: { total_count: 99, qualified_count: 85, qualified_rate: 85.86 }
    });

    const wrapper = mount(RefundList);
    await wrapper.find('.calculate-btn').trigger('click');
    await wrapper.vm.$nextTick();

    expect(wrapper.text()).toContain('99');
    expect(wrapper.text()).toContain('85');
  });
});
```

---

## 十、性能优化规范

### 10.1 列表渲染优化

#### 【强制】v-for 必须绑定 key
```vue
<template>
  <!-- ✅ 正确 -->
  <div v-for="item in refundList" :key="item.planet_user_id">
    {{ item.planet_nickname }}
  </div>

  <!-- ❌ 错误: 缺少 key -->
  <div v-for="item in refundList">
    {{ item.planet_nickname }}
  </div>

  <!-- ❌ 错误: 使用 index 作为 key -->
  <div v-for="(item, index) in refundList" :key="index">
    {{ item.planet_nickname }}
  </div>
</template>
```

---

### 10.2 计算属性缓存

#### 【推荐】使用 computed 替代方法
```vue
<script setup>
// ✅ 正确: 使用 computed,有缓存
const qualifiedNames = computed(() => {
  return refundList.value
    .filter(item => item.is_qualified)
    .map(item => item.planet_nickname)
    .join('、');
});

// ❌ 错误: 使用方法,每次渲染都会重新计算
const getQualifiedNames = () => {
  return refundList.value
    .filter(item => item.is_qualified)
    .map(item => item.planet_nickname)
    .join('、');
};
</script>

<template>
  <!-- ✅ 正确 -->
  <p>{{ qualifiedNames }}</p>

  <!-- ❌ 错误 -->
  <p>{{ getQualifiedNames() }}</p>
</template>
```

---

### 10.3 组件懒加载

#### 【推荐】大组件使用懒加载
```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router';

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      name: 'CampList',
      // ✅ 正确: 懒加载
      component: () => import('@/views/CampList.vue')
    },
    {
      path: '/refund/:checkin_id',
      name: 'RefundList',
      component: () => import('@/views/RefundList.vue')
    }
  ]
});

export default router;
```

---

### 10.4 大数据列表虚拟滚动

#### 【推荐】数据量>100 使用虚拟滚动
```vue
<template>
  <!-- 使用 Element Plus 的虚拟滚动 -->
  <el-table
    :data="refundList"
    :height="500"
    :virtual-scroll="true"
    :row-height="50"
  >
    <el-table-column prop="planet_nickname" label="星球昵称" />
    <el-table-column prop="checkined_days" label="打卡天数" />
  </el-table>
</template>
```

---

## 附录A: VSCode 配置

### settings.json
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "vetur.validation.template": false,
  "vetur.validation.script": false,
  "vetur.validation.style": false,
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

---

## 附录B: 常用工具配置

### package.json
```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "lint": "eslint src/**/*.{js,vue}",
    "lint:fix": "eslint src/**/*.{js,vue} --fix",
    "format": "prettier --write \"src/**/*.{js,vue,css}\""
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "eslint": "^8.0.0",
    "eslint-plugin-vue": "^9.0.0",
    "prettier": "^3.0.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "@vue/test-utils": "^2.4.0"
  }
}
```

---

## 附录C: 代码审查清单

### 功能性
- [ ] 组件是否实现了需求?
- [ ] Props 校验是否完整?
- [ ] 事件处理是否正确?

### 可读性
- [ ] 组件名是否语义化?
- [ ] 变量命名是否清晰?
- [ ] 注释是否充分?

### 性能
- [ ] v-for 是否有 key?
- [ ] 是否使用了 computed 缓存?
- [ ] 大组件是否懒加载?

### 可维护性
- [ ] 组件是否职责单一?
- [ ] 代码是否可复用?
- [ ] 是否遵循规范?

---

**文档结束**

**版本历史**:
- v1.0 (2025-10-27): 初始版本,参考 Vue 官方风格指南 + 阿里巴巴前端规约
