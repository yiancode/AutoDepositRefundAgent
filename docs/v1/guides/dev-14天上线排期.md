# 14天上线排期计划

> **版本**: v1.0
> **创建日期**: 2025-12-12
> **目标**: 14天内完成MVP开发测试并上线
> **原计划参考**: [dev-AI辅助敏捷开发计划.md](./dev-AI辅助敏捷开发计划.md)（27天压缩至14天）

---

## 压缩策略

| 策略 | 说明 |
|------|------|
| **并行开发** | 前后端同时进行，每日对齐接口 |
| **MVP优先** | 只做核心功能，非核心功能延后 |
| **合并Stage** | 将7个Stage合并为5个Phase |
| **简化测试** | 核心路径集成测试，非核心单元测试 |

### MVP范围（本次上线）

| 包含 | 不包含（二期） |
|------|----------------|
| ✅ 训练营CRUD（基础） | ❌ 复杂统计报表 |
| ✅ H5报名支付闭环 | ❌ 短信通知 |
| ✅ 打卡数据同步 | ❌ 积分激励 |
| ✅ 人工审核匹配 | ❌ 批量导入导出 |
| ✅ 退款审核执行 | ❌ 数据分析看板 |
| ✅ 管理后台基础版 | ❌ 多角色权限 |

---

## 排期总览

```
┌─────────────────────────────────────────────────────────────────────┐
│ Day 1-2   │ Phase 1: 环境搭建 + 项目骨架                            │
├─────────────────────────────────────────────────────────────────────┤
│ Day 3-5   │ Phase 2: 支付闭环（核心路径）                           │
├─────────────────────────────────────────────────────────────────────┤
│ Day 6-8   │ Phase 3: 管理后台 + 打卡同步                            │
├─────────────────────────────────────────────────────────────────────┤
│ Day 9-11  │ Phase 4: 人工审核 + 退款流程                            │
├─────────────────────────────────────────────────────────────────────┤
│ Day 12-13 │ Phase 5: 集成测试 + Bug修复                             │
├─────────────────────────────────────────────────────────────────────┤
│ Day 14    │ 部署上线                                                │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Phase 1: 环境搭建 + 项目骨架（Day 1-2）

### Day 1（8小时）

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 后端骨架搭建 | H5骨架搭建 | 两个项目可启动 |
| 下午 | 核心4表创建 | 管理后台骨架 | 数据库初始化完成 |
| 晚上 | 统一响应格式、异常处理 | Axios封装、路由配置 | 基础设施完成 |

**后端详细任务**：
- [ ] Spring Boot 3.2 项目初始化（Gradle）
- [ ] 依赖配置：MyBatis Plus、Redis、Knife4j、PostgreSQL
- [ ] 核心4表：`training_camp`, `planet_user`, `system_user`, `system_config`
- [ ] 统一响应 `Result<T>` + 全局异常处理
- [ ] 健康检查接口 `GET /api/health`

**前端详细任务**：
- [ ] H5项目：Vue 3 + Vite + Vant 4
- [ ] 管理后台：Vue 3 + Vite + Element Plus
- [ ] Axios封装（请求/响应拦截）
- [ ] 环境变量配置（.env.development）

**验收标准**：
```bash
# 后端
./gradlew bootRun  # http://localhost:8080/doc.html 可访问
# H5
cd frontend/h5-member && npm run dev  # http://localhost:5173 可访问
# 管理后台
cd frontend/admin-web && npm run dev  # http://localhost:5174 可访问
```

### Day 2（8小时）

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 管理员认证（JWT） | 管理后台登录页 | 登录功能 |
| 下午 | 训练营CRUD接口 | 训练营列表/创建页 | 训练营管理 |
| 晚上 | 联调 + 单元测试 | 联调 + 页面优化 | Phase 1 完成 |

**后端详细任务**：
- [ ] JWT工具类 + Spring Security配置
- [ ] `POST /api/admin/auth/login` 管理员登录
- [ ] `GET/POST/PUT /api/admin/camps` 训练营CRUD
- [ ] 枚举类：CampStatus, PayStatus, BindStatus等

**前端详细任务**：
- [ ] 管理后台登录页
- [ ] Token存储（localStorage）+ 路由守卫
- [ ] 训练营列表页（分页、搜索）
- [ ] 训练营创建/编辑表单

**验收标准**：
- ✅ 管理员可登录后台
- ✅ 可创建训练营（草稿→报名中）
- ✅ 训练营列表可查看、搜索

---

## Phase 2: 支付闭环（Day 3-5）⭐核心

### Day 3（8小时）- OAuth + 订单创建

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | OAuth授权接口 | H5训练营详情页 | OAuth流程 |
| 下午 | 创建支付订单接口 | H5支付页面 | 订单创建 |
| 晚上 | 支付表结构 + 单测 | 微信JSAPI调用 | 可发起支付 |

**后端详细任务**：
- [ ] `wechat_user` 表创建
- [ ] `GET /api/auth/authorize` OAuth发起
- [ ] `GET /api/auth/callback/wechat-mp` OAuth回调
- [ ] `payment_record` 表创建
- [ ] `POST /api/h5/payments` 创建订单
- [ ] AccessToken生成 + Redis存储

**前端详细任务**：
- [ ] H5训练营详情页（从管理后台获取数据）
- [ ] H5支付确认页
- [ ] 微信JSAPI支付调用封装
- [ ] 支付状态轮询

### Day 4（8小时）- 支付回调 + 绑定

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 支付回调处理 | 支付结果页 | 回调处理 |
| 下午 | 绑定星球账号接口 | 绑定页面 | 绑定功能 |
| 晚上 | 幂等性 + 安全验证 | 群二维码展示 | 支付闭环 |

**后端详细任务**：
- [ ] `POST /api/webhook/wechat/payment` 支付回调
- [ ] 微信签名验证
- [ ] Redis分布式锁（幂等性）
- [ ] `POST /api/h5/bindplanet` 绑定星球账号
- [ ] `GET /api/h5/orders/{orderNo}/status` 订单状态查询
- [ ] `payment_bind_status_log` 状态日志表

**前端详细任务**：
- [ ] 支付成功/失败结果页
- [ ] 绑定星球信息页（输入星球昵称/编号）
- [ ] 绑定成功后展示群二维码
- [ ] AccessToken本地存储 + 请求携带

### Day 5（8小时）- 联调 + 测试

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 支付流程联调 | 支付流程联调 | 端到端验证 |
| 下午 | 单元测试补充 | UI细节优化 | 测试覆盖 |
| 晚上 | 边界情况处理 | 异常状态处理 | Phase 2 完成 |

**验收标准（核心路径）**：
```
用户访问H5 → OAuth授权 → 查看训练营 → 发起支付
→ 微信支付成功 → 填写星球信息 → 绑定成功 → 查看群二维码
```
- ✅ 支付成功率 ≥ 99%（测试环境）
- ✅ 绑定流程 < 3步
- ✅ AccessToken验证正常

---

## Phase 3: 管理后台 + 打卡同步（Day 6-8）

### Day 6（8小时）- 会员管理 + camp_member表

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | camp_member表 + 接口 | 会员列表页 | 会员查看 |
| 下午 | 会员详情/状态接口 | 会员详情页 | 会员详情 |
| 晚上 | 订单管理接口 | 订单列表页 | 订单管理 |

**后端详细任务**：
- [ ] `camp_member` 表创建
- [ ] `GET /api/admin/camps/{id}/members` 会员列表
- [ ] `GET /api/admin/members/{id}` 会员详情
- [ ] `GET /api/admin/payments` 订单列表
- [ ] 会员状态更新接口

**前端详细任务**：
- [ ] 管理后台-会员列表页（分页、筛选）
- [ ] 会员详情弹窗/页面
- [ ] 订单列表页（支付状态、绑定状态筛选）

### Day 7（8小时）- 打卡同步

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | zsxq-sdk集成 | 打卡统计组件 | SDK集成 |
| 下午 | 打卡同步定时任务 | 打卡进度展示 | 同步任务 |
| 晚上 | 手动同步接口 | H5打卡进度页 | 打卡功能 |

**后端详细任务**：
- [ ] zsxq-sdk依赖引入 + 配置
- [ ] `checkin_record` 表创建
- [ ] `SyncService` 打卡数据同步服务
- [ ] `@Scheduled` 每日01:00自动同步
- [ ] `POST /api/admin/camps/{id}/sync` 手动触发同步
- [ ] `sync_log` 同步日志表

**前端详细任务**：
- [ ] H5我的打卡进度页
- [ ] 管理后台-打卡统计面板
- [ ] 手动同步按钮 + 同步状态展示

### Day 8（8小时）- 联调 + 补充

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 打卡同步联调 | 打卡数据展示联调 | 同步验证 |
| 下午 | 同步异常处理 | 异常状态展示 | 异常处理 |
| 晚上 | 单元测试 | UI优化 | Phase 3 完成 |

**验收标准**：
- ✅ 定时任务每日01:00执行
- ✅ 手动同步可触发
- ✅ 打卡数据正确关联到会员
- ✅ H5可查看个人打卡进度

---

## Phase 4: 人工审核 + 退款流程（Day 9-11）

### Day 9（8小时）- 绑定超时 + 人工审核

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 绑定超时检测任务 | 待审核列表页 | 超时检测 |
| 下午 | 人工审核接口 | 审核操作弹窗 | 审核功能 |
| 晚上 | 状态日志记录 | 审核历史展示 | 审核闭环 |

**后端详细任务**：
- [ ] `@Scheduled` 每日02:00检测绑定超时
- [ ] 超时订单状态：`pending` → `expired` → `manual_review`
- [ ] `GET /api/admin/reviews` 待审核列表
- [ ] `POST /api/admin/reviews/{id}/approve` 审核通过
- [ ] `POST /api/admin/reviews/{id}/reject` 审核拒绝
- [ ] 审核操作记录到 `operation_log`

**前端详细任务**：
- [ ] 待审核列表页（bind_status=manual_review）
- [ ] 审核弹窗（显示订单信息、星球信息对比）
- [ ] 审核通过/拒绝操作
- [ ] 审核历史记录查看

### Day 10（8小时）- 退款审核

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | refund_record表 + 接口 | 退款列表页 | 退款列表 |
| 下午 | 退款审核接口 | 退款审核操作 | 审核功能 |
| 晚上 | 退款条件计算 | 退款详情展示 | 退款审核 |

**后端详细任务**：
- [ ] `refund_record` 表创建
- [ ] `RefundService` 退款服务
- [ ] 训练营结束后生成退款记录（定时任务）
- [ ] `GET /api/admin/refunds` 退款列表
- [ ] `POST /api/admin/refunds/{id}/approve` 审核通过
- [ ] `POST /api/admin/refunds/{id}/reject` 审核拒绝
- [ ] 打卡达标判定逻辑

**前端详细任务**：
- [ ] 退款列表页（待审核、已审核筛选）
- [ ] 退款详情（打卡记录、达标情况）
- [ ] 批量审核操作

### Day 11（8小时）- 退款执行

| 时段 | 后端任务 | 前端任务 | 交付物 |
|------|----------|----------|--------|
| 上午 | 微信退款API对接 | 退款状态展示 | 退款执行 |
| 下午 | 退款回调处理 | 退款结果通知 | 回调处理 |
| 晚上 | 联调 + 异常处理 | H5退款状态页 | Phase 4 完成 |

**后端详细任务**：
- [ ] 微信退款API封装（WechatPayManager）
- [ ] `POST /api/admin/refunds/{id}/execute` 执行退款
- [ ] `POST /api/webhook/wechat/refund` 退款回调
- [ ] 退款状态更新 + 日志记录
- [ ] 企业微信通知（简化版：仅管理员通知）

**前端详细任务**：
- [ ] 执行退款按钮 + 确认弹窗
- [ ] 退款进度状态展示
- [ ] H5我的退款状态页

**验收标准**：
- ✅ 训练营结束自动生成退款记录
- ✅ 打卡达标判定正确
- ✅ 退款审核流程完整
- ✅ 微信退款执行成功

---

## Phase 5: 集成测试 + Bug修复（Day 12-13）

### Day 12（8小时）- 集成测试

| 时段 | 任务 | 关注点 |
|------|------|--------|
| 上午 | 端到端测试：报名支付流程 | OAuth、支付、绑定 |
| 下午 | 端到端测试：打卡同步流程 | 定时任务、数据准确性 |
| 晚上 | 端到端测试：退款流程 | 审核、退款执行 |

**测试用例清单**：
```markdown
## 核心路径测试（必须通过）

### TC-001: 支付闭环
1. 用户访问H5 → 自动OAuth授权
2. 查看训练营详情 → 点击报名
3. 微信支付 → 支付成功
4. 填写星球信息 → 绑定成功
5. 查看群二维码 → 正常显示
✅ 预期：全流程 < 30秒

### TC-002: 打卡同步
1. 手动触发同步 → 同步成功
2. 检查打卡记录 → 数据正确
3. H5查看进度 → 显示正确
✅ 预期：同步 < 60秒/100条

### TC-003: 退款流程
1. 训练营结束 → 生成退款记录
2. 管理员审核 → 通过/拒绝
3. 执行退款 → 微信退款成功
✅ 预期：退款到账 < 3天

### TC-004: 异常场景
1. 支付超时 → 正确处理
2. 绑定超时 → 转入人工审核
3. 退款失败 → 可重试
```

### Day 13（8小时）- Bug修复 + 优化

| 时段 | 任务 | 交付物 |
|------|------|--------|
| 上午 | Bug修复（按优先级） | 修复P0/P1 Bug |
| 下午 | 性能优化 + 安全检查 | 响应时间 < 500ms |
| 晚上 | 文档更新 + 部署准备 | 部署文档 |

**Bug优先级**：
- **P0**：阻塞上线（支付失败、数据丢失）
- **P1**：影响核心功能（状态不同步、UI错乱）
- **P2**：影响体验（加载慢、提示不友好）
- **P3**：优化建议（延后处理）

---

## Day 14: 部署上线

| 时段 | 任务 | 负责人 |
|------|------|--------|
| 09:00-10:00 | 生产环境检查 | 运维 |
| 10:00-11:00 | 数据库迁移 | 后端 |
| 11:00-12:00 | 后端部署 | 后端 |
| 14:00-15:00 | 前端部署 | 前端 |
| 15:00-16:00 | 冒烟测试 | 测试 |
| 16:00-17:00 | 灰度放量（10%） | 产品 |
| 17:00-18:00 | 监控观察 | 全员 |
| 18:00+ | 全量上线 / 回滚 | 全员 |

**上线检查清单**：
- [ ] 生产数据库已创建
- [ ] Redis已配置
- [ ] 微信支付商户号已配置
- [ ] 微信公众号OAuth已配置
- [ ] 域名SSL证书已部署
- [ ] 监控告警已配置
- [ ] 回滚脚本已准备

---

## 风险与应对

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 微信支付对接延迟 | 中 | 高 | Day 3-4 优先完成，预留1天Buffer |
| zsxq-sdk问题 | 低 | 中 | 有现成SDK，必要时直接调API |
| 联调阻塞 | 中 | 中 | 每日站会对齐，Mock接口先行 |
| Bug过多 | 中 | 高 | Day 13 专门修Bug，P2以下延后 |

---

## 人员分工建议

| 角色 | 职责 | 关键任务 |
|------|------|----------|
| **后端1** | 核心业务 | 支付、退款、打卡同步 |
| **后端2** | 管理功能 | 训练营CRUD、审核、定时任务 |
| **前端1** | H5会员端 | OAuth、支付、绑定、进度 |
| **前端2** | 管理后台 | 训练营、会员、退款管理 |
| **测试** | 质量保障 | Day 12-13 集中测试 |

---

## 每日站会模板

```markdown
## 日期：Day X

### 昨日完成
- [ ] 任务1
- [ ] 任务2

### 今日计划
- [ ] 任务1（负责人，预计X小时）
- [ ] 任务2（负责人，预计X小时）

### 阻塞问题
- 问题1：描述 → 解决方案

### 接口对齐
- 接口1：后端完成/前端待联调
```

---

## 附录：数据库表创建顺序

| Phase | 新增表 |
|-------|--------|
| Phase 1 | `training_camp`, `planet_user`, `system_user`, `system_config` |
| Phase 2 | `wechat_user`, `payment_record`, `payment_bind_status_log` |
| Phase 3 | `camp_member`, `checkin_record`, `sync_log` |
| Phase 4 | `refund_record`, `refund_status_log`, `operation_log` |

---

**文档版本**: v1.0
**创建日期**: 2025-12-12
**维护者**: 技术架构组
