# åç«¯å¼€å‘è§„èŒƒ - Node.js/Express é¡¹ç›®

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-10-27
- **é€‚ç”¨é¡¹ç›®**: çŸ¥è¯†æ˜Ÿçƒè®­ç»ƒè¥é€€æ¬¾ç³»ç»Ÿ v0
- **æŠ€æœ¯æ ˆ**: Node.js 18+ / Express.js 4.x
- **å‚è€ƒæ ‡å‡†**: é˜¿é‡Œå·´å·´å¼€å‘è§„çº¦

---

## ç›®å½•

- [ä¸€ã€ç¼–ç¨‹è§„çº¦](#ä¸€ç¼–ç¨‹è§„çº¦)
- [äºŒã€ä»£ç ç»“æ„è§„èŒƒ](#äºŒä»£ç ç»“æ„è§„èŒƒ)
- [ä¸‰ã€å‘½åè§„èŒƒ](#ä¸‰å‘½åè§„èŒƒ)
- [å››ã€æ³¨é‡Šè§„èŒƒ](#å››æ³¨é‡Šè§„èŒƒ)
- [äº”ã€å¼‚å¸¸å¤„ç†è§„èŒƒ](#äº”å¼‚å¸¸å¤„ç†è§„èŒƒ)
- [å…­ã€æ—¥å¿—è§„èŒƒ](#å…­æ—¥å¿—è§„èŒƒ)
- [ä¸ƒã€å®‰å…¨è§„èŒƒ](#ä¸ƒå®‰å…¨è§„èŒƒ)
- [å…«ã€æµ‹è¯•è§„èŒƒ](#å…«æµ‹è¯•è§„èŒƒ)
- [ä¹ã€Git è§„èŒƒ](#ä¹git-è§„èŒƒ)

---

## ä¸€ã€ç¼–ç¨‹è§„çº¦

### 1.1 æ ¸å¿ƒåŸåˆ™

#### âœ… æ–‡æ¡£å…ˆè¡ŒåŸåˆ™
- **ã€å¼ºåˆ¶ã€‘** å¼€å‘æ–°åŠŸèƒ½å‰,å¿…é¡»å…ˆç¼–å†™ API æ–‡æ¡£(ä½¿ç”¨ JSDoc æˆ– Markdown)
- **ã€å¼ºåˆ¶ã€‘** API æ–‡æ¡£å¿…é¡»åŒ…å«: æ¥å£è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€å“åº”æ ¼å¼ã€é”™è¯¯ç 
- **ã€æ¨èã€‘** ä½¿ç”¨ Swagger/OpenAPI è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£

**ç¤ºä¾‹**:
```javascript
/**
 * è·å–è®­ç»ƒè¥åˆ—è¡¨
 *
 * @route GET /api/camps
 * @param {string} scope - çŠ¶æ€ç­›é€‰: ongoing(è¿›è¡Œä¸­) / over(å·²ç»“æŸ) / closed(å·²å…³é—­)
 * @returns {Object} è®­ç»ƒè¥åˆ—è¡¨
 * @returns {Object[]} data.camps - è®­ç»ƒè¥æ•°ç»„
 * @returns {number} data.camps[].checkin_id - è®­ç»ƒè¥ID
 * @returns {string} data.camps[].title - è®­ç»ƒè¥åç§°
 * @throws {400} scope å‚æ•°æ— æ•ˆ
 * @throws {403} Cookie å·²è¿‡æœŸ
 *
 * @example
 * GET /api/camps?scope=over
 * Response: { code: 200, data: { camps: [...] } }
 */
router.get('/camps', async (req, res, next) => {
  // å®ç°ä»£ç 
});
```

---

#### âœ… æµ‹è¯•é©±åŠ¨å¼€å‘(TDD)åŸåˆ™
- **ã€å¼ºåˆ¶ã€‘** æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»å…ˆå†™æµ‹è¯•ç”¨ä¾‹,å†å†™å®ç°ä»£ç 
- **ã€æ¨èã€‘** ä½¿ç”¨ Jest æˆ– Mocha + Chai ä½œä¸ºæµ‹è¯•æ¡†æ¶
- **ã€æ¨èã€‘** æµ‹è¯•è¦†ç›–ç‡è‡³å°‘è¾¾åˆ° 70%

**TDD å¼€å‘æµç¨‹**:
```
1. ç¼–å†™æµ‹è¯•ç”¨ä¾‹(Red) â†’ æµ‹è¯•å¤±è´¥
   â†“
2. ç¼–å†™æœ€å°å®ç°ä»£ç (Green) â†’ æµ‹è¯•é€šè¿‡
   â†“
3. é‡æ„ä¼˜åŒ–ä»£ç (Refactor) â†’ æµ‹è¯•ä»ç„¶é€šè¿‡
   â†“
4. å¾ªç¯è¿­ä»£
```

**ç¤ºä¾‹**:
```javascript
// 1. å…ˆå†™æµ‹è¯• (camps.service.test.js)
describe('CampsService', () => {
  describe('getCamps', () => {
    it('åº”è¯¥è¿”å›å·²ç»“æŸçš„è®­ç»ƒè¥åˆ—è¡¨', async () => {
      const camps = await campsService.getCamps('over');
      expect(camps).toBeInstanceOf(Array);
      expect(camps.length).toBeGreaterThan(0);
      expect(camps[0]).toHaveProperty('checkin_id');
      expect(camps[0]).toHaveProperty('title');
    });

    it('scopeå‚æ•°æ— æ•ˆæ—¶åº”è¯¥æŠ›å‡ºå¼‚å¸¸', async () => {
      await expect(campsService.getCamps('invalid'))
        .rejects
        .toThrow('scope å‚æ•°æ— æ•ˆ');
    });
  });
});

// 2. å†å†™å®ç° (camps.service.js)
async getCamps(scope) {
  if (!['ongoing', 'over', 'closed'].includes(scope)) {
    throw new Error('scope å‚æ•°æ— æ•ˆ');
  }
  // å®ç°é€»è¾‘...
}
```

---

### 1.2 åŸºæœ¬ç¼–ç è§„èŒƒ

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨ ESLint ä»£ç æ£€æŸ¥
```json
// .eslintrc.json
{
  "extends": "eslint:recommended",
  "env": {
    "node": true,
    "es2021": true
  },
  "parserOptions": {
    "ecmaVersion": 2021
  },
  "rules": {
    "indent": ["error", 2],
    "quotes": ["error", "single"],
    "semi": ["error", "always"],
    "no-unused-vars": "error",
    "no-console": "warn"
  }
}
```

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨ Prettier ä»£ç æ ¼å¼åŒ–
```json
// .prettierrc
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 100,
  "tabWidth": 2
}
```

---

## äºŒã€ä»£ç ç»“æ„è§„èŒƒ

### 2.1 åˆ†å±‚æ¶æ„

```
Controller(æ§åˆ¶å™¨å±‚)
    â†“ èŒè´£: è·¯ç”±æ˜ å°„ã€å‚æ•°æ ¡éªŒã€è°ƒç”¨Service
Service(ä¸šåŠ¡é€»è¾‘å±‚)
    â†“ èŒè´£: ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€è°ƒç”¨Manager
Manager(ç¬¬ä¸‰æ–¹æœåŠ¡å°è£…å±‚)
    â†“ èŒè´£: APIè°ƒç”¨ã€æ•°æ®è½¬æ¢ã€é”™è¯¯å¤„ç†
Utils(å·¥å…·å±‚)
    â†“ èŒè´£: é€šç”¨å·¥å…·å‡½æ•°ã€å¸¸é‡å®šä¹‰
```

#### ã€å¼ºåˆ¶ã€‘èŒè´£å•ä¸€åŸåˆ™
- **Controller**: åªè´Ÿè´£æ¥æ”¶è¯·æ±‚å’Œè¿”å›å“åº”,ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **Service**: åªè´Ÿè´£ä¸šåŠ¡é€»è¾‘,ä¸ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹API
- **Manager**: åªè´Ÿè´£å°è£…ç¬¬ä¸‰æ–¹API,ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

**åä¾‹**:
```javascript
// âŒ é”™è¯¯: Controller ä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘
router.get('/camps', async (req, res) => {
  const { scope } = req.query;

  // ç›´æ¥è°ƒç”¨çŸ¥è¯†æ˜ŸçƒAPI - é”™è¯¯!
  const response = await axios.get(`https://api.zsxq.com/v2/groups/xxx/checkins?scope=${scope}`);
  const camps = response.data.resp_data.checkins;

  // ä¸šåŠ¡é€»è¾‘å¤„ç† - é”™è¯¯!
  const filteredCamps = camps.filter(camp => camp.status === 'over');

  res.json({ code: 200, data: { camps: filteredCamps } });
});
```

**æ­£ä¾‹**:
```javascript
// âœ… æ­£ç¡®: Controller åªè´Ÿè´£è°ƒç”¨ Service
router.get('/camps', async (req, res, next) => {
  try {
    const { scope } = req.query;
    const camps = await campsService.getCamps(scope);
    res.json(successResponse({ camps }));
  } catch (error) {
    next(error);
  }
});

// âœ… Service è´Ÿè´£ä¸šåŠ¡é€»è¾‘
class CampsService {
  async getCamps(scope) {
    const camps = await zsxqManager.fetchCamps(scope);
    return camps.filter(camp => this.isValidCamp(camp));
  }
}

// âœ… Manager è´Ÿè´£APIè°ƒç”¨
class ZsxqManager {
  async fetchCamps(scope) {
    const response = await axios.get(this.buildUrl(scope), {
      headers: this.getHeaders()
    });
    return response.data.resp_data.checkins;
  }
}
```

---

### 2.2 æ–‡ä»¶ç»„ç»‡è§„èŒƒ

#### ã€å¼ºåˆ¶ã€‘æ–‡ä»¶å‘½åè§„èŒƒ
- æ–‡ä»¶åä½¿ç”¨ **å°å†™å­—æ¯ + çŸ­æ¨ªçº¿**
- Service ç±»æ–‡ä»¶: `xxx.service.js`
- Manager ç±»æ–‡ä»¶: `xxx.manager.js`
- å·¥å…·å‡½æ•°: `xxx.util.js`
- ä¸­é—´ä»¶: `xxx.middleware.js`
- è·¯ç”±: `xxx.route.js`

**ç¤ºä¾‹**:
```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ camps.service.js
â”‚   â”œâ”€â”€ refund.service.js
â”‚   â””â”€â”€ checkin.service.js
â”œâ”€â”€ managers/
â”‚   â””â”€â”€ zsxq.manager.js
â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ auth.middleware.js
â”‚   â””â”€â”€ error.middleware.js
â””â”€â”€ utils/
    â”œâ”€â”€ response.util.js
    â””â”€â”€ validator.util.js
```

---

## ä¸‰ã€å‘½åè§„èŒƒ

### 3.1 å˜é‡å‘½å

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å°é©¼å³°å‘½åæ³•(camelCase)
```javascript
// âœ… æ­£ç¡®
const userName = 'John';
const checkinCount = 10;
const isQualified = true;

// âŒ é”™è¯¯
const user_name = 'John';  // ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
const CheckinCount = 10;   // ä¸ä½¿ç”¨å¤§é©¼å³°
const is_qualified = true; // ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
```

#### ã€å¼ºåˆ¶ã€‘å¸ƒå°”å˜é‡ä½¿ç”¨ is/has/should å‰ç¼€
```javascript
// âœ… æ­£ç¡®
const isValid = true;
const hasPermission = false;
const shouldRetry = true;

// âŒ é”™è¯¯
const valid = true;
const permission = false;
```

#### ã€æ¨èã€‘å¸¸é‡ä½¿ç”¨å…¨å¤§å†™+ä¸‹åˆ’çº¿
```javascript
// âœ… æ­£ç¡®
const MAX_RETRY_COUNT = 3;
const API_BASE_URL = 'https://api.zsxq.com';
const DEFAULT_PAGE_SIZE = 100;

// âŒ é”™è¯¯
const maxRetryCount = 3;
const ApiBaseUrl = 'https://api.zsxq.com';
```

---

### 3.2 å‡½æ•°å‘½å

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨åŠ¨è¯æˆ–åŠ¨è¯çŸ­è¯­
```javascript
// âœ… æ­£ç¡®
async function getCamps() { }
async function createRefundList() { }
async function validateCookie() { }
async function calculateQualifiedCount() { }

// âŒ é”™è¯¯
async function camps() { }       // ç¼ºå°‘åŠ¨è¯
async function refundList() { } // ç¼ºå°‘åŠ¨è¯
```

#### ã€æ¨èã€‘å‡½æ•°å‘½åéµå¾ªä¸€è¯ä¸€ä¹‰
- `get`: è·å–æ•°æ®(æŸ¥è¯¢)
- `create`: åˆ›å»ºæ–°æ•°æ®
- `update`: æ›´æ–°å·²æœ‰æ•°æ®
- `delete`: åˆ é™¤æ•°æ®
- `validate`: æ ¡éªŒæ•°æ®
- `calculate`: è®¡ç®—ç»“æœ
- `generate`: ç”Ÿæˆæ•°æ®

---

### 3.3 ç±»å‘½å

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•(PascalCase)
```javascript
// âœ… æ­£ç¡®
class CampsService { }
class ZsxqManager { }
class AuthMiddleware { }

// âŒ é”™è¯¯
class campsService { }
class zsxq_manager { }
```

---

## å››ã€æ³¨é‡Šè§„èŒƒ

### 4.1 JSDoc æ³¨é‡Š

#### ã€å¼ºåˆ¶ã€‘æ‰€æœ‰å¯¼å‡ºçš„å‡½æ•°/ç±»å¿…é¡»æœ‰ JSDoc æ³¨é‡Š
```javascript
/**
 * ç”Ÿæˆé€€æ¬¾åå•
 *
 * @param {number} checkinId - è®­ç»ƒè¥ID
 * @param {number} requiredDays - è¦æ±‚æ‰“å¡å¤©æ•°
 * @returns {Promise<Object>} é€€æ¬¾åå•å’Œç»Ÿè®¡æ•°æ®
 * @returns {Array<Object>} data.refund_list - é€€æ¬¾åå•æ•°ç»„
 * @returns {Object} data.statistics - ç»Ÿè®¡æ•°æ®
 * @throws {Error} è®­ç»ƒè¥ä¸å­˜åœ¨
 * @throws {Error} requiredDays å‚æ•°æ— æ•ˆ
 *
 * @example
 * const result = await refundService.generateRefundList(123, 7);
 * // result: { refund_list: [...], statistics: {...} }
 */
async generateRefundList(checkinId, requiredDays) {
  // å®ç°ä»£ç 
}
```

#### ã€æ¨èã€‘å¤æ‚ä¸šåŠ¡é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
```javascript
async getRankingList(checkinId) {
  const allRankings = [];
  let index = 0;
  const MAX_PAGES = 2; // æœ€å¤šç¿»2é¡µ(200äºº)

  while (index < MAX_PAGES) {
    // è°ƒç”¨çŸ¥è¯†æ˜ŸçƒAPIè·å–å•é¡µæ•°æ®
    const rankings = await this.fetchRankingPage(checkinId, index);
    allRankings.push(...rankings);

    // åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
    if (rankings.length < 100) break;

    // å»¶è¿Ÿ200ms,é¿å…è§¦å‘APIé™æµ
    await new Promise(resolve => setTimeout(resolve, 200));
    index++;
  }

  return allRankings;
}
```

---

### 4.2 TODO æ³¨é‡Š

#### ã€æ¨èã€‘ä½¿ç”¨ç»Ÿä¸€çš„ TODO æ ¼å¼
```javascript
// TODO(å¼ ä¸‰): éœ€è¦ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½,æ·»åŠ Redisç¼“å­˜ - 2025-10-30
// FIXME(æå››): Cookieè¿‡æœŸæ£€æµ‹é€»è¾‘æœ‰bug,éœ€ä¿®å¤ - 2025-10-27
// HACK: ä¸´æ—¶æ–¹æ¡ˆ,çŸ¥è¯†æ˜ŸçƒAPIè¿”å›æ ¼å¼ä¸ç¨³å®š,åç»­ä¼˜åŒ–
```

---

## äº”ã€å¼‚å¸¸å¤„ç†è§„èŒƒ

### 5.1 ç»Ÿä¸€å¼‚å¸¸å¤„ç†

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶
```javascript
// error.middleware.js
function errorMiddleware(err, req, res, next) {
  logger.error(`è¯·æ±‚å¤±è´¥: ${req.method} ${req.path}`, {
    error: err.message,
    stack: err.stack
  });

  // Cookie å¤±æ•ˆé”™è¯¯
  if (err.message.includes('Cookie å·²è¿‡æœŸ')) {
    return res.status(403).json(errorResponse(403, err.message));
  }

  // å‚æ•°æ ¡éªŒé”™è¯¯
  if (err.message.includes('å‚æ•°')) {
    return res.status(400).json(errorResponse(400, err.message));
  }

  // é»˜è®¤é”™è¯¯
  return res.status(500).json(errorResponse(500, 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'));
}
```

---

### 5.2 å¼‚å¸¸æŠ›å‡ºè§„èŒƒ

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨è¯­ä¹‰åŒ–çš„é”™è¯¯ä¿¡æ¯
```javascript
// âœ… æ­£ç¡®: æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
if (!requiredDays || requiredDays <= 0) {
  throw new Error('required_days å¿…é¡»ä¸ºæ­£æ•´æ•°');
}

if (requiredDays > campInfo.checkin_days) {
  throw new Error(`å®Œæˆå¤©æ•°ä¸èƒ½è¶…è¿‡è®­ç»ƒè¥æ€»å¤©æ•°(${campInfo.checkin_days}å¤©)`);
}

// âŒ é”™è¯¯: æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯
if (!requiredDays) {
  throw new Error('å‚æ•°é”™è¯¯');
}
```

#### ã€æ¨èã€‘è‡ªå®šä¹‰é”™è¯¯ç±»
```javascript
// custom-error.js
class BusinessError extends Error {
  constructor(code, message) {
    super(message);
    this.code = code;
    this.name = 'BusinessError';
  }
}

class ValidationError extends BusinessError {
  constructor(message) {
    super(400, message);
    this.name = 'ValidationError';
  }
}

class AuthError extends BusinessError {
  constructor(message) {
    super(401, message);
    this.name = 'AuthError';
  }
}

// ä½¿ç”¨
throw new ValidationError('required_days å¿…é¡»ä¸ºæ­£æ•´æ•°');
throw new AuthError('API Key æ— æ•ˆ');
```

---

## å…­ã€æ—¥å¿—è§„èŒƒ

### 6.1 æ—¥å¿—çº§åˆ«

#### ã€å¼ºåˆ¶ã€‘ä½¿ç”¨æ­£ç¡®çš„æ—¥å¿—çº§åˆ«
- **error**: ç³»ç»Ÿé”™è¯¯,éœ€è¦ç«‹å³å¤„ç†(å¦‚APIè°ƒç”¨å¤±è´¥ã€æ•°æ®åº“è¿æ¥å¤±è´¥)
- **warn**: è­¦å‘Šä¿¡æ¯,éœ€è¦å…³æ³¨(å¦‚Cookieå³å°†è¿‡æœŸã€å‚æ•°å¯ç–‘)
- **info**: é‡è¦ä¸šåŠ¡ä¿¡æ¯(å¦‚ç”¨æˆ·ç™»å½•ã€è®¢å•åˆ›å»º)
- **debug**: è°ƒè¯•ä¿¡æ¯(ä»…å¼€å‘ç¯å¢ƒ)

```javascript
// âœ… æ­£ç¡®
logger.error('çŸ¥è¯†æ˜Ÿçƒ API è°ƒç”¨å¤±è´¥', { error: err.message });
logger.warn('Cookie å°†åœ¨3å¤©åè¿‡æœŸ,è¯·åŠæ—¶æ›´æ–°');
logger.info(`ç”Ÿæˆé€€æ¬¾åå•æˆåŠŸ,è®­ç»ƒè¥ID=${checkinId},åˆæ ¼äººæ•°=${qualifiedCount}`);
logger.debug('è¯·æ±‚å‚æ•°:', req.body);

// âŒ é”™è¯¯
logger.info('çŸ¥è¯†æ˜Ÿçƒ API è°ƒç”¨å¤±è´¥'); // åº”è¯¥ç”¨ error
logger.error('ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®');        // åº”è¯¥ç”¨ debug
```

---

### 6.2 æ—¥å¿—æ ¼å¼

#### ã€å¼ºåˆ¶ã€‘æ—¥å¿—å¿…é¡»åŒ…å«å…³é”®ä¿¡æ¯
```javascript
// âœ… æ­£ç¡®: ç»“æ„åŒ–æ—¥å¿—
logger.info('ç”Ÿæˆé€€æ¬¾åå•å®Œæˆ', {
  checkin_id: checkinId,
  required_days: requiredDays,
  total_count: statistics.total_count,
  qualified_count: statistics.qualified_count,
  duration: Date.now() - startTime
});

// âŒ é”™è¯¯: éç»“æ„åŒ–æ—¥å¿—
logger.info('ç”Ÿæˆé€€æ¬¾åå•å®Œæˆ');
```

---

## ä¸ƒã€å®‰å…¨è§„èŒƒ

### 7.1 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

#### ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
```javascript
// âŒ é”™è¯¯: ç¡¬ç¼–ç 
const API_KEY = 'abc123';
const PASSWORD = 'admin123';

// âœ… æ­£ç¡®: ä½¿ç”¨ç¯å¢ƒå˜é‡
const API_KEY = process.env.API_KEY;
const PASSWORD = process.env.PASSWORD;
```

#### ã€å¼ºåˆ¶ã€‘ç¦æ­¢åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯
```javascript
// âŒ é”™è¯¯
logger.info('Cookie:', process.env.ZSXQ_AUTHORIZATION);
logger.info('ç”¨æˆ·å¯†ç :', user.password);

// âœ… æ­£ç¡®
logger.info('Cookie å·²åŠ è½½');
logger.info('ç”¨æˆ·ç™»å½•æˆåŠŸ', { user_id: user.id });
```

---

### 7.2 è¾“å…¥æ ¡éªŒ

#### ã€å¼ºåˆ¶ã€‘æ‰€æœ‰å¤–éƒ¨è¾“å…¥å¿…é¡»æ ¡éªŒ
```javascript
// âœ… æ­£ç¡®: ä¸¥æ ¼æ ¡éªŒ
router.post('/camps/:checkin_id/refund-list', async (req, res, next) => {
  try {
    const { checkin_id } = req.params;
    const { required_days } = req.body;

    // æ ¡éªŒ checkin_id
    if (!checkin_id || !Number.isInteger(Number(checkin_id))) {
      return res.status(400).json(errorResponse(400, 'checkin_id å¿…é¡»ä¸ºæ•´æ•°'));
    }

    // æ ¡éªŒ required_days
    if (!required_days || !Number.isInteger(required_days) || required_days <= 0) {
      return res.status(400).json(errorResponse(400, 'required_days å¿…é¡»ä¸ºæ­£æ•´æ•°'));
    }

    // ä¸šåŠ¡é€»è¾‘...
  } catch (error) {
    next(error);
  }
});
```

---

## å…«ã€æµ‹è¯•è§„èŒƒ

### 8.1 å•å…ƒæµ‹è¯•

#### ã€å¼ºåˆ¶ã€‘æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
```javascript
// refund.service.test.js
const RefundService = require('../services/refund.service');

describe('RefundService', () => {
  let refundService;

  beforeEach(() => {
    refundService = new RefundService();
  });

  describe('generateRefundList', () => {
    it('åº”è¯¥æ­£ç¡®è®¡ç®—åˆæ ¼äººæ•°', async () => {
      const result = await refundService.generateRefundList(123, 7);

      expect(result.statistics.total_count).toBe(99);
      expect(result.statistics.qualified_count).toBe(85);
      expect(result.statistics.qualified_rate).toBe(85.86);
    });

    it('æ‰“å¡å¤©æ•°>=è¦æ±‚å¤©æ•°çš„ç”¨æˆ·åº”è¯¥è¢«æ ‡è®°ä¸ºåˆæ ¼', async () => {
      const result = await refundService.generateRefundList(123, 7);

      const qualifiedUsers = result.refund_list.filter(u => u.is_qualified);
      qualifiedUsers.forEach(user => {
        expect(user.checkined_days).toBeGreaterThanOrEqual(7);
      });
    });
  });
});
```

---

### 8.2 æµ‹è¯•è¦†ç›–ç‡

#### ã€æ¨èã€‘æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- **æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**: â‰¥ 80%
- **å·¥å…·å‡½æ•°**: â‰¥ 90%
- **æ•´ä½“é¡¹ç›®**: â‰¥ 70%

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# package.json
{
  "scripts": {
    "test": "jest",
    "test:coverage": "jest --coverage",
    "test:watch": "jest --watch"
  },
  "jest": {
    "coverageThreshold": {
      "global": {
        "branches": 70,
        "functions": 70,
        "lines": 70,
        "statements": 70
      }
    }
  }
}
```

---

## ä¹ã€Git è§„èŒƒ

### 9.1 åˆ†æ”¯ç®¡ç†

#### ã€å¼ºåˆ¶ã€‘åˆ†æ”¯å‘½åè§„èŒƒ
- **ä¸»åˆ†æ”¯**: `main` æˆ– `master`
- **åŠŸèƒ½åˆ†æ”¯**: `feature/åŠŸèƒ½åç§°`
- **ä¿®å¤åˆ†æ”¯**: `fix/bugæè¿°`
- **é‡æ„åˆ†æ”¯**: `refactor/æ¨¡å—åç§°`

**ç¤ºä¾‹**:
```bash
feature/cookie-update
feature/refund-list-generation
fix/cookie-validation-bug
refactor/zsxq-manager
```

---

### 9.2 æäº¤è§„èŒƒ(Conventional Commits)

#### ã€å¼ºåˆ¶ã€‘æäº¤ä¿¡æ¯æ ¼å¼
```
<type>(<scope>): <subject>

<body>

<footer>
```

**type ç±»å‹**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ Bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼(ä¸å½±å“åŠŸèƒ½)
- `refactor`: é‡æ„(ä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤)
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·é…ç½®

**ç¤ºä¾‹**:
```bash
feat(api): æ·»åŠ Cookieæ›´æ–°æ¥å£

- æ–°å¢ POST /api/config/zsxq-cookie æ¥å£
- æ”¯æŒåŠ¨æ€æ›´æ–°çŸ¥è¯†æ˜ŸçƒCookie
- è‡ªåŠ¨éªŒè¯æ–°Cookieæ˜¯å¦æœ‰æ•ˆ

Closes #123

---

fix(service): ä¿®å¤æ‰“å¡æ’è¡Œæ¦œç¿»é¡µé€»è¾‘

ä¿®å¤å½“äººæ•°>100æ—¶æ— æ³•è·å–å…¨éƒ¨æ•°æ®çš„bug

---

docs(readme): æ›´æ–°éƒ¨ç½²æ–‡æ¡£

æ·»åŠ Let's Encrypt HTTPSé…ç½®æ­¥éª¤
```

---

### 9.3 ä»£ç å®¡æŸ¥(Code Review)

#### ã€æ¨èã€‘Pull Request å¿…é¡»ç»è¿‡å®¡æŸ¥
- **ã€å¼ºåˆ¶ã€‘** PR å¿…é¡»è‡³å°‘1äººå®¡æŸ¥é€šè¿‡æ‰èƒ½åˆå¹¶
- **ã€æ¨èã€‘** ä½¿ç”¨ PR æ¨¡æ¿

**PR æ¨¡æ¿ç¤ºä¾‹**:
```markdown
## å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½
- [ ] Bug ä¿®å¤
- [ ] é‡æ„
- [ ] æ–‡æ¡£æ›´æ–°

## å˜æ›´è¯´æ˜
ç®€è¦æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹...

## æµ‹è¯•
- [ ] å·²æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] å·²é€šè¿‡æ‰€æœ‰æµ‹è¯•
- [ ] å·²æ‰‹åŠ¨æµ‹è¯•

## Checklist
- [ ] ä»£ç ç¬¦åˆ ESLint è§„èŒƒ
- [ ] å·²æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] å·²æ·»åŠ å¿…è¦çš„æ³¨é‡Š
```

---

## é™„å½•A: ä»£ç å®¡æŸ¥æ¸…å•

### åŠŸèƒ½æ€§
- [ ] ä»£ç æ˜¯å¦å®ç°äº†éœ€æ±‚?
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†?
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„?

### å¯è¯»æ€§
- [ ] å‘½åæ˜¯å¦è¯­ä¹‰åŒ–?
- [ ] æ³¨é‡Šæ˜¯å¦å……åˆ†?
- [ ] ä»£ç é€»è¾‘æ˜¯å¦æ¸…æ™°?

### æ€§èƒ½
- [ ] æ˜¯å¦æœ‰æ€§èƒ½ç“¶é¢ˆ?
- [ ] å¾ªç¯æ˜¯å¦å¯ä¼˜åŒ–?
- [ ] æ˜¯å¦æœ‰å†…å­˜æ³„æ¼é£é™©?

### å®‰å…¨æ€§
- [ ] è¾“å…¥æ˜¯å¦æ ¡éªŒ?
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦åŠ å¯†?
- [ ] SQLæ³¨å…¥/XSS æ˜¯å¦é˜²æŠ¤?

### æµ‹è¯•
- [ ] æ˜¯å¦æœ‰å•å…ƒæµ‹è¯•?
- [ ] æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡?
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å……åˆ†?

---

## é™„å½•B: å¸¸ç”¨å·¥å…·é…ç½®

### package.json
```json
{
  "scripts": {
    "start": "node src/app.js",
    "dev": "nodemon src/app.js",
    "test": "jest",
    "test:coverage": "jest --coverage",
    "lint": "eslint src/**/*.js",
    "lint:fix": "eslint src/**/*.js --fix",
    "format": "prettier --write \"src/**/*.js\""
  },
  "devDependencies": {
    "eslint": "^8.0.0",
    "prettier": "^3.0.0",
    "jest": "^29.0.0",
    "nodemon": "^3.0.0"
  }
}
```

---

**æ–‡æ¡£ç»“æŸ**

**ç‰ˆæœ¬å†å²**:
- v1.0 (2025-10-27): åˆå§‹ç‰ˆæœ¬,å‚è€ƒé˜¿é‡Œå·´å·´å¼€å‘è§„çº¦
