# 知识星球训练营退款系统 v0 - 前期准备清单

## 📋 文档信息
- **版本**: v0.1
- **创建日期**: 2025-10-27
- **目标**: 确保项目能够顺利启动和部署
- **预计准备时间**: 1天

---

## 一、开发环境准备

### 1.1 软件环境清单

| 软件 | 版本要求 | 用途 | 安装验证命令 |
|------|---------|------|-------------|
| **Node.js** | 18+ (LTS) | 后端运行环境 | `node -v` |
| **npm** | 9+ | 依赖包管理 | `npm -v` |
| **Git** | 2.x+ | 版本控制 | `git --version` |
| **VS Code** | 最新版 | 代码编辑器 | - |

**安装步骤**:
```bash
# 1. 安装 Node.js (访问 nodejs.org 下载 LTS 版本)
# Windows: 下载 .msi 安装包
# 验证安装
node -v   # 应显示 v18.x.x 或更高
npm -v    # 应显示 9.x.x 或更高

# 2. 安装 Git (访问 git-scm.com)
git --version

# 3. 配置 npm 国内镜像 (可选,提升下载速度)
npm config set registry https://registry.npmmirror.com
```

### 1.2 VS Code 推荐插件

安装以下插件提升开发效率:

- **Vue Language Features (Volar)** - Vue 3 语法支持
- **ESLint** - 代码规范检查
- **Prettier** - 代码格式化
- **REST Client** - API 测试
- **GitLens** - Git 增强

---

## 二、知识星球配置准备 ⭐ 核心

### 2.1 获取知识星球 Cookie

**重要性**: ⭐⭐⭐⭐⭐ (最核心的配置,没有Cookie无法调用API)

**步骤**:

1. **打开知识星球网页版**
   - 访问: https://wx.zsxq.com/dweb2/index
   - 使用管理员账号登录

2. **打开浏览器开发者工具**
   - 按 `F12` 或 `右键 → 检查`
   - 切换到 `Network` (网络) 标签页

3. **抓取 API 请求**
   - 刷新页面或点击任意功能
   - 在 Network 中找到任意 `api.zsxq.com` 的请求
   - 点击该请求,查看 `Request Headers`

4. **复制以下字段** (需要完整复制):
   ```
   x-timestamp: 1730000000000
   authorization: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
   x-signature: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   x-request-id: xxxxxxxxxxxxxxxxxxxx
   ```

5. **找到圈子ID (GROUP_ID)**
   - 在 Network 中找到 `/v2/groups/{数字}/...` 这样的请求
   - 复制 `groups/` 后面的数字,例如: `15555411412112`

**示例截图位置**:
```
Request URL: https://api.zsxq.com/v2/groups/15555411412112/checkins
Request Headers:
  ├─ x-timestamp: 1730000000000
  ├─ authorization: 12345678-xxxx-xxxx-xxxx-xxxxxxxxxxxx
  ├─ x-signature: abc123def456...
  └─ x-request-id: req_123456789
```

**注意事项**:
- ⚠️ Cookie 有效期约 7-30 天,过期后需要重新抓取
- ⚠️ 不要泄露 Cookie,否则他人可以操作你的星球
- ✅ 建议用文本文件临时保存,部署时再填入 `.env`

---

### 2.2 测试知识星球 API 可用性 (可选)

**使用 Postman 或 REST Client 测试**:

```http
### 测试获取训练营列表
GET https://api.zsxq.com/v2/groups/15555411412112/checkins?scope=over&count=10
x-timestamp: {{你的timestamp}}
authorization: {{你的authorization}}
x-signature: {{你的signature}}
x-request-id: test_{{$timestamp}}
content-type: application/json
user-agent: xiaomiquan/5.28.1

# 预期响应: HTTP 200
# {
#   "succeeded": true,
#   "resp_data": { "checkins": [...] }
# }
```

**如果返回 401 Unauthorized**: Cookie 已过期或错误,需重新抓取

---

## 三、服务器准备 (生产部署用)

### 3.1 服务器配置要求

**推荐配置**:
- **CPU**: 2核
- **内存**: 4GB
- **磁盘**: 50GB
- **带宽**: 5Mbps+
- **操作系统**: Ubuntu 20.04 / 22.04 LTS

**云服务器推荐**:
- 腾讯云轻量应用服务器 (99元/年)
- 阿里云 ECS
- 华为云

### 3.2 域名准备

**需要准备**:
- 域名: `zsxq.dc401.com`
- DNS 解析: 将域名指向服务器 IP

**DNS 解析配置**:
```
类型: A 记录
主机记录: zsxq
记录值: 你的服务器公网IP (如 123.45.67.89)
TTL: 600
```

**验证解析生效**:
```bash
ping zsxq.dc401.com
# 应显示你的服务器IP
```

### 3.3 服务器软件环境准备

**登录服务器后执行**:

```bash
# 1. 更新系统
sudo apt update && sudo apt upgrade -y

# 2. 安装 Node.js 18+
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node -v   # 应显示 v18.x.x
npm -v

# 3. 安装 Nginx
sudo apt install -y nginx

# 启动 Nginx
sudo systemctl start nginx
sudo systemctl enable nginx  # 开机自启

# 验证 Nginx
curl http://localhost  # 应显示 Nginx 欢迎页面

# 4. 安装 PM2 (进程守护)
sudo npm install -g pm2

# 验证 PM2
pm2 --version

# 5. 安装 Certbot (HTTPS 证书)
sudo apt install -y certbot python3-certbot-nginx
```

---

## 四、API Key 准备

### 4.1 生成 API Key

**用途**: 前端调用后端接口时的鉴权凭证

**生成方式**:

**方法1: 使用在线工具**
- 访问: https://www.uuidgenerator.net/
- 生成一个 UUID v4
- 示例: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`

**方法2: 使用 Node.js 生成**
```bash
node -e "console.log(require('crypto').randomUUID())"
# 输出: a1b2c3d4-e5f6-7890-abcd-ef1234567890
```

**配置位置**:
- 后端: 写入 `.env` 文件的 `API_KEY` 字段
- 前端: 写入 `.env.production` 文件的 `VITE_API_KEY` 字段

---

## 五、环境变量模板准备

### 5.1 后端 .env 文件模板

创建 `zsxq-refund-api/.env` 文件:

```bash
# 服务配置
PORT=3013
NODE_ENV=production

# 知识星球配置
ZSXQ_GROUP_ID=15555411412112
ZSXQ_TIMESTAMP=1730000000000
ZSXQ_AUTHORIZATION=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
ZSXQ_SIGNATURE=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# API Key 鉴权
API_KEY=a1b2c3d4-e5f6-7890-abcd-ef1234567890

# 日志配置
LOG_LEVEL=info
LOG_RETENTION_DAYS=3
```

### 5.2 前端 .env.production 文件模板

创建 `zsxq-refund-web/.env.production` 文件:

```bash
# API 基础路径 (部署到同域名下,使用相对路径)
VITE_API_BASE_URL=/api

# API Key (需与后端保持一致)
VITE_API_KEY=a1b2c3d4-e5f6-7890-abcd-ef1234567890
```

---

## 六、Git 仓库准备

### 6.1 创建项目目录结构

```bash
# 在当前项目根目录下创建 v0 子目录
mkdir -p v0/zsxq-refund-api
mkdir -p v0/zsxq-refund-web
mkdir -p v0/docs
mkdir -p v0/deploy
```

### 6.2 创建 .gitignore 文件

**后端 .gitignore** (`v0/zsxq-refund-api/.gitignore`):
```
# 依赖
node_modules/

# 环境变量 (包含敏感信息,不提交)
.env

# 日志
logs/
*.log

# 编辑器
.vscode/
.idea/

# 系统文件
.DS_Store
Thumbs.db
```

**前端 .gitignore** (`v0/zsxq-refund-web/.gitignore`):
```
# 依赖
node_modules/

# 构建产物
dist/
dist-ssr/
*.local

# 环境变量 (生产环境配置不提交)
.env.production.local

# 编辑器
.vscode/
.idea/

# 系统文件
.DS_Store
```

---

## 七、开发工具准备

### 7.1 API 测试工具

**推荐工具 (选一个即可)**:

1. **Postman** (桌面端)
   - 下载: https://www.postman.com/downloads/
   - 功能: 完整的 API 测试环境

2. **REST Client** (VS Code 插件)
   - 安装: VS Code 插件商店搜索 "REST Client"
   - 功能: 在 `.http` 文件中直接测试 API

**创建测试文件** `v0/docs/api-test.http`:
```http
### 1. 测试获取训练营列表
GET {{baseUrl}}/api/camps?scope=over&count=10
X-API-Key: {{apiKey}}

### 2. 测试生成退款名单
POST {{baseUrl}}/api/camps/2424424541/refund-list
X-API-Key: {{apiKey}}
Content-Type: application/json

{
  "required_days": 7
}
```

### 7.2 文档编写工具

**推荐**:
- Markdown 编辑器: Typora / MarkText
- 流程图工具: draw.io / excalidraw
- 思维导图: XMind

---

## 八、技术文档准备

### 8.1 需要准备的文档 (已完成 ✅)

- ✅ **需求文档**: `docs/v0/需求文档-简版.md`
- ✅ **技术方案**: `docs/v0/技术方案-详细版.md`
- ✅ **前期准备清单**: `docs/v0/前期准备清单.md` (本文档)

### 8.2 需要补充的文档 (开发时创建)

- ⚪ **部署手册**: `v0/docs/部署手册.md` (服务器部署步骤)
- ⚪ **API 文档**: `v0/docs/API文档.md` (接口详细说明)
- ⚪ **测试报告**: `v0/docs/测试报告.md` (功能验收)

---

## 九、知识储备准备 (可选)

### 9.1 后端开发知识

**必备知识**:
- Node.js 基础 (模块、异步)
- Express.js 框架 (路由、中间件)
- HTTP 请求 (Axios)
- 环境变量管理 (dotenv)

**学习资源**:
- Express.js 官方文档: https://expressjs.com/
- Node.js 中文网: https://nodejs.cn/

### 9.2 前端开发知识

**必备知识**:
- Vue 3 Composition API
- Element Plus 组件库
- Axios 拦截器
- Excel 导出 (xlsx.js)
- 图片生成 (html2canvas)

**学习资源**:
- Vue 3 官方文档: https://cn.vuejs.org/
- Element Plus 官方文档: https://element-plus.org/zh-CN/

---

## 十、准备工作检查清单

### 10.1 开发环境检查

- [ ] Node.js 18+ 安装完成
- [ ] npm 国内镜像配置完成
- [ ] Git 安装完成
- [ ] VS Code 及插件安装完成

### 10.2 知识星球配置检查

- [ ] 知识星球管理员账号已登录
- [ ] Cookie 已抓取并保存 (x-timestamp, authorization, x-signature)
- [ ] 圈子 ID (GROUP_ID) 已获取
- [ ] 已测试 Cookie 有效性 (可选)

### 10.3 服务器准备检查 (生产环境)

- [ ] 服务器已购买并获取 IP
- [ ] 域名 `zsxq.dc401.com` 已解析到服务器 IP
- [ ] 服务器 SSH 连接正常
- [ ] Node.js、Nginx、PM2、Certbot 已安装

### 10.4 配置准备检查

- [ ] API Key 已生成
- [ ] 后端 `.env.example` 模板已创建
- [ ] 前端 `.env.production` 模板已创建
- [ ] `.gitignore` 文件已创建

### 10.5 项目目录检查

- [ ] `v0/zsxq-refund-api/` 目录已创建
- [ ] `v0/zsxq-refund-web/` 目录已创建
- [ ] `v0/docs/` 目录已创建
- [ ] `v0/deploy/` 目录已创建

---

## 十一、快速启动指南 (完成准备后)

### 11.1 本地开发环境启动

**后端启动**:
```bash
cd v0/zsxq-refund-api

# 1. 初始化项目
npm init -y
npm install express axios dotenv winston express-rate-limit

# 2. 创建 .env 文件并填入配置
cp .env.example .env
vim .env

# 3. 启动开发服务器
node src/app.js
# 或使用 nodemon 自动重启
npm install -g nodemon
nodemon src/app.js
```

**前端启动**:
```bash
cd v0/zsxq-refund-web

# 1. 创建 Vue 项目
npm create vite@latest . -- --template vue
npm install

# 2. 安装依赖
npm install element-plus axios vue-router xlsx html2canvas

# 3. 启动开发服务器
npm run dev
# 访问: http://localhost:5173
```

### 11.2 生产环境部署

**后端部署**:
```bash
# 1. 克隆代码到服务器
git clone <仓库地址> /var/www/zsxq-refund
cd /var/www/zsxq-refund/v0/zsxq-refund-api

# 2. 安装依赖
npm install --production

# 3. 配置 .env 文件
cp .env.example .env
vim .env  # 填入生产环境配置

# 4. 使用 PM2 启动
pm2 start src/app.js --name zsxq-api
pm2 save
pm2 startup
```

**前端部署**:
```bash
cd /var/www/zsxq-refund/v0/zsxq-refund-web

# 1. 安装依赖
npm install

# 2. 构建生产版本
npm run build

# 3. 配置 Nginx
sudo vim /etc/nginx/sites-available/zsxq.dc401.com
# (配置内容见部署手册)

# 4. 启动 Nginx
sudo nginx -t  # 测试配置
sudo systemctl reload nginx
```

---

## 十二、常见问题预案

### 12.1 Cookie 过期处理

**现象**: API 返回 401 Unauthorized

**解决方案**:
1. 重新登录知识星球网页版
2. 按照 [2.1 获取知识星球 Cookie](#21-获取知识星球-cookie) 步骤重新抓取
3. 更新 `.env` 文件中的 Cookie 配置
4. 重启后端服务: `pm2 restart zsxq-api`

### 12.2 API 限流处理

**现象**: 知识星球返回 429 Too Many Requests

**解决方案**:
- 后端已实现分页间隔 200ms
- 如仍触发限流,增加延迟到 500ms

### 12.3 前端跨域问题

**开发环境**: 在 `vite.config.js` 中配置代理
```javascript
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3013',
        changeOrigin: true
      }
    }
  }
}
```

**生产环境**: Nginx 反向代理自动解决跨域

---

## 十三、时间规划建议

### 13.1 准备阶段 (Day 0: 4-6 小时)

**上午 (2-3 小时)**:
- [ ] 安装开发环境 (Node.js、VS Code 等)
- [ ] 抓取知识星球 Cookie
- [ ] 生成 API Key

**下午 (2-3 小时)**:
- [ ] 创建项目目录结构
- [ ] 配置环境变量模板
- [ ] 测试知识星球 API (可选)

### 13.2 开发阶段 (Day 1-2: 参考技术方案)

**Day 1**: 后端开发 + 前端框架搭建
**Day 2**: 前端功能开发 + 联调测试

### 13.3 部署阶段 (Day 3-4: 参考部署手册)

**Day 3**: 服务器配置 + 后端部署
**Day 4**: 前端部署 + HTTPS 配置 + 验收测试

---

## 附录: 快速检查命令

**一键检查开发环境**:
```bash
echo "=== 开发环境检查 ==="
echo "Node.js: $(node -v)"
echo "npm: $(npm -v)"
echo "Git: $(git --version)"
echo "=== 检查完成 ==="
```

**一键检查服务器环境**:
```bash
echo "=== 服务器环境检查 ==="
echo "Node.js: $(node -v)"
echo "Nginx: $(nginx -v 2>&1)"
echo "PM2: $(pm2 --version)"
echo "Certbot: $(certbot --version)"
echo "=== 检查完成 ==="
```

---

**文档结束**

**下一步**: 完成本清单后,开始执行 `技术方案-详细版.md` 中的 **Day 1 任务**