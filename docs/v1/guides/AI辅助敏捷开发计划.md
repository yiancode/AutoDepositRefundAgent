# AI è¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’

> **é€‚ç”¨åœºæ™¯**ï¼šå…¨ç¨‹ä½¿ç”¨ AI è¿›è¡Œç¼–ç ï¼Œäººå·¥åªè´Ÿè´£å…³é”®è®¾è®¡å’ŒåŠŸèƒ½æµ‹è¯•
> **å¼€å‘æ¨¡å¼**ï¼šVibe Codingï¼ˆAI é©±åŠ¨å¼€å‘ï¼‰
> **æ€»æ—¶é•¿**ï¼š27 å¤©ï¼ˆStage 0-6 + é›†æˆæµ‹è¯•ï¼‰
> **åŸåˆ™**ï¼šæ¯ä¸ªè¿­ä»£éƒ½èƒ½ç‹¬ç«‹è¿è¡Œå’Œæµ‹è¯•

---

## ğŸ“‹ å¼€å‘åŸåˆ™

### 1. æœ€å°å¯æµ‹è¯•å•å…ƒ
- æ¯ä¸ª Stage å®Œæˆåéƒ½èƒ½ç‹¬ç«‹è¿è¡Œ
- æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†
- æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰å•å…ƒæµ‹è¯•

### 2. å‚ç›´åˆ‡ç‰‡
- æ¯ä¸ªè¿­ä»£éƒ½åŒ…å«å‰åç«¯å®Œæ•´åŠŸèƒ½
- ä¼˜å…ˆå®Œæˆç«¯åˆ°ç«¯çš„åŠŸèƒ½æµç¨‹
- é¿å…"å‰ç«¯ç­‰åç«¯"çš„æƒ…å†µ

### 3. ä¾èµ–æœ€å°åŒ–
- ä¼˜å…ˆå¼€å‘ä½ä¾èµ–æ¨¡å—
- å¤–éƒ¨ä¾èµ–ä½¿ç”¨ Mock
- é¿å…é˜»å¡æ€§ä»»åŠ¡

### 4. æµ‹è¯•é©±åŠ¨
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
- æ¥å£å¿…é¡»æœ‰é›†æˆæµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ï¼šæ ¸å¿ƒä¸šåŠ¡ â‰¥ 80%

---

## ğŸš€ è¿­ä»£è®¡åˆ’æ€»è§ˆ

> **å¯¹é½æ–‡æ¡£**ï¼šæœ¬è®¡åˆ’é‡‡ç”¨å‚ç›´åˆ‡ç‰‡åŸåˆ™ï¼Œä¼˜å…ˆå®Œæˆç«¯åˆ°ç«¯æ ¸å¿ƒä¸šåŠ¡æµç¨‹
> **ä¼˜åŒ–ä¾æ®**ï¼šå‚è€ƒã€Š[ä¼˜åŒ–å®Œæˆæ€»ç»“](../archive/ä¼˜åŒ–å®Œæˆæ€»ç»“.md) - P1-1ã€‹ï¼Œè°ƒæ•´ä¸ºæ”¯ä»˜é—­ç¯ä¼˜å…ˆ

| Stage | æ—¶é•¿ | ç›®æ ‡ | äº¤ä»˜ç‰© | ä¼˜åŒ–è¯´æ˜ |
|-------|------|------|--------|---------|
| Stage 0 | 2å¤© | **æœ€å°ç¯å¢ƒéª¨æ¶** | åç«¯éª¨æ¶ + æ ¸å¿ƒ4è¡¨ + H5éª¨æ¶ | âš ï¸ ä¸å«å®Œæ•´16è¡¨ï¼Œä¸å«ç®¡ç†åå° |
| Stage 1 | 5å¤© | **â­ æ”¯ä»˜é—­ç¯ï¼ˆå‚ç›´åˆ‡ç‰‡ï¼‰** | OAuth + æ”¯ä»˜è®¢å• + ç»‘å®šæ˜Ÿçƒè´¦å· + H5æ”¯ä»˜é¡µé¢ | ğŸ”„ **å·²ä¼˜åŒ–**ï¼šä¼˜å…ˆå®Œæˆæ ¸å¿ƒæ”¯ä»˜è·¯å¾„ |
| Stage 2 | 5å¤© | **ç®¡ç†åå° + æ‰“å¡åŒæ­¥** | è®­ç»ƒè¥CRUD + ç®¡ç†åå°éª¨æ¶ + çŸ¥è¯†æ˜Ÿçƒæ‰“å¡åŒæ­¥ | ğŸ”„ **å·²è°ƒæ•´**ï¼šç®¡ç†åŠŸèƒ½ä¸åŒæ­¥ä»»åŠ¡å¹¶è¡Œ |
| Stage 3 | 3å¤© | èº«ä»½åŒ¹é…ç®—æ³• | bind_statusä¼˜å…ˆ + æ™ºèƒ½åŒ¹é… | âœ… åŸºäºStage 1çš„çœŸå®æ”¯ä»˜æ•°æ®æµ‹è¯• |
| Stage 4 | 4å¤© | é€€æ¬¾æµç¨‹ | å®¡æ ¸ + æ‰§è¡Œ + é€šçŸ¥ | âœ… Stage 3 |
| Stage 5 | 4å¤© | å‰ç«¯å®Œå–„ + ç³»ç»Ÿç®¡ç† | H5å®Œæ•´é¡µé¢ + ç®¡ç†åå°å®Œå–„ + ç»Ÿè®¡æŠ¥è¡¨ | âœ… Stage 4 |

**ä¼˜åŒ–è¦ç‚¹**ï¼š
- âœ… Stage 1 ä¼˜å…ˆå®ç°æ”¯ä»˜é—­ç¯ï¼Œæœ€æ—©æš´éœ²æ ¸å¿ƒä¸šåŠ¡é£é™©
- âœ… ç®¡ç†åå°ä¸æ‰“å¡åŒæ­¥å¯å¹¶è¡Œå¼€å‘ï¼Œä¸é˜»å¡å…³é”®è·¯å¾„
- âœ… æ¯ä¸ªStageéƒ½èƒ½ç‹¬ç«‹è¿è¡Œå’ŒéªŒè¯æ ¸å¿ƒåŠŸèƒ½

---

## Stage 0ï¼šç¯å¢ƒæ­å»ºå’Œé¡¹ç›®éª¨æ¶ï¼ˆ2å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
æ­å»ºå¯è¿è¡Œçš„æœ€å°åç«¯éª¨æ¶ + æ ¸å¿ƒæ•°æ®è¡¨ï¼ŒéªŒè¯æŠ€æœ¯æ ˆå¯è¡Œæ€§

**æœ€å°å¯æµ‹è¯•å•å…ƒåŸåˆ™**ï¼š
- âœ… åç«¯é¡¹ç›®èƒ½å¯åŠ¨ï¼ŒAPI æ–‡æ¡£å¯è®¿é—®
- âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼Œæ ¸å¿ƒ4è¡¨ï¼ˆcampsã€ordersã€camp_membersã€refundsï¼‰åˆ›å»ºæˆåŠŸ
- âœ… H5 å‰ç«¯éª¨æ¶èƒ½å¯åŠ¨ï¼ˆä»…éªŒè¯æŠ€æœ¯æ ˆï¼‰
- âŒ ä¸åŒ…å«å®Œæ•´çš„ 16 å¼ è¡¨ï¼ˆæŒ‰éœ€åœ¨åç»­ Stage åˆ›å»ºï¼‰
- âŒ ä¸åŒ…å«å®Œæ•´çš„é¡µé¢å’Œè·¯ç”±ï¼ˆåœ¨åŠŸèƒ½å¼€å‘æ—¶åˆ›å»ºï¼‰
- âŒ ä¸åŒ…å«ç®¡ç†åå°ï¼ˆç§»è‡³ Stage 1ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 0.1ï¼šåç«¯é¡¹ç›®éª¨æ¶æ­å»º
- **ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…é¡»å®Œæˆï¼‰
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šå¯è¿è¡Œçš„ Spring Boot é¡¹ç›® + Knife4j æ–‡æ¡£
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… `./gradlew bootRun` å¯åŠ¨æˆåŠŸ
  - âœ… è®¿é—® http://localhost:8080/doc.html æ˜¾ç¤º API æ–‡æ¡£
  - âœ… å¥åº·æ£€æŸ¥æ¥å£ `/api/health` è¿”å› 200

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 0.1ï¼‰

```markdown
æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ª Spring Boot 3.2+ çš„åç«¯é¡¹ç›®éª¨æ¶ï¼Œè¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

ã€é¡¹ç›®è¦æ±‚ã€‘
- é¡¹ç›®åç§°ï¼šcamp-backend
- åŸºç¡€åŒ…åï¼šcom.camp
- ç«¯å£ï¼š8080
- Java ç‰ˆæœ¬ï¼š17
- æ„å»ºå·¥å…·ï¼šGradle

ã€ä¾èµ–æ¸…å•ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 4.2 æŠ€æœ¯é€‰å‹ï¼‰
1. Spring Boot Starter Web
2. Spring Boot Starter Securityï¼ˆæš‚æ—¶ç¦ç”¨ï¼Œåç»­é…ç½®ï¼‰
3. Spring Boot Starter Validation
4. MyBatis Plus 3.5.5+
5. PostgreSQL é©±åŠ¨
6. Redis Spring Boot Starter
7. Lombok
8. Knife4j 4.xï¼ˆAPI æ–‡æ¡£ï¼‰
9. OkHttp3ï¼ˆHTTP å®¢æˆ·ç«¯ï¼‰
10. Hutoolï¼ˆå·¥å…·ç±»ï¼‰

ã€ç›®å½•ç»“æ„ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.5.1 é¡¹ç›®ç»“æ„ï¼‰
backend/
â”œâ”€â”€ src/main/java/com/camp/
â”‚   â”œâ”€â”€ CampApplication.java          # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ MybatisPlusConfig.java    # MyBatis Plus é…ç½®
â”‚   â”‚   â”œâ”€â”€ RedisConfig.java          # Redis é…ç½®
â”‚   â”‚   â”œâ”€â”€ Knife4jConfig.java        # API æ–‡æ¡£é…ç½®
â”‚   â”‚   â””â”€â”€ CorsConfig.java           # CORS è·¨åŸŸé…ç½®
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ Result.java               # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ ResultCode.java           # é”™è¯¯ç æšä¸¾
â”‚   â”‚   â”œâ”€â”€ BusinessException.java    # ä¸šåŠ¡å¼‚å¸¸
â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java  # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ admin/                    # ç®¡ç†ç«¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ h5/                       # H5ç«¯æ¥å£
â”‚   â”‚   â””â”€â”€ webhook/                  # Webhookæ¥å£
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ mapper/
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â”œâ”€â”€ CampStatus.java
â”‚   â”‚   â”œâ”€â”€ PaymentStatus.java
â”‚   â”‚   â”œâ”€â”€ BindStatus.java           # ç»‘å®šçŠ¶æ€æšä¸¾
â”‚   â”‚   â”œâ”€â”€ PaymentBindMethod.java    # ç»‘å®šæ–¹å¼æšä¸¾
â”‚   â”‚   â”œâ”€â”€ MatchStatus.java
â”‚   â”‚   â””â”€â”€ RefundStatus.java
â”‚   â”œâ”€â”€ manager/                      # ç¬¬ä¸‰æ–¹APIå°è£…
â”‚   â”‚   â”œâ”€â”€ WechatPayManager.java
â”‚   â”‚   â”œâ”€â”€ PlanetApiManager.java
â”‚   â”‚   â””â”€â”€ WechatNotifyManager.java
â”‚   â”œâ”€â”€ schedule/                     # å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ util/

ã€é…ç½®è¦æ±‚ã€‘
1. application.ymlï¼š
   - æ•°æ®æºï¼šPostgreSQL (localhost:5432/camp_db)
   - Redisï¼šlocalhost:6379
   - æ—¥å¿—çº§åˆ«ï¼šINFO

2. ç»Ÿä¸€å“åº”æ ¼å¼ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.2ï¼‰ï¼š
   ```json
   {
     "code": 200,
     "message": "æˆåŠŸ",
     "data": {},
     "timestamp": 1234567890
   }
```

3. å…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£é”™è¯¯ç ï¼‰ï¼š
   - ValidationException â†’ 400
   - BusinessException â†’ è‡ªå®šä¹‰é”™è¯¯ç ï¼ˆ1001-1499ï¼‰
   - Exception â†’ 500

ã€éªŒæ”¶æ ‡å‡†ã€‘
1. è¿è¡Œ `./gradlew bootRun` æˆåŠŸå¯åŠ¨
2. è®¿é—® http://localhost:8080/doc.html æ˜¾ç¤º Knife4j æ–‡æ¡£
3. è®¿é—® http://localhost:8080/api/health è¿”å›æˆåŠŸ

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç ï¼ŒåŒ…æ‹¬ build.gradle å’Œæ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚
```

---

#### ä»»åŠ¡ 0.2ï¼šæ ¸å¿ƒæ•°æ®è¡¨åˆ›å»ºï¼ˆæœ€å°é›†åˆï¼‰
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šæ ¸å¿ƒ 4 å¼ è¡¨çš„æ•°æ®åº“è„šæœ¬
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ‰§è¡Œ SQL è„šæœ¬æˆåŠŸåˆ›å»º 4 å¼ æ ¸å¿ƒè¡¨
  - âœ… ç´¢å¼•åˆ›å»ºæˆåŠŸ
  - âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡

**æ ¸å¿ƒè¡¨æ¸…å•**ï¼ˆå…¶ä»–è¡¨åœ¨åç»­ Stage æŒ‰éœ€åˆ›å»ºï¼‰ï¼š
1. `training_camp` - è®­ç»ƒè¥åŸºæœ¬ä¿¡æ¯
2. `planet_user` - çŸ¥è¯†æ˜Ÿçƒç”¨æˆ·ä¿¡æ¯
3. `system_user` - ç³»ç»Ÿç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰
4. `system_config` - ç³»ç»Ÿé…ç½®

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 0.2ï¼‰

```markdown
æˆ‘éœ€è¦ç”Ÿæˆ PostgreSQL æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼Œåˆ›å»º **æœ€å°æ ¸å¿ƒè¡¨é›†åˆ**ï¼ˆ4å¼ è¡¨ï¼‰ï¼š

ã€è¡¨æ¸…å•ã€‘
1. **training_camp** - è®­ç»ƒè¥åŸºæœ¬ä¿¡æ¯
   - å…³é”®å­—æ®µï¼šid, name, description, deposit_amount, start_date, end_date, status, created_at, updated_at
   - ç´¢å¼•ï¼šstatus, start_date

2. **planet_user** - çŸ¥è¯†æ˜Ÿçƒç”¨æˆ·ä¿¡æ¯ï¼ˆå‚è€ƒæ•°æ®åº“è®¾è®¡.mdï¼‰
   - å…³é”®å­—æ®µï¼šid, planet_user_id, planet_nickname, user_number, avatar_url, joined_at, role, member_status, raw_data (JSONB), synced_at, created_at, updated_at
   - ç´¢å¼•ï¼šplanet_user_id, user_number, planet_nickname

3. **system_user** - ç³»ç»Ÿç”¨æˆ·
   - å…³é”®å­—æ®µï¼šid, username, password, real_name, role, status, created_at, updated_at
   - ç´¢å¼•ï¼šusername

4. **system_config** - ç³»ç»Ÿé…ç½®
   - å…³é”®å­—æ®µï¼šid, config_key, config_value, description, created_at, updated_at
   - ç´¢å¼•ï¼šconfig_key

ã€è„šæœ¬è¦æ±‚ã€‘
1. æ–‡ä»¶ï¼šsql/init-database-stage0.sql
2. åŒ…å«åˆ›å»ºè¡¨ã€ç´¢å¼•ã€æ³¨é‡Š
3. æ’å…¥åˆå§‹æ•°æ®ï¼š
   - é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼ˆadmin/admin123ï¼Œå¯†ç éœ€ BCrypt åŠ å¯†ï¼‰
   - çŸ¥è¯†æ˜Ÿçƒ Cookie é…ç½®é¡¹

ã€å…¶ä»–è¡¨åˆ›å»ºè®¡åˆ’ã€‘ï¼ˆä¸åœ¨ Stage 0 åˆ›å»ºï¼‰ï¼š
- Stage 1: payment_record, payment_bind_status_log, camp_status_log, operation_log
- Stage 2: checkin_record, camp_member
- Stage 3: refund_record, refund_status_log
- Stage 4-6: notification_message, camp_member_relation, order_status_log, member_status_log

è¯·ç”Ÿæˆå®Œæ•´çš„ SQL è„šæœ¬ï¼Œä¸¥æ ¼æŒ‰ç…§æ•°æ®åº“è®¾è®¡æ–‡æ¡£çš„å­—æ®µå®šä¹‰ã€‚
```

---

#### ä»»åŠ¡ 0.3ï¼šH5 å‰ç«¯éª¨æ¶æ­å»ºï¼ˆæœ€å°éªŒè¯ï¼‰
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šå¯è¿è¡Œçš„ Vue 3 + Vant æœ€å°éª¨æ¶
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… `npm run dev` å¯åŠ¨æˆåŠŸ
  - âœ… è®¿é—®é¦–é¡µæ˜¾ç¤º "Hello Camp" æ–‡å­—
  - âœ… Axios åŸºç¡€å°è£…å®Œæˆï¼ˆåŒ…å« baseURL é…ç½®ï¼‰

**æœ€å°éª¨æ¶åŸåˆ™**ï¼š
- âœ… é¡¹ç›®èƒ½å¯åŠ¨ï¼ŒéªŒè¯ Vue 3 + Vite + Vant æŠ€æœ¯æ ˆ
- âœ… Axios å°è£…ï¼ˆä¸åŒ…å« accessTokenï¼Œåç»­æ·»åŠ ï¼‰
- âŒ ä¸åŒ…å«å…·ä½“é¡µé¢å’Œè·¯ç”±ï¼ˆåœ¨ Stage 1-6 æŒ‰éœ€åˆ›å»ºï¼‰
- âŒ ä¸åŒ…å«çŠ¶æ€ç®¡ç†ï¼ˆPinia åœ¨éœ€è¦æ—¶å¼•å…¥ï¼‰

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 0.3ï¼‰

```markdown
æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ª Vue 3 + Vant çš„ H5 ä¼šå‘˜ç«¯**æœ€å°éª¨æ¶**ï¼Œä»…éªŒè¯æŠ€æœ¯æ ˆå¯è¡Œæ€§ï¼š

ã€é¡¹ç›®è¦æ±‚ã€‘
- é¡¹ç›®åç§°ï¼šh5-member
- ç›®å½•ä½ç½®ï¼šfrontend/h5-member/
- æŠ€æœ¯æ ˆï¼šVue 3.3+ + Vite 5.x + Vant 4.x
- **ä¸éœ€è¦**ï¼šå®Œæ•´é¡µé¢ã€è·¯ç”±é…ç½®ã€çŠ¶æ€ç®¡ç†ï¼ˆåç»­æ·»åŠ ï¼‰

ã€ç›®å½•ç»“æ„ã€‘ï¼ˆæœ€å°åŒ–ï¼‰
frontend/h5-member/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js
â”‚   â”œâ”€â”€ App.vue              # åªæ˜¾ç¤º "Hello Camp" æ–‡å­—
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ request.js       # Axios åŸºç¡€å°è£…ï¼ˆä¸å« accessTokenï¼‰

ã€Axios åŸºç¡€å°è£…ã€‘ï¼ˆæœ€å°ç‰ˆæœ¬ï¼‰
```javascript
// utils/request.js
import axios from 'axios'

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/api',
  timeout: 10000
})

// å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€å¤„ç†å“åº”
request.interceptors.response.use(
  response => response.data,
  error => {
    console.error('è¯·æ±‚å¤±è´¥:', error)
    return Promise.reject(error)
  }
)

export default request
```

ã€é…ç½®æ–‡ä»¶ã€‘
- package.jsonï¼šVue 3 + Vite + Vant 4
- vite.config.jsï¼šåŸºç¡€é…ç½®
- .env.developmentï¼šVITE_API_BASE_URL=http://localhost:8080/api

ã€éªŒæ”¶æ ‡å‡†ã€‘
1. npm run dev å¯åŠ¨æˆåŠŸï¼Œè®¿é—® http://localhost:5173
2. é¡µé¢æ˜¾ç¤º "Hello Camp" æ–‡å­—
3. æ§åˆ¶å°æ— æŠ¥é”™

è¯·ç”Ÿæˆå®Œæ•´çš„æœ€å°éª¨æ¶ä»£ç ã€‚å…·ä½“é¡µé¢å’Œè·¯ç”±å°†åœ¨åç»­ Stage å¼€å‘ã€‚
```

---

**ä»»åŠ¡ 0.4 å·²ç§»é™¤**ï¼šWeb ç®¡ç†åå°éª¨æ¶ç§»è‡³ Stage 1ï¼ˆä¸ç®¡ç†å‘˜åŠŸèƒ½ä¸€èµ·å¼€å‘ï¼‰

---

## Stage 1ï¼šæ”¯ä»˜é—­ç¯ï¼ˆå‚ç›´åˆ‡ç‰‡ï¼‰ï¼ˆ5å¤©ï¼‰

> **â­ é‡è¦å˜æ›´**ï¼šStage 1 å·²ä¼˜åŒ–ä¸ºæ”¯ä»˜é—­ç¯ä¼˜å…ˆï¼Œè¯¦è§ [Stage1-æ”¯ä»˜é—­ç¯å®æ–½æŒ‡å—.md](./Stage1-æ”¯ä»˜é—­ç¯å®æ–½æŒ‡å—.md)

### ğŸ¯ ç›®æ ‡
å®Œæˆ"ç”¨æˆ·æŠ¥åâ†’OAuthæˆæƒâ†’æ”¯ä»˜â†’ç»‘å®šæ˜Ÿçƒè´¦å·"ç«¯åˆ°ç«¯æµç¨‹ï¼Œæœ€æ—©æš´éœ²æ ¸å¿ƒä¸šåŠ¡é£é™©

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… æ”¯ä»˜æ˜¯æ ¸å¿ƒä¸šåŠ¡ï¼Œä¼˜å…ˆéªŒè¯å¾®ä¿¡æ”¯ä»˜å¯¹æ¥ã€å¹‚ç­‰æ€§ã€å®‰å…¨æœºåˆ¶
- âœ… å‰åç«¯å¯åŸºäºæ˜ç¡®æ¥å£å¹¶è¡Œå¼€å‘
- âœ… æœ€æ—©å¯æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
- âœ… ç®¡ç†åå°ä¸é˜»å¡å…³é”®è·¯å¾„ï¼Œç§»è‡³Stage 2

### ğŸ“¦ ä»»åŠ¡æ¸…å•ï¼ˆè¯¦è§å®æ–½æŒ‡å—ï¼‰

**åç«¯ä»»åŠ¡**ï¼ˆå…±16å°æ—¶ï¼‰ï¼š
- ä»»åŠ¡ 1.1ï¼šOAuthæˆæƒæµç¨‹ï¼ˆ4å°æ—¶ï¼‰
- ä»»åŠ¡ 1.2ï¼šåˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆ3å°æ—¶ï¼‰
- ä»»åŠ¡ 1.3ï¼šå¾®ä¿¡æ”¯ä»˜å›è°ƒå¤„ç†ï¼ˆ4å°æ—¶ï¼‰
- ä»»åŠ¡ 1.4ï¼šç»‘å®šæ˜Ÿçƒè´¦å·ï¼ˆ3å°æ—¶ï¼‰
- ä»»åŠ¡ 1.5ï¼šæŸ¥è¯¢è®¢å•çŠ¶æ€ï¼ˆ2å°æ—¶ï¼‰

**å‰ç«¯ä»»åŠ¡**ï¼ˆå…±6å°æ—¶ï¼‰ï¼š
- ä»»åŠ¡ 1.6ï¼šH5æ”¯ä»˜é¡µé¢ï¼ˆè®­ç»ƒè¥è¯¦æƒ…ã€æ”¯ä»˜ã€ç»‘å®šï¼‰

**å®Œæ•´å®æ–½ç»†èŠ‚ã€AIæç¤ºè¯ã€éªŒæ”¶æ ‡å‡†**ï¼Œè¯·æŸ¥çœ‹ï¼š
ğŸ‘‰ [Stage1-æ”¯ä»˜é—­ç¯å®æ–½æŒ‡å—.md](./Stage1-æ”¯ä»˜é—­ç¯å®æ–½æŒ‡å—.md)

---

### ç®€åŒ–ç‰ˆä»»åŠ¡è¯´æ˜ï¼ˆåŸè¯¦ç»†ç‰ˆå·²ç§»è‡³å®æ–½æŒ‡å—ï¼‰

#### ä»»åŠ¡ 1.1ï¼šOAuthæˆæƒæµç¨‹
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šJWT å·¥å…·ç±» + Spring Security é…ç½®
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç™»å½•æ¥å£è¿”å›æœ‰æ•ˆ Token
  - âœ… è®¿é—® /api/admin/** éœ€è¦ Token
  - âœ… H5 å…¬å¼€æ¥å£æ— éœ€ Token

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 1.1ï¼‰

```markdown
æˆ‘éœ€è¦åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT è®¤è¯ï¼Œè¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

ã€å®‰å…¨é…ç½®ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.3 è®¤è¯æ–¹å¼ï¼‰

1. ç™½åå•ï¼ˆæ— éœ€è®¤è¯ï¼‰ï¼š
   - /api/h5/camps, /api/h5/camps/{id}  # è®­ç»ƒè¥åˆ—è¡¨/è¯¦æƒ…
   - /api/h5/payments                   # åˆ›å»ºæ”¯ä»˜è®¢å•
   - /api/h5/payments/{orderNo}/params  # è·å–æ”¯ä»˜å‚æ•°
   - /api/h5/payments/{orderNo}/status  # æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
   - /api/auth/login                    # ç™»å½•
   - /doc.html, /webjars/**             # API æ–‡æ¡£

2. éœ€è¦ JWT è®¤è¯ï¼ˆ/api/admin/**ï¼‰ï¼š
   - è®­ç»ƒè¥ç®¡ç†ã€ä¼šå‘˜ç®¡ç†ã€é€€æ¬¾ç®¡ç†ã€ç»Ÿè®¡æŠ¥è¡¨

3. éœ€è¦ accessToken éªŒè¯ï¼ˆH5 æ•æ„Ÿæ¥å£ï¼‰ï¼š
   - /api/h5/payments/bind              # ç”¨æˆ·ç»‘å®š
   - /api/h5/payments/{orderNo}/qrcode  # è·å–ç¾¤äºŒç»´ç 
   - /api/h5/progress/{memberId}        # æ‰“å¡è¿›åº¦

ã€éœ€è¦åˆ›å»ºçš„ç±»ã€‘
1. JwtUtil.java - Token ç”Ÿæˆ/è§£æ/éªŒè¯
2. SecurityConfig.java - Spring Security é…ç½®
3. JwtAuthenticationFilter.java - JWT è¿‡æ»¤å™¨
4. AccessTokenFilter.java - H5 accessToken è¿‡æ»¤å™¨ï¼ˆæ–°å¢ï¼‰

ã€accessToken æœºåˆ¶ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.3ï¼‰
- æ ¼å¼ï¼šUUID v4ï¼Œå‰ç¼€ `tk_`
- æœ‰æ•ˆæœŸï¼šè®­ç»ƒè¥ç»“æŸå 7 å¤©
- å­˜å‚¨ï¼šRedisï¼ˆaccess_token:{token} â†’ {orderNo, status, campEndDate}ï¼‰
- çŠ¶æ€ï¼šactive â†’ bound â†’ expired

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç ã€‚
```

---

#### ä»»åŠ¡ 1.2ï¼šç™»å½•æ³¨å†Œæ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šç™»å½•ã€æ³¨å†Œæ¥å£ + å•å…ƒæµ‹è¯•
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… POST /api/auth/login è¿”å› Token
  - âœ… å¯†ç ä½¿ç”¨ BCrypt åŠ å¯†

---

#### ä»»åŠ¡ 1.3ï¼šè®­ç»ƒè¥ CRUD æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šè®­ç»ƒè¥ CRUD æ¥å£ + å•å…ƒæµ‹è¯•
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ‰€æœ‰æ¥å£é€šè¿‡ Postman æµ‹è¯•
  - âœ… åˆ†é¡µæŸ¥è¯¢æ­£å¸¸

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 1.3ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°è®­ç»ƒè¥ç®¡ç†çš„ CRUD æ¥å£ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ã€Šæ¥å£æ–‡æ¡£.mdã€‹ç¬¬å››ç« å®ç°ï¼š

ã€æ¥å£æ¸…å•ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 4.1-4.6ï¼‰
1. POST /api/admin/camps - åˆ›å»ºè®­ç»ƒè¥
2. GET /api/admin/camps - è®­ç»ƒè¥åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
3. GET /api/admin/camps/{id} - è®­ç»ƒè¥è¯¦æƒ…
4. PUT /api/admin/camps/{id} - æ›´æ–°è®­ç»ƒè¥
5. DELETE /api/admin/camps/{id} - åˆ é™¤è®­ç»ƒè¥ï¼ˆè½¯åˆ é™¤ï¼‰
6. POST /api/admin/camps/{id}/publish - å‘å¸ƒè®­ç»ƒè¥

ã€H5 æ¥å£ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 3.1-3.2ï¼‰
7. GET /api/h5/camps - è®­ç»ƒè¥åˆ—è¡¨ï¼ˆæ— éœ€è®¤è¯ï¼‰
8. GET /api/h5/camps/{id}?planetUserId=xxx - è®­ç»ƒè¥è¯¦æƒ…ï¼ˆå«é¢„å¡«ä¿¡æ¯ï¼‰

ã€æ•°æ®åº“è¡¨ã€‘ï¼ˆå‚è€ƒæ•°æ®åº“è®¾è®¡ training_campï¼‰
- id, name, poster_url, description, deposit, start_date, end_date
- total_days, required_days, group_qrcode_url, planet_project_id
- statusï¼ˆçŠ¶æ€æœºï¼šdraft â†’ pending â†’ enrolling â†’ ongoing â†’ ended â†’ settling â†’ archivedï¼‰
- enroll_url, member_count, paid_amount, refunded_amount

ã€çŠ¶æ€æœºå®ç°ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.4.1ï¼‰
æ¯æ¬¡çŠ¶æ€å˜æ›´éœ€è®°å½•åˆ° camp_status_log è¡¨ï¼š
- è®°å½• from_status, to_status, event, operator_id

ã€éªŒæ”¶æ ‡å‡†ã€‘
1. åˆ›å»ºè®­ç»ƒè¥æ—¶è‡ªåŠ¨è®¡ç®— total_days
2. å‘å¸ƒæ—¶ç”Ÿæˆ enroll_url
3. çŠ¶æ€å˜æ›´è®°å½•åˆ°æ—¥å¿—è¡¨

ã€æ¥å£å¥‘çº¦è¦æ±‚ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.2 ç»Ÿä¸€å“åº”æ ¼å¼ï¼‰
1. **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼š
   ```json
   {
     "code": 200,
     "message": "æˆåŠŸ",
     "data": {...},
     "timestamp": 1234567890
   }
   ```

2. **é”™è¯¯ç è§„èŒƒ**ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.4ï¼‰ï¼š
   - å‚æ•°æ ¡éªŒå¤±è´¥ï¼š400 + å…·ä½“å­—æ®µé”™è¯¯ä¿¡æ¯
   - ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼šè‡ªå®šä¹‰é”™è¯¯ç ï¼ˆ1001-1499ï¼‰
   - ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼š500

3. **åˆ†é¡µå“åº”æ ¼å¼**ï¼š
   ```json
   {
     "code": 200,
     "data": {
       "items": [...],
       "total": 100,
       "page": 1,
       "pageSize": 20
     }
   }
   ```

ã€æµ‹è¯•è¦æ±‚ã€‘
1. **å•å…ƒæµ‹è¯•**ï¼ˆä½¿ç”¨ JUnit 5 + Mockitoï¼‰ï¼š
   - Service å±‚æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
   - æµ‹è¯•è¦†ç›–ç‡ï¼šåˆ†æ”¯è¦†ç›– â‰¥ 80%
   - æµ‹è¯•ç”¨ä¾‹åŒ…å«ï¼šæ­£å¸¸æµç¨‹ã€è¾¹ç•Œæ¡ä»¶ã€å¼‚å¸¸æƒ…å†µ

2. **é›†æˆæµ‹è¯•**ï¼ˆä½¿ç”¨ Spring Boot Testï¼‰ï¼š
   - Controller å±‚æ¥å£æµ‹è¯•
   - éªŒè¯è¯·æ±‚å‚æ•°æ ¡éªŒ
   - éªŒè¯å“åº”æ ¼å¼ç¬¦åˆå¥‘çº¦
   - éªŒè¯æ•°æ®åº“æ“ä½œæ­£ç¡®æ€§

3. **æµ‹è¯•å‘½ä»¤**ï¼š
   ```bash
   ./gradlew test                # è¿è¡Œå•å…ƒæµ‹è¯•
   ./gradlew integrationTest     # è¿è¡Œé›†æˆæµ‹è¯•
   ./gradlew check               # å®Œæ•´æ£€æŸ¥
   ```

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 1.4ï¼šè®­ç»ƒè¥çŠ¶æ€è‡ªåŠ¨æ›´æ–°å®šæ—¶ä»»åŠ¡
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆæ¯æ—¥ 00:05 æ‰§è¡Œï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… è‡ªåŠ¨å°† enrolling â†’ ongoingï¼ˆåˆ°è¾¾å¼€å§‹æ—¥æœŸï¼‰
  - âœ… è‡ªåŠ¨å°† ongoing â†’ endedï¼ˆåˆ°è¾¾ç»“æŸæ—¥æœŸï¼‰

---

#### ä»»åŠ¡ 1.5ï¼šå¾®ä¿¡å…¬ä¼—å· OAuth é›†æˆ
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š5 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šAuthController + FastAuthService + WechatOAuthManager + auth_session CRUD
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç”¨æˆ·ç‚¹å‡»æˆæƒé“¾æ¥èƒ½æ­£ç¡®è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µ
  - âœ… æˆæƒæˆåŠŸåèƒ½è·å–ç”¨æˆ· openid
  - âœ… ä¼šè¯ç®¡ç†å’Œèº«ä»½ç»‘å®šåŠŸèƒ½æ­£å¸¸
  - âœ… æ‰€æœ‰æ¥å£é€šè¿‡ Postman æµ‹è¯•

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 1.5ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°å¾®ä¿¡å…¬ä¼—å· OAuth 2.0 æˆæƒé›†æˆï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ã€Šæ¥å£æ–‡æ¡£.mdã€‹ç¬¬äºŒç« å’Œã€ŠFastAuthæ¥å…¥æ–¹æ¡ˆ.mdã€‹å®ç°ï¼š

ã€æ¥å£æ¸…å•ã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 2.1-2.3ï¼‰
1. GET /api/auth/authorize?planetUserId={planetUserId}&redirectUrl={url}
   - å‘èµ·å¾®ä¿¡ OAuth æˆæƒæµç¨‹
   - ç”Ÿæˆ state å‚æ•°å¹¶å­˜å…¥ Redisï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
   - é‡å®šå‘åˆ°å¾®ä¿¡æˆæƒé¡µ

2. GET /api/auth/callback/wechat-mp?code={code}&state={state}
   - å¤„ç†å¾®ä¿¡æˆæƒå›è°ƒ
   - ç”¨ code æ¢å– access_token å’Œ openid
   - åˆ›å»º auth_session è®°å½•
   - é‡å®šå‘å›å‰ç«¯é¡µé¢

3. POST /api/auth/bindPlanet
   - ç»‘å®šçŸ¥è¯†æ˜Ÿçƒèº«ä»½
   - éªŒè¯ sessionKey å’Œ planetUserId
   - æ›´æ–° auth_session.planet_user_id
   - åˆ›å»º/æ›´æ–° camp_member è®°å½•

ã€æ ¸å¿ƒç»„ä»¶ã€‘

1. WechatOAuthManager.javaï¼ˆcom.camp.managerï¼‰
   - æ–¹æ³•ï¼šgetAuthUrl(state, redirectUrl) â†’ ç”Ÿæˆå¾®ä¿¡æˆæƒé“¾æ¥
   - æ–¹æ³•ï¼šgetAccessToken(code) â†’ ç”¨ code æ¢å– openid
   - é…ç½®è¯»å–ï¼šä» system_config è¡¨è¯»å– wechat.mp.appid å’Œ wechat.mp.secret

2. AuthService.javaï¼ˆcom.camp.serviceï¼‰
   - æ–¹æ³•ï¼šinitiateAuth(planetUserId, redirectUrl) â†’ åˆ›å»ºæˆæƒä¼šè¯
   - æ–¹æ³•ï¼šhandleCallback(code, state) â†’ å¤„ç†å›è°ƒ
   - æ–¹æ³•ï¼šbindPlanet(sessionKey, planetUserId) â†’ ç»‘å®šæ˜Ÿçƒèº«ä»½

3. AuthController.javaï¼ˆcom.camp.controllerï¼‰
   - GET /api/auth/authorize
   - GET /api/auth/callback/wechat-mp
   - POST /api/auth/bindPlanet

ã€æ•°æ®åº“è¡¨ã€‘ï¼ˆå‚è€ƒæ•°æ®åº“è®¾è®¡ auth_sessionï¼‰
```sql
CREATE TABLE auth_session (
    id BIGSERIAL PRIMARY KEY,
    session_key VARCHAR(100) UNIQUE NOT NULL,  -- UUID v4
    wechat_openid VARCHAR(100),                -- å¾®ä¿¡ openid
    planet_user_id VARCHAR(50),                -- çŸ¥è¯†æ˜Ÿçƒç”¨æˆ·ID
    status VARCHAR(20) NOT NULL,               -- pending, completed, expired
    state VARCHAR(100),                        -- OAuth state å‚æ•°
    redirect_url TEXT,                         -- å‰ç«¯å›è°ƒåœ°å€
    expires_at TIMESTAMP NOT NULL,             -- ä¼šè¯è¿‡æœŸæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_auth_session_openid ON auth_session(wechat_openid);
CREATE INDEX idx_auth_session_planet_user ON auth_session(planet_user_id);
CREATE INDEX idx_auth_session_state ON auth_session(state);
```

ã€OAuth æˆæƒæµç¨‹ã€‘ï¼ˆå‚è€ƒ FastAuthæ¥å…¥æ–¹æ¡ˆ.mdï¼‰

1. ç”¨æˆ·ç‚¹å‡»æˆæƒé“¾æ¥ â†’ GET /api/auth/authorize?planetUserId=xxx&redirectUrl=xxx
2. åç«¯ç”Ÿæˆ state å‚æ•°ï¼šUUID.randomUUID().toString()
3. å°† state å­˜å…¥ Redisï¼škey=oauth:state:{state}, value={planetUserId, redirectUrl}, ttl=5åˆ†é’Ÿ
4. åˆ›å»º auth_session è®°å½•ï¼šsession_key=UUID, status=pending, state=xxx
5. æ„é€ å¾®ä¿¡æˆæƒé“¾æ¥å¹¶é‡å®šå‘ï¼š
   ```
   https://open.weixin.qq.com/connect/oauth2/authorize?
   appid={WECHAT_MP_APPID}&
   redirect_uri={WECHAT_MP_OAUTH_CALLBACK_URL}&
   response_type=code&
   scope=snsapi_userinfo&
   state={state}#wechat_redirect
   ```

6. ç”¨æˆ·åœ¨å¾®ä¿¡æˆæƒé¡µåŒæ„æˆæƒ
7. å¾®ä¿¡é‡å®šå‘å› GET /api/auth/callback/wechat-mp?code=xxx&state=xxx
8. åç«¯éªŒè¯ stateï¼ˆä» Redis è¯»å–ï¼‰
9. ç”¨ code æ¢å– access_token å’Œ openidï¼ˆè°ƒç”¨å¾®ä¿¡ APIï¼‰
10. æ›´æ–° auth_sessionï¼šwechat_openid=xxx, status=completed
11. é‡å®šå‘åˆ°å‰ç«¯ redirectUrlï¼Œæºå¸¦ sessionKey

ã€é…ç½®è¯»å–ã€‘
ä» system_config è¡¨è¯»å–ï¼š
- wechat.mp.appid
- wechat.mp.secret
- wechat.mp.oauth_callback_url

ã€éªŒæ”¶æ ‡å‡†ã€‘
1. æˆæƒé“¾æ¥èƒ½æ­£ç¡®è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µ
2. æˆæƒæˆåŠŸåèƒ½è·å– openid å¹¶åˆ›å»º auth_session
3. ç»‘å®šæ¥å£èƒ½æ­£ç¡®å…³è”çŸ¥è¯†æ˜Ÿçƒç”¨æˆ·
4. ä¼šè¯è¿‡æœŸåæ— æ³•ä½¿ç”¨
5. æ‰€æœ‰å¼‚å¸¸æƒ…å†µæœ‰æ˜ç¡®é”™è¯¯æç¤º

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

## Stage 2ï¼šæ”¯ä»˜é›†æˆï¼ˆæ··åˆæ–¹æ¡ˆï¼‰ï¼ˆ5å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
å®Œæˆå¾®ä¿¡æ”¯ä»˜é›†æˆï¼Œå®ç°OAuthç»‘å®š + æ”¯ä»˜åç»‘å®šæ··åˆæ–¹æ¡ˆï¼ˆå¯¹åº”æŠ€æœ¯æ–¹æ¡ˆ Stage 2ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 2.1ï¼šå¾®ä¿¡æ”¯ä»˜ SDK å°è£…
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šWechatPayManager ç±»
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… èƒ½æˆåŠŸåˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆå« attach å‚æ•°ï¼‰
  - âœ… ç­¾åæ­£ç¡®

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 2.1ï¼‰

```markdown
æˆ‘éœ€è¦å°è£…å¾®ä¿¡æ”¯ä»˜ APIï¼Œè¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

ã€WechatPayManager.javaã€‘ï¼ˆcom.camp.managerï¼‰

1. createOrder(orderNo, amount, description, attach) â†’ è¿”å›æ”¯ä»˜å‚æ•°
   - attach å‚æ•°æ ¼å¼ï¼š{"campId":1,"planetUserId":"123456789","orderNo":"ord_xxx"}
   - ç”¨äºOAuthç»‘å®šæ”¯ä»˜æ—¶ä¼ é€’ç”¨æˆ·ä¿¡æ¯

2. queryOrder(orderNo) â†’ æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€

3. refund(orderNo, refundAmount) â†’ å‘èµ·é€€æ¬¾

ã€attach å­—æ®µè¯´æ˜ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.3.1ï¼‰
- OAuthç»‘å®šæ”¯ä»˜ï¼šattach åŒ…å« planet_user_id
- å›ºå®šäºŒç»´ç æ”¯ä»˜ï¼šattach ä¸ºç©º

ã€é…ç½®è¯»å–ã€‘
ä» system_config è¡¨è¯»å–ï¼šwechat.pay.mch_id, wechat.pay.api_key ç­‰

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç ã€‚
```

---

#### ä»»åŠ¡ 2.2ï¼šåˆ›å»ºæ”¯ä»˜è®¢å•æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPOST /api/h5/payments æ¥å£
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç”Ÿæˆ UUID æ ¼å¼è®¢å•å·ï¼ˆord_xxxï¼‰
  - âœ… æ”¯æŒä¼ å…¥ planetUserIdï¼ˆOAuthç»‘å®šåœºæ™¯ï¼‰

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 2.2ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°åˆ›å»ºæ”¯ä»˜è®¢å•æ¥å£ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ã€Šæ¥å£æ–‡æ¡£.mdã€‹3.3 å®ç°ï¼š

ã€æ¥å£ã€‘POST /api/h5/payments

ã€è¯·æ±‚ä½“ã€‘
{
  "campId": 1,
  "planetUserId": "123456789",     // OAuthç»‘å®šåœºæ™¯å¿…ä¼ 
  "planetNickname": "å°æ˜åŒå­¦",     // OAuthç»‘å®šåœºæ™¯å¿…ä¼ 
  "wechatNickname": "å°æ˜"          // å¯é€‰
}

ã€ä¸šåŠ¡é€»è¾‘ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.2ï¼‰
1. ç”Ÿæˆå”¯ä¸€è®¢å•å·ï¼šord_ + UUIDï¼ˆé˜²æ­¢æšä¸¾æ”»å‡»ï¼‰
2. åˆ¤æ–­æ”¯ä»˜å…¥å£ï¼š
   - æœ‰ planetUserId â†’ OAuthç»‘å®šæµç¨‹ï¼Œattach æºå¸¦ç”¨æˆ·ä¿¡æ¯
   - æ—  planetUserId â†’ å›ºå®šäºŒç»´ç æµç¨‹ï¼Œattach ä¸ºç©º

3. åˆ›å»º payment_recordï¼š
   - bind_status = pendingï¼ˆæ—  attachï¼‰æˆ– completedï¼ˆæœ‰ attachï¼‰
   - bind_method = dynamic_qrcodeï¼ˆæœ‰ attachï¼‰æˆ– null
   - bind_deadline = now + 7 daysï¼ˆæ—  attach æ—¶è®¾ç½®ï¼‰

4. è°ƒç”¨ WechatPayManager.createOrder()

ã€å“åº”ã€‘
{
  "orderId": 10001,
  "orderNo": "ord_a1b2c3d4-5678-90ab-cdef",
  "amount": 99.00,
  "status": "pending",
  "expireTime": "2025-12-01T12:30:00",
  "payUrl": "/api/h5/payments/{orderNo}/params"
}

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 2.3ï¼šæ”¯ä»˜å›è°ƒå¤„ç†ï¼ˆWebhookï¼‰
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPOST /api/webhook/wechat/payment
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… éªŒè¯ç­¾å
  - âœ… å¹‚ç­‰å¤„ç†
  - âœ… åŒºåˆ†æœ‰/æ—  attach ä¸¤ç§åœºæ™¯

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 2.3ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°æ”¯ä»˜å›è°ƒå¤„ç†ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æŠ€æœ¯æ–¹æ¡ˆæ—¶åºå›¾ 5.3.2 å’Œ 5.3.3 å®ç°ï¼š

ã€æ¥å£ã€‘POST /api/webhook/wechat/payment

ã€ä¸šåŠ¡é€»è¾‘ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.3.2 æ”¯ä»˜å›è°ƒå¤„ç†ï¼‰

1. éªŒè¯ç­¾åï¼ˆé˜²æ­¢ä¼ªé€ ï¼‰

2. å¹‚ç­‰æ€§å¤„ç†ï¼ˆRedis åˆ†å¸ƒå¼é”ï¼‰ï¼š
   ```java
   String lockKey = "payment:callback:" + out_trade_no;
   if (!redisTemplate.opsForValue().setIfAbsent(lockKey, "1", 5, TimeUnit.MINUTES)) {
       log.warn("é‡å¤å›è°ƒ: {}", out_trade_no);
       return SUCCESS;
   }
```

3. è§£æ attach å­—æ®µï¼š
   - æœ‰ attachï¼ˆOAuthç»‘å®šï¼‰ï¼š
     - æå– camp_id, planet_user_id, order_no
     - æ›´æ–° payment_recordï¼šbind_status=completed, bind_method=dynamic_qrcode
     - åˆ›å»º/æ›´æ–° camp_member è®°å½•
     - ç”Ÿæˆ accessToken å¹¶å­˜å…¥ Redis

   - æ—  attachï¼ˆå›ºå®šäºŒç»´ç ï¼‰ï¼š
     - æ›´æ–° payment_recordï¼šbind_status=pending, bind_deadline=7å¤©å
     - ç”Ÿæˆ accessToken å¹¶å­˜å…¥ Redis

4. è®°å½•çŠ¶æ€æ—¥å¿—åˆ° payment_bind_status_log å’Œ order_status_log

ã€accessToken ç”Ÿæˆã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.3ï¼‰
```java
String accessToken = "tk_" + UUID.randomUUID().toString();
// å­˜å…¥ Redisï¼Œæœ‰æ•ˆæœŸ = è®­ç»ƒè¥ç»“æŸæ—¥æœŸ + 7å¤©
redisTemplate.opsForValue().set(
    "access_token:" + accessToken,
    JSON.toJSONString(new AccessTokenInfo(orderNo, "active", campEndDate)),
    Duration.between(LocalDateTime.now(), campEndDate.plusDays(7))
);
```

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 2.4ï¼šæŸ¥è¯¢æ”¯ä»˜çŠ¶æ€æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šGET /api/h5/payments/{orderNo}/status
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ”¯ä»˜æˆåŠŸæ—¶è¿”å› accessToken
  - âœ… è¿”å› bindStatus å’Œ bindMethod

---

#### ä»»åŠ¡ 2.5ï¼šç”¨æˆ·ç»‘å®šæ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPOST /api/h5/payments/bind
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… éœ€è¦ X-Access-Token éªŒè¯
  - âœ… éªŒè¯ç¥¨æ®å¯¹åº”çš„ orderNo
  - âœ… ç»‘å®šæˆåŠŸåè¿”å›ç¾¤äºŒç»´ç 

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 2.5ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°ç”¨æˆ·ç»‘å®šæ¥å£ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ã€Šæ¥å£æ–‡æ¡£.mdã€‹3.6 å®ç°ï¼š

ã€æ¥å£ã€‘POST /api/h5/payments/bind
ã€Headerã€‘X-Access-Token: {accessToken}

ã€å®‰å…¨æ ¡éªŒã€‘ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.3 å®‰å…¨æªæ–½ï¼‰
1. éªŒè¯ accessToken æœ‰æ•ˆä¸”æœªè¿‡æœŸï¼ˆçŠ¶æ€ä¸º active æˆ– boundï¼‰
2. éªŒè¯ accessToken ç»‘å®šçš„ orderNo ä¸è¯·æ±‚ä¸€è‡´
3. éªŒè¯è®¢å• bind_status = pending
4. éªŒè¯æœªè¶…è¿‡ bind_deadline

ã€ä¸šåŠ¡é€»è¾‘ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.3.3ï¼‰
1. æŸ¥è¯¢ payment_record
2. æ›´æ–°ï¼š
   - bind_status = completed
   - bind_method = user_fill
   - planet_user_id_from_attach = ç”¨æˆ·å¡«å†™çš„å€¼
3. åˆ›å»º/å…³è” camp_member è®°å½•
4. æ›´æ–° accessToken çŠ¶æ€ä¸º bound
5. è®°å½•çŠ¶æ€æ—¥å¿—

ã€å¹‚ç­‰è®¾è®¡ã€‘
è‹¥è®¢å•å·²ç»‘å®šï¼Œè¿”å›å·²ç»‘å®šä¿¡æ¯ï¼ˆä¸æŠ¥é”™ï¼‰

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 2.6ï¼šè·å–ç¾¤äºŒç»´ç æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šGET /api/h5/payments/{orderNo}/qrcode
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… éœ€è¦ X-Access-Token éªŒè¯
  - âœ… bind_status = completed æ‰è¿”å›

---

#### ä»»åŠ¡ 2.7ï¼šç»‘å®šè¶…æ—¶å®šæ—¶ä»»åŠ¡
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šBindExpireTaskï¼ˆæ¯æ—¥ 02:00 æ‰§è¡Œï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ£€æŸ¥ bind_status=pending ä¸”è¶…æ—¶çš„è®°å½•
  - âœ… æ›´æ–°ä¸º expiredï¼ŒåŠ å…¥æ™ºèƒ½åŒ¹é…é˜Ÿåˆ—

---

## Stage 3ï¼šæ‰“å¡åŒæ­¥ï¼ˆ4å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
å®ç°çŸ¥è¯†æ˜Ÿçƒæ‰“å¡æ•°æ®åŒæ­¥ï¼ˆå¯¹åº”æŠ€æœ¯æ–¹æ¡ˆ Stage 3ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 3.1ï¼šçŸ¥è¯†æ˜Ÿçƒ API å°è£…
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPlanetApiManager ç±»
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… èƒ½æˆåŠŸè·å–æ‰“å¡æ•°æ®
  - âœ… æ”¯æŒè‡ªåŠ¨ç¿»é¡µ
  - âœ… Cookie è¿‡æœŸèƒ½æ­£å¸¸å‘Šè­¦

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 3.1ï¼‰

```markdown
æˆ‘éœ€è¦å°è£…çŸ¥è¯†æ˜Ÿçƒ APIï¼Œè¯·å¸®æˆ‘å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

ã€PlanetApiManager.javaã€‘ï¼ˆcom.camp.managerï¼‰

1. getCheckinRanking(groupId, checkinId) â†’ è¿”å›æ‰“å¡æ’è¡Œæ¦œ
   - éœ€è‡ªåŠ¨ç¿»é¡µï¼ˆæ¯é¡µ 100 æ¡ï¼Œæœ€å¤š 200 äººï¼‰
   - è¿”å›å­—æ®µï¼šuser_id, name, checkin_count

2. validateCookie() â†’ éªŒè¯ Cookie æ˜¯å¦æœ‰æ•ˆ

ã€è®¤è¯æ–¹å¼ã€‘
- Header: Cookie: {zsxq_access_token}
- ä» system_config è¡¨è¯»å–é…ç½®

ã€é”™è¯¯å¤„ç†ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.8ï¼‰
- Cookie è¿‡æœŸï¼ˆ401/403ï¼‰â†’ å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ç»™ç®¡ç†å‘˜
- ç½‘ç»œå¼‚å¸¸ â†’ é‡è¯• 1 æ¬¡

ã€æ•°æ®è§£æã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.6ï¼‰
API è¿”å›æ‰“å¡å¤©æ•°ï¼Œéœ€åº”ç”¨å®½é™è§„åˆ™ï¼š
å®é™…æ‰“å¡å¤©æ•° = APIè¿”å›å¤©æ•° + GRACE_DAYSï¼ˆé»˜è®¤1å¤©ï¼‰

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç ã€‚
```

---

#### ä»»åŠ¡ 3.2ï¼šæ‰“å¡æ•°æ®åŒæ­¥å®šæ—¶ä»»åŠ¡
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šCheckinSyncTaskï¼ˆæ¯æ—¥ 01:00 æ‰§è¡Œï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… åŒæ­¥æ‰€æœ‰è¿›è¡Œä¸­è®­ç»ƒè¥çš„æ‰“å¡æ•°æ®
  - âœ… æ›´æ–° camp_member.checkin_count
  - âœ… è®¡ç®— eligible_for_refund

---

#### ä»»åŠ¡ 3.3ï¼šæ‰‹åŠ¨åŒæ­¥æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPOST /api/admin/checkins/sync/{campId}
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”é˜²æ­¢å¹¶å‘
  - âœ… è¿”å›åŒæ­¥ç»“æœï¼ˆæ›´æ–°äººæ•°ã€æ–°å¢æ‰“å¡æ•°ï¼‰

---

#### ä»»åŠ¡ 3.4ï¼šæ‰“å¡ç»Ÿè®¡æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šGET /api/admin/checkins/stats/{campId}
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… è¿”å›æ¯æ—¥æ‰“å¡äººæ•°è¶‹åŠ¿
  - âœ… è¿”å›æ‰“å¡å¤©æ•°åˆ†å¸ƒ

---

## Stage 4ï¼šæ··åˆåŒ¹é…ç®—æ³•ï¼ˆ3å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
å®ç° bind_status ä¼˜å…ˆåŒ¹é… + æ™ºèƒ½åŒ¹é…ï¼ˆå¯¹åº”æŠ€æœ¯æ–¹æ¡ˆ Stage 4ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 4.1ï¼šæ··åˆåŒ¹é…æœåŠ¡å®ç°
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šMatchService ç±»
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… bind_status=completed ç›´æ¥ä½¿ç”¨ï¼Œç½®ä¿¡åº¦ 100%
  - âœ… bind_status=expired å¯åŠ¨æ™ºèƒ½åŒ¹é…
  - âœ… æ™ºèƒ½åŒ¹é…ä½¿ç”¨ Levenshtein ç®—æ³•

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 4.1ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°æ··åˆåŒ¹é…ç®—æ³•ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æŠ€æœ¯æ–¹æ¡ˆ 5.2.4 å’Œ 5.3.8 å®ç°ï¼š

ã€MatchService.javaã€‘ï¼ˆcom.camp.serviceï¼‰

1. matchMembersForRefund(campId) â†’ ä¸ºé€€æ¬¾åŒ¹é…æ‰€æœ‰åˆæ ¼ç”¨æˆ·

   ã€åŒ¹é…ä¼˜å…ˆçº§ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.4ï¼‰
   ```java
   for (CampMember member : qualifiedMembers) {
       PaymentRecord payment = getPaymentByMember(member);

       switch (payment.getBindStatus()) {
           case COMPLETED:
               // ç›´æ¥ä½¿ç”¨å·²ç»‘å®šæ˜ å°„ï¼Œç½®ä¿¡åº¦ 100%
               result.add(new MatchResult(member, payment.getPlanetUserId(), 100, payment.getBindMethod()));
               break;

           case PENDING:
               if (isExpired(payment.getBindDeadline())) {
                   // è¶…æ—¶ï¼Œå¯åŠ¨æ™ºèƒ½åŒ¹é…
                   updateBindStatus(payment, EXPIRED);
                   MatchResult match = smartMatch(member, payment);
                   result.add(match);
               } else {
                   // æœªè¶…æ—¶ï¼Œè·³è¿‡ç­‰å¾…ç”¨æˆ·ç»‘å®š
                   skipped.add(member);
               }
               break;

           case EXPIRED:
           case null:
               // æ™ºèƒ½åŒ¹é…
               MatchResult match = smartMatch(member, payment);
               result.add(match);
               break;
       }
   }
```

2. smartMatch(member, payment) â†’ æ™ºèƒ½åŒ¹é…ç®—æ³•

   ã€åŒ¹é…ç®—æ³•ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.7ï¼‰
   - æ˜ŸçƒIDç²¾ç¡®åŒ¹é… â†’ å¾—åˆ† 50%
   - æ˜µç§°ç›¸ä¼¼åº¦ï¼ˆLevenshteinï¼‰â†’ å¾—åˆ† 50%
   - æ€»åˆ† â‰¥ 80% â†’ åŒ¹é…æˆåŠŸï¼Œbind_method=smart_match
   - æ€»åˆ† 50-79% â†’ å¾…å®¡æ ¸
   - æ€»åˆ† < 50% â†’ éœ€äººå·¥å¤„ç†ï¼Œbind_method=manual

3. manualMatch(memberId, planetUserId) â†’ æ‰‹åŠ¨åŒ¹é…
   - æ›´æ–° bind_status=completed, bind_method=manual
   - ç½®ä¿¡åº¦ 100%

ã€çŠ¶æ€æ—¥å¿—ã€‘
æ¯æ¬¡åŒ¹é…æ“ä½œéœ€è®°å½•åˆ° payment_bind_status_log

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 4.2ï¼šåŒ¹é…ç®¡ç†æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šåŒ¹é…ç›¸å…³æ¥å£
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… GET /api/admin/members?matchStatus=pending
  - âœ… POST /api/admin/members/{id}/matchï¼ˆæ‰‹åŠ¨åŒ¹é…ï¼‰

---

## Stage 5ï¼šé€€æ¬¾æµç¨‹ï¼ˆ4å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
å®Œæˆé€€æ¬¾åˆ—è¡¨ç”Ÿæˆã€å®¡æ ¸ã€æ‰§è¡Œã€é€šçŸ¥ï¼ˆå¯¹åº”æŠ€æœ¯æ–¹æ¡ˆ Stage 5ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 5.1ï¼šé€€æ¬¾åå•ç”Ÿæˆ
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šRefundService.generateRefundList()
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç­›é€‰ eligible_for_refund = true çš„ä¼šå‘˜
  - âœ… è°ƒç”¨ MatchService è¿›è¡ŒåŒ¹é…
  - âœ… åˆ›å»º refund_recordï¼ˆçŠ¶æ€=pendingï¼‰

---

#### ä»»åŠ¡ 5.2ï¼šé€€æ¬¾å®¡æ ¸æ¥å£
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šå®¡æ ¸é€šè¿‡/æ‹’ç»/æ‰¹é‡å®¡æ ¸æ¥å£
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ‰¹é‡å®¡æ ¸æ”¯æŒæœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼
  - âœ… è®°å½•å®¡æ ¸äººå’Œå®¡æ ¸æ—¶é—´

---

#### ä»»åŠ¡ 5.3ï¼šé€€æ¬¾æ‰§è¡Œï¼ˆè°ƒç”¨å¾®ä¿¡ APIï¼‰
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šé€€æ¬¾æ‰§è¡ŒæœåŠ¡
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… è°ƒç”¨ WechatPayManager.refund()
  - âœ… å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
  - âœ… è¶…è¿‡é‡è¯•æ¬¡æ•°æ ‡è®°ä¸ºäººå·¥å¤„ç†

#### ğŸ¤– AI æç¤ºè¯ï¼ˆä»»åŠ¡ 5.3ï¼‰

```markdown
æˆ‘éœ€è¦å®ç°é€€æ¬¾æ‰§è¡ŒåŠŸèƒ½ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§æŠ€æœ¯æ–¹æ¡ˆ 5.3.5 å’Œ 5.3.10 å®ç°ï¼š

ã€RefundService.javaã€‘

1. executeRefund(refundId) â†’ æ‰§è¡Œå•ä¸ªé€€æ¬¾

   ã€ä¸šåŠ¡é€»è¾‘ã€‘ï¼ˆå‚è€ƒæŠ€æœ¯æ–¹æ¡ˆ 5.2.8 é€€æ¬¾å¼‚å¸¸å¤„ç†ï¼‰
   ```java
   public void executeRefund(Long refundId) {
       RefundRecord record = refundMapper.selectById(refundId);

       try {
           // è°ƒç”¨å¾®ä¿¡é€€æ¬¾ API
           wechatPayManager.refund(record.getOrderNo(), record.getRefundAmount());

           // æ›´æ–°çŠ¶æ€
           record.setRefundStatus("success");
           record.setExecuteTime(LocalDateTime.now());
           refundMapper.updateById(record);

           // å‘é€é€šçŸ¥
           sendRefundNotification(record, true);

       } catch (Exception e) {
           handleRefundFailure(record, e);
       }
   }

   private void handleRefundFailure(RefundRecord record, Exception e) {
       record.setRetryCount(record.getRetryCount() + 1);
       record.setLastRetryTime(LocalDateTime.now());
       record.setFailureReason(e.getMessage());

       if (record.getRetryCount() < 3) {
           // å»¶è¿Ÿé‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
           scheduleRetry(record, record.getRetryCount() * 5 * 60);
       } else {
           // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œæ ‡è®°ä¸ºäººå·¥å¤„ç†
           record.setRefundStatus("manual_required");
           sendAlertToAdmin(record);
       }

       refundMapper.updateById(record);
   }
```

2. retryFailedRefunds() â†’ å®šæ—¶é‡è¯•å¤±è´¥çš„é€€æ¬¾ï¼ˆæ¯å°æ—¶æ‰§è¡Œï¼‰

ã€çŠ¶æ€æ—¥å¿—ã€‘
æ¯æ¬¡çŠ¶æ€å˜æ›´è®°å½•åˆ° refund_status_log

è¯·ç”Ÿæˆå®Œæ•´çš„ä»£ç å’Œå•å…ƒæµ‹è¯•ã€‚
```

---

#### ä»»åŠ¡ 5.4ï¼šé€šçŸ¥æœåŠ¡å®ç°
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šNotificationService
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… é€€æ¬¾æˆåŠŸé€šçŸ¥ä¼šå‘˜
  - âœ… é€€æ¬¾å¤±è´¥å‘Šè­¦ç®¡ç†å‘˜
  - âœ… æ¶ˆæ¯è®°å½•åˆ° notification_message è¡¨

---

#### ä»»åŠ¡ 5.5ï¼šé€€æ¬¾ç»“æœ Webhook
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPOST /api/webhook/wechat/refund
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ›´æ–°é€€æ¬¾çŠ¶æ€
  - âœ… è§¦å‘é€šçŸ¥

---

## Stage 6ï¼šå‰ç«¯å¼€å‘ + ç³»ç»Ÿç®¡ç†ï¼ˆ4å¤©ï¼‰

### ğŸ¯ ç›®æ ‡
å®Œæˆ H5 ä¼šå‘˜ç«¯ã€Web ç®¡ç†åå°ã€ç»Ÿè®¡æŠ¥è¡¨ï¼ˆå¯¹åº”æŠ€æœ¯æ–¹æ¡ˆ Stage 6ï¼‰

### ğŸ“¦ ä»»åŠ¡æ‹†åˆ†

#### ä»»åŠ¡ 6.1ï¼šH5 è®­ç»ƒè¥åˆ—è¡¨å’Œè¯¦æƒ…é¡µ
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šCampList.vue, CampDetail.vue
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… è¯¦æƒ…é¡µæ”¯æŒé¢„å¡«æ˜Ÿçƒä¿¡æ¯
  - âœ… ç‚¹å‡»æ”¯ä»˜è·³è½¬æ”¯ä»˜æµç¨‹

---

#### ä»»åŠ¡ 6.2ï¼šH5 æ”¯ä»˜åç»‘å®šé¡µé¢
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šPaymentBind.vue
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ˜¾ç¤ºè®¢å•ä¿¡æ¯
  - âœ… è¡¨å•æ ¡éªŒæ˜ŸçƒIDå’Œæ˜µç§°
  - âœ… ç»‘å®šæˆåŠŸæ˜¾ç¤ºç¾¤äºŒç»´ç 

---

#### ä»»åŠ¡ 6.3ï¼šH5 æ‰“å¡è¿›åº¦é¡µé¢
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š2 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šProgressQuery.vue
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… æ˜¾ç¤ºæ‰“å¡æ—¥å†
  - âœ… æ˜¾ç¤ºæ˜¯å¦è¾¾æ ‡

---

#### ä»»åŠ¡ 6.4ï¼šç®¡ç†åå°è®­ç»ƒè¥ç®¡ç†
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šCampManage.vue
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… è¡¨æ ¼ + æ–°å¢/ç¼–è¾‘å¯¹è¯æ¡†
  - âœ… çŠ¶æ€ç­›é€‰å’Œåˆ†é¡µ

---

#### ä»»åŠ¡ 6.5ï¼šç®¡ç†åå°é€€æ¬¾å®¡æ ¸
- **ä¼˜å…ˆçº§**ï¼šP0
- **é¢„è®¡æ—¶é—´**ï¼š4 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šRefundManage.vue
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… å¾…å®¡æ ¸åˆ—è¡¨
  - âœ… æ‰¹é‡å®¡æ ¸åŠŸèƒ½
  - âœ… æ˜¾ç¤ºåŒ¹é…ç½®ä¿¡åº¦

---

#### ä»»åŠ¡ 6.6ï¼šç®¡ç†åå°ç»Ÿè®¡æŠ¥è¡¨
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šDashboard.vueï¼ˆECharts å›¾è¡¨ï¼‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç³»ç»Ÿæ¦‚è§ˆç»Ÿè®¡
  - âœ… è®­ç»ƒè¥æ‰“å¡è¶‹åŠ¿å›¾

---

#### ä»»åŠ¡ 6.7ï¼šç³»ç»Ÿç®¡ç†å’Œå®‰å…¨
- **ä¼˜å…ˆçº§**ï¼šP1
- **é¢„è®¡æ—¶é—´**ï¼š3 å°æ—¶
- **äº¤ä»˜ç‰©**ï¼šç”¨æˆ·ç®¡ç†ã€é…ç½®ç®¡ç†ã€æ“ä½œæ—¥å¿—
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - âœ… ç”¨æˆ· CRUD
  - âœ… é…ç½®é¡¹å¯æ›´æ–°
  - âœ… æ“ä½œæ—¥å¿—å¯æŸ¥è¯¢

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### 1. å¦‚ä½•ä½¿ç”¨è¿™äº›æç¤ºè¯ï¼Ÿ

#### æ–¹å¼ä¸€ï¼šç›´æ¥å¤åˆ¶åˆ° Claude Code / Cursor
```
1. æ‰“å¼€ Claude Code æˆ– Cursor
2. å¤åˆ¶å¯¹åº”ä»»åŠ¡çš„ AI æç¤ºè¯
3. ç²˜è´´åˆ°å¯¹è¯æ¡†
4. AI ä¼šç”Ÿæˆå®Œæ•´çš„ä»£ç 
5. å¤åˆ¶ä»£ç åˆ°é¡¹ç›®ä¸­
6. è¿è¡Œæµ‹è¯•ï¼ŒéªŒè¯åŠŸèƒ½
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨ Claude Code çš„ Slash Commands
```
1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .claude/commands/
2. ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ª .md æ–‡ä»¶ï¼ˆå¦‚ task-0.1.mdï¼‰
3. å¤åˆ¶æç¤ºè¯åˆ°æ–‡ä»¶ä¸­
4. ä½¿ç”¨ /task-0.1 è§¦å‘ä»»åŠ¡
```

---

### 2. å¼€å‘æµç¨‹å»ºè®®

æ¯ä¸ª Stage çš„å¼€å‘æµç¨‹ï¼š

```
1. Stage è®¡åˆ’ä¼šè®®
   - æ˜ç¡®æœ¬ Stage çš„ç›®æ ‡
   - ç¡®è®¤ä»»åŠ¡ä¼˜å…ˆçº§
   - å‡†å¤‡å¥½æ‰€æœ‰ AI æç¤ºè¯

2. å¼€å‘è¿­ä»£
   - æŒ‰ç…§ä»»åŠ¡é¡ºåºé€ä¸ªå¼€å‘
   - æ¯ä¸ªä»»åŠ¡å®Œæˆåç«‹å³æµ‹è¯•
   - é€šè¿‡éªŒæ”¶æ ‡å‡†åå†è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡

3. Stage å›é¡¾
   - æ£€æŸ¥æ‰€æœ‰ä»»åŠ¡æ˜¯å¦å®Œæˆ
   - è¿è¡Œé›†æˆæµ‹è¯•
   - è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

4. Stage æ¼”ç¤º
   - æ¼”ç¤ºæœ¬ Stage çš„åŠŸèƒ½
   - æ”¶é›†åé¦ˆ
   - è§„åˆ’ä¸‹ä¸€ä¸ª Stage
```

---

### 3. æ¥å£å¥‘çº¦å’Œæµ‹è¯•è¦æ±‚ï¼ˆé€šç”¨è§„èŒƒï¼‰

**æ‰€æœ‰ AI æç¤ºè¯ä¸­çš„æ¥å£å®ç°éƒ½å¿…é¡»éµå¾ªä»¥ä¸‹è§„èŒƒ**ï¼š

#### æ¥å£å¥‘çº¦è¦æ±‚

1. **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.2ï¼‰ï¼š
   ```json
   {
     "code": 200,
     "message": "æˆåŠŸ",
     "data": {...},
     "timestamp": 1234567890
   }
   ```

2. **é”™è¯¯ç è§„èŒƒ**ï¼ˆå‚è€ƒæ¥å£æ–‡æ¡£ 1.4ï¼‰ï¼š
   - **å‚æ•°æ ¡éªŒå¤±è´¥**ï¼š`400` + å…·ä½“å­—æ®µé”™è¯¯ä¿¡æ¯
   - **ä¸šåŠ¡é€»è¾‘é”™è¯¯**ï¼šè‡ªå®šä¹‰é”™è¯¯ç  `1001-1499`
   - **ç³»ç»Ÿå†…éƒ¨é”™è¯¯**ï¼š`500`

3. **åˆ†é¡µå“åº”æ ¼å¼**ï¼š
   ```json
   {
     "code": 200,
     "data": {
       "items": [...],
       "total": 100,
       "page": 1,
       "pageSize": 20
     }
   }
   ```

4. **å‚æ•°æ ¡éªŒ**ï¼š
   - ä½¿ç”¨ Spring Validation æ³¨è§£ï¼ˆ`@NotNull`, `@NotBlank`, `@Valid` ç­‰ï¼‰
   - åœ¨ Controller å±‚æ·»åŠ  `@Validated` æ³¨è§£
   - æ ¡éªŒå¤±è´¥è‡ªåŠ¨è¿”å› 400 é”™è¯¯

#### æµ‹è¯•è¦æ±‚

**åç«¯æµ‹è¯•**ï¼ˆJava + Spring Bootï¼‰ï¼š

1. **å•å…ƒæµ‹è¯•**ï¼ˆJUnit 5 + Mockitoï¼‰ï¼š
   - Service å±‚æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
   - æµ‹è¯•è¦†ç›–ç‡è¦æ±‚ï¼š**åˆ†æ”¯è¦†ç›– â‰¥ 80%**
   - æµ‹è¯•ç”¨ä¾‹å¿…é¡»åŒ…å«ï¼š
     - âœ… æ­£å¸¸æµç¨‹ï¼ˆHappy Pathï¼‰
     - âœ… è¾¹ç•Œæ¡ä»¶ï¼ˆç©ºå€¼ã€æå€¼ã€ä¸´ç•Œå€¼ï¼‰
     - âœ… å¼‚å¸¸æƒ…å†µï¼ˆå‚æ•°é”™è¯¯ã€ä¸šåŠ¡å¼‚å¸¸ï¼‰

2. **é›†æˆæµ‹è¯•**ï¼ˆSpring Boot Testï¼‰ï¼š
   - Controller å±‚æ¥å£å¿…é¡»æœ‰é›†æˆæµ‹è¯•
   - éªŒè¯å†…å®¹ï¼š
     - âœ… è¯·æ±‚å‚æ•°æ ¡éªŒ
     - âœ… å“åº”æ ¼å¼ç¬¦åˆå¥‘çº¦
     - âœ… æ•°æ®åº“æ“ä½œæ­£ç¡®æ€§
     - âœ… äº‹åŠ¡ä¸€è‡´æ€§

3. **æµ‹è¯•å‘½ä»¤**ï¼š
   ```bash
   cd backend
   ./gradlew test                # è¿è¡Œå•å…ƒæµ‹è¯•
   ./gradlew integrationTest     # è¿è¡Œé›†æˆæµ‹è¯•
   ./gradlew check               # å®Œæ•´æ£€æŸ¥ï¼ˆç¼–è¯‘+æµ‹è¯•+é£æ ¼ï¼‰
   ```

**å‰ç«¯æµ‹è¯•**ï¼ˆVue 3 + Viteï¼‰ï¼š

1. **å•å…ƒæµ‹è¯•**ï¼ˆVitest + Testing Libraryï¼‰ï¼š
   - å·¥å…·å‡½æ•°å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
   - å¤æ‚ç»„ä»¶é€»è¾‘å»ºè®®ç¼–å†™æµ‹è¯•

2. **æµ‹è¯•å‘½ä»¤**ï¼š
   ```bash
   cd frontend/h5-member (æˆ– admin-web)
   npm run test:unit             # è¿è¡Œå•å…ƒæµ‹è¯•
   npm run lint                  # ä»£ç æ£€æŸ¥
   npm run type-check            # ç±»å‹æ£€æŸ¥
   ```

#### åœ¨ AI æç¤ºè¯ä¸­çš„åº”ç”¨

**ç¤ºä¾‹**ï¼ˆå·²åœ¨ä»»åŠ¡ 1.3 ä¸­æ·»åŠ ï¼‰ï¼š
- æ¯ä¸ªåŒ…å«æ¥å£å®ç°çš„ AI æç¤ºè¯æœ«å°¾éƒ½åº”æ·»åŠ "ã€æ¥å£å¥‘çº¦è¦æ±‚ã€‘"å’Œ"ã€æµ‹è¯•è¦æ±‚ã€‘"éƒ¨åˆ†
- ç¡®ä¿ AI ç”Ÿæˆçš„ä»£ç éµå¾ªç»Ÿä¸€è§„èŒƒ
- æé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§

---

### 4. è´¨é‡ä¿éšœ

#### ä»£ç å®¡æŸ¥æ¸…å•

æ¯ä¸ªä»»åŠ¡å®Œæˆåï¼Œæ£€æŸ¥ï¼š
- [ ] ä»£ç æ˜¯å¦ç¬¦åˆé¡¹ç›®è§„èŒƒï¼Ÿ
- [ ] æ˜¯å¦æœ‰å•å…ƒæµ‹è¯•ï¼Ÿ
- [ ] æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡ï¼Ÿ
- [ ] æ˜¯å¦æœ‰ API æ–‡æ¡£ï¼Ÿ
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„ï¼Ÿ
- [ ] çŠ¶æ€å˜æ›´æ˜¯å¦è®°å½•åˆ°æ—¥å¿—è¡¨ï¼Ÿ

#### æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
2. **é›†æˆæµ‹è¯•**ï¼šæ¯ä¸ªæ¥å£éƒ½è¦ç”¨ Postman æµ‹è¯•
3. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæ¯ä¸ª Stage ç»“æŸåè¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•

#### éªŒæ”¶å‘½ä»¤ï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰

**å®Œæ•´éªŒæ”¶å‘½ä»¤è¯¦è§**ï¼šã€ŠæŠ€æœ¯æ–¹æ¡ˆ.mdã€‹A.1 èŠ‚"éªŒæ”¶å‘½ä»¤"

##### åç«¯éªŒæ”¶ï¼ˆbackend/ï¼‰

```bash
cd backend

# å®Œæ•´æ£€æŸ¥ï¼ˆç¼–è¯‘+æµ‹è¯•+é£æ ¼ï¼‰
./gradlew check

# æˆ–åˆ†æ­¥æ‰§è¡Œ
./gradlew compileJava      # ç¼–è¯‘
./gradlew test             # å•å…ƒæµ‹è¯•
./gradlew integrationTest  # é›†æˆæµ‹è¯•
./gradlew spotlessCheck    # ä»£ç é£æ ¼æ£€æŸ¥
```

##### å‰ç«¯éªŒæ”¶

**H5 ä¼šå‘˜ç«¯**ï¼ˆfrontend/h5-member/ï¼‰ï¼š

```bash
cd frontend/h5-member

# å®Œæ•´æ£€æŸ¥
npm run lint && npm run type-check && npm run test:unit

# æˆ–åˆ†æ­¥æ‰§è¡Œ
npm run lint          # ä»£ç æ£€æŸ¥
npm run type-check    # ç±»å‹æ£€æŸ¥
npm run test:unit     # å•å…ƒæµ‹è¯•
npm run build         # æ„å»ºéªŒè¯
```

**Web ç®¡ç†åå°**ï¼ˆfrontend/admin-web/ï¼‰ï¼š

```bash
cd frontend/admin-web

# å®Œæ•´æ£€æŸ¥
npm run lint && npm run type-check && npm run test:unit

# æ„å»ºéªŒè¯
npm run build
```

##### å®Œæ•´é¡¹ç›®éªŒæ”¶ï¼ˆæ¨èï¼‰

```bash
# é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./scripts/verify-all.sh

# è„šæœ¬å†…å®¹ï¼ˆè‡ªåŠ¨éªŒæ”¶åç«¯+H5+ç®¡ç†åå°ï¼‰
# è¯¦è§ã€ŠæŠ€æœ¯æ–¹æ¡ˆ.mdã€‹A.1 èŠ‚
```

##### å„ Stage éªŒæ”¶è¦æ±‚

| Stage | åç«¯éªŒæ”¶ | H5 éªŒæ”¶ | ç®¡ç†åå°éªŒæ”¶ |
|-------|---------|---------|-------------|
| Stage 0 | âœ… å¿…é¡» | âœ… å¿…é¡»ï¼ˆä»…éª¨æ¶ï¼‰ | âŒ ä¸éœ€è¦ |
| Stage 1 | âœ… å¿…é¡» | âœ… å¿…é¡»ï¼ˆä»…éª¨æ¶ï¼‰ | âœ… å¿…é¡» |
| Stage 2 | âœ… å¿…é¡» | âœ… å¿…é¡»ï¼ˆæ”¯ä»˜é¡µé¢ï¼‰ | âœ… å¿…é¡» |
| Stage 3-5 | âœ… å¿…é¡» | âœ… å¿…é¡» | âœ… å¿…é¡» |
| Stage 6 | âœ… å¿…é¡» | âœ… å¿…é¡»ï¼ˆå®Œæ•´ï¼‰ | âœ… å¿…é¡»ï¼ˆå®Œæ•´ï¼‰ |

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

### è¿›åº¦çœ‹æ¿

| Stage | çŠ¶æ€ | è¿›åº¦ | å¤‡æ³¨ |
|-------|------|------|------|
| Stage 0 | ğŸŸ¡ å¾…å¼€å§‹ | 0% | ç¯å¢ƒæ­å»º |
| Stage 1 | âšª æœªå¼€å§‹ | 0% | åŸºç¡€æ¡†æ¶ |
| Stage 2 | âšª æœªå¼€å§‹ | 0% | æ”¯ä»˜é›†æˆ |
| Stage 3 | âšª æœªå¼€å§‹ | 0% | æ‰“å¡åŒæ­¥ |
| Stage 4 | âšª æœªå¼€å§‹ | 0% | åŒ¹é…ç®—æ³• |
| Stage 5 | âšª æœªå¼€å§‹ | 0% | é€€æ¬¾æµç¨‹ |
| Stage 6 | âšª æœªå¼€å§‹ | 0% | å‰ç«¯å¼€å‘ |

### Stage ä¾èµ–å…³ç³»

```mermaid
graph LR
    S0[Stage 0: ç¯å¢ƒæ­å»º] --> S1[Stage 1: åŸºç¡€æ¡†æ¶]
    S1 --> S2[Stage 2: æ”¯ä»˜é›†æˆ]
    S2 --> S3[Stage 3: æ‰“å¡åŒæ­¥]
    S3 --> S4[Stage 4: åŒ¹é…ç®—æ³•]
    S4 --> S5[Stage 5: é€€æ¬¾æµç¨‹]
    S1 --> S6[Stage 6: å‰ç«¯å¼€å‘]
    S5 --> S6
```

---

## ğŸ‰ æ€»ç»“

è¿™ä»½ AI è¾…åŠ©æ•æ·å¼€å‘è®¡åˆ’çš„æ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **ä¸¥æ ¼å¯¹é½æŠ€æœ¯æ–‡æ¡£**ï¼š6 ä¸ª Stage å®Œå…¨å¯¹åº”æŠ€æœ¯æ–¹æ¡ˆçš„åˆ†é˜¶æ®µéªŒè¯è®¡åˆ’
2. **å®Œæ•´è¦†ç›–æ··åˆåŒ¹é…æ–¹æ¡ˆ**ï¼šOAuthç»‘å®š + æ”¯ä»˜åç»‘å®š + æ™ºèƒ½åŒ¹é…
3. **åŒ…å« H5 å®‰å…¨æœºåˆ¶**ï¼šaccessToken ç¥¨æ®éªŒè¯
4. **çŠ¶æ€æ—¥å¿—å®Œæ•´**ï¼š5 å¼ çŠ¶æ€æ—¥å¿—è¡¨å…¨éƒ¨å®ç°
5. **é€šçŸ¥ç³»ç»Ÿå®Œå–„**ï¼šnotification_message è¡¨ + å®šæ—¶ä»»åŠ¡

**é¢„æœŸæ•ˆæœ**ï¼š
- å¼€å‘æ•ˆç‡æå‡ **80-90%**
- ä»£ç è´¨é‡æ˜¾è‘—æ”¹å–„
- åŠŸèƒ½å®Œæ•´æ€§ **100%** å¯¹é½æŠ€æœ¯æ–¹æ¡ˆ
