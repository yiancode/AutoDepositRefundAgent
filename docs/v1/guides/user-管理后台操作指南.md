# 管理后台操作指南

> **文档版本**: v1.1
> **最后更新**: 2025-12-08
> **适用角色**: 管理员、运营人员
> **SSOT引用**: [状态枚举定义.md](../design/状态枚举定义.md) - 训练营、会员、支付、退款等状态值定义

> **文档目的**: 本文档面向系统管理员和运营人员，提供管理后台的日常操作说明。

---

## 目录

1. [登录与权限](#一登录与权限)
2. [训练营管理](#二训练营管理)
3. [会员管理](#三会员管理)
4. [打卡数据管理](#四打卡数据管理)
5. [退款审核](#五退款审核)
6. [数据统计](#六数据统计)
7. [系统配置](#七系统配置)
8. [常见问题](#八常见问题)

---

## 一、登录与权限

### 1.1 登录系统

1. 访问管理后台地址：`https://admin.example.com`
2. 输入用户名和密码
3. 点击"登录"按钮

### 1.2 角色权限说明

| 角色 | 权限范围 |
|------|----------|
| **管理员** (admin) | 所有功能，包括用户管理、系统配置 |
| **运营经理** (manager) | 训练营管理、会员管理、退款审核、统计报表 |
| **教练** (coach) | 查看所负责训练营的会员和打卡数据 |
| **志愿者** (volunteer) | 查看会员列表、标记进群状态 |

### 1.3 修改密码

1. 点击右上角头像
2. 选择"修改密码"
3. 输入原密码和新密码
4. 点击"确认"保存

---

## 二、训练营管理

### 2.1 创建训练营

**操作路径**：训练营管理 → 创建训练营

**必填信息**：

| 字段 | 说明 | 示例 |
|------|------|------|
| 训练营名称 | 最长100字符 | 21天早起打卡训练营 |
| 海报图片 | 支持 JPG/PNG，建议 750×1334 | 上传或输入URL |
| 押金金额 | 单位：元 | 99.00 |
| 开始日期 | 训练营开始日期 | 2025-12-10 |
| 结束日期 | 训练营结束日期 | 2025-12-31 |
| 要求打卡天数 | 达标所需天数 | 15 |
| 群二维码 | 训练营群的二维码图片 | 上传或输入URL |
| 星球项目ID | 知识星球打卡项目ID | 15555411412112 |

**操作步骤**：

1. 填写上述必填信息
2. （可选）填写训练营介绍、规则说明
3. 点击"保存草稿"或"立即发布"

### 2.2 发布训练营

**前置条件**：训练营状态为"草稿"

1. 进入训练营详情页
2. 检查所有信息是否正确
3. 点击"发布"按钮
4. 系统生成报名链接和二维码

**发布后**：
- 状态变为"报名中"
- 生成固定报名链接：`https://h5.example.com/enroll/{id}`
- 可下载报名二维码用于宣传

### 2.3 训练营状态说明

```
草稿 (draft) → 报名中 (enrolling) → 进行中 (ongoing) → 已结束 (finished) → 已归档 (archived)
```

| 状态 | 说明 | 可执行操作 |
|------|------|-----------|
| 草稿 | 新创建，未发布 | 编辑、发布、删除 |
| 报名中 | 接受报名 | 编辑（部分）、查看会员 |
| 进行中 | 训练营进行中 | 查看打卡、同步数据 |
| 已结束 | 训练期结束 | 生成退款名单、审核退款 |
| 已归档 | 处理完毕 | 仅查看 |

### 2.4 更新群二维码

> 微信群二维码有效期为7天，需定期更新。

1. 进入训练营详情
2. 点击"更换群二维码"
3. 上传新的二维码图片
4. 点击"保存"

**建议**：设置日历提醒，每6天更新一次群二维码。

---

## 三、会员管理

### 3.1 查看会员列表

**操作路径**：会员管理 → 会员列表

**筛选条件**：
- 训练营：选择具体训练营
- 匹配状态：待匹配 / 已匹配 / 匹配失败
- 进群状态：已进群 / 未进群
- 退款资格：符合 / 不符合

### 3.2 会员绑定状态说明

| 状态 | 说明 | 处理方式 |
|------|------|----------|
| **已完成** (completed) | 用户主动绑定成功 | 无需处理 |
| **待绑定** (pending) | 等待用户在7天内完成绑定 | 可发送提醒 |
| **待审核** (manual_review) | 绑定超时转入人工审核 | 需手动匹配 |
| **已过期** (expired) | 超过绑定期限 | 转入人工审核 |
| **已关闭** (closed) | 无法匹配已关闭 | 终态，无需处理 |

### 3.3 手动匹配会员

**适用场景**：
- 用户未在7天内完成绑定（bind_status = manual_review）
- 用户信息填写错误需更正

**操作步骤**：

1. 在会员列表找到待匹配会员
2. 点击"手动匹配"按钮
3. 搜索正确的星球用户（按昵称或星球ID）
4. 选择匹配的星球用户
5. 点击"确认匹配"

### 3.4 标记进群

1. 找到已支付但未进群的会员
2. 确认会员已加入训练营群
3. 点击"标记进群"按钮

**批量操作**：勾选多个会员 → 点击"批量标记进群"

### 3.5 导出会员数据

1. 设置筛选条件
2. 点击"导出"按钮
3. 选择导出格式（Excel / CSV）
4. 下载文件

**导出字段**：会员ID、星球昵称、微信昵称、支付金额、支付时间、打卡次数、打卡率、退款状态

---

## 四、打卡数据管理

### 4.1 自动同步机制

系统每日自动同步打卡数据：
- **同步时间**：每日 01:00、07:00、13:00、19:00
- **同步范围**：所有"进行中"状态的训练营
- **数据来源**：知识星球打卡项目API

### 4.2 手动触发同步

**适用场景**：
- 需要立即查看最新打卡数据
- 自动同步失败后补充同步

**操作步骤**：

1. 进入训练营详情
2. 点击"同步打卡数据"按钮
3. 等待同步完成（通常30秒-2分钟）
4. 查看同步结果

### 4.3 查看打卡统计

**统计维度**：

| 指标 | 说明 |
|------|------|
| 今日打卡人数 | 当日完成打卡的会员数 |
| 今日打卡率 | 今日打卡人数 / 总会员数 |
| 平均打卡率 | 历史平均打卡率 |
| 达标人数 | 打卡天数 ≥ 要求天数的会员数 |
| 打卡分布 | 按打卡天数区间统计人数 |

### 4.4 处理同步失败

**常见原因及解决方案**：

| 错误信息 | 原因 | 解决方案 |
|----------|------|----------|
| Cookie已过期 | 知识星球登录态失效 | 更新系统配置中的Cookie |
| API调用频繁 | 短时间内请求过多 | 等待5分钟后重试 |
| 网络超时 | 网络不稳定 | 重试同步操作 |

---

## 五、退款审核

### 5.1 退款流程概述

```
训练营结束 → 系统生成退款名单 → 管理员审核 → 系统执行退款 → 通知会员
```

### 5.2 查看待审核列表

**操作路径**：退款管理 → 待审核

**列表信息**：
- 会员昵称、星球ID
- 打卡天数、打卡率
- 绑定方式
- 退款金额

### 5.3 审核单个退款

1. 点击会员记录查看详情
2. 核对以下信息：
   - 打卡记录是否真实
   - 身份匹配是否正确
   - 退款金额是否正确
3. 点击"通过"或"拒绝"
4. （拒绝时）填写拒绝原因

### 5.4 批量审核

> 适用于同一绑定方式的退款申请批量处理

1. 设置筛选条件：
   - 按绑定方式筛选（如：`h5_bindplanet` 或 `user_fill`）
   - 或筛选 `bind_status = completed` 的记录
2. 勾选要审核的记录（或全选）
3. 点击"批量通过"
4. 确认操作

**建议**：人工匹配（`bind_method = manual`）的记录建议逐条审核确认。

### 5.5 退款状态说明

| 状态 | 说明 |
|------|------|
| 待审核 (pending) | 等待管理员审核 |
| 已通过 (approved) | 审核通过，等待执行 |
| 已拒绝 (rejected) | 审核拒绝，不予退款 |
| 处理中 (processing) | 正在调用微信退款API |
| 已退款 (success) | 退款成功 |
| 退款失败 (failed) | 退款执行失败 |

### 5.6 处理退款失败

1. 在退款记录中找到失败的记录
2. 查看失败原因（如：商户余额不足）
3. 解决问题后点击"重试退款"
4. 最多重试3次

**常见失败原因**：

| 原因 | 解决方案 |
|------|----------|
| 商户余额不足 | 充值商户账户后重试 |
| 用户账户异常 | 联系用户确认收款账户 |
| 系统超时 | 等待5分钟后重试 |

---

## 六、数据统计

### 6.1 数据概览

**操作路径**：统计报表 → 数据概览

**展示内容**：
- 总训练营数、进行中训练营数
- 总会员数、总收款金额
- 总退款金额、净收入
- 近期趋势图

### 6.2 训练营统计

**操作路径**：统计报表 → 训练营统计 → 选择训练营

**统计维度**：

| 维度 | 指标 |
|------|------|
| 报名 | 总人数、匹配率、进群率 |
| 打卡 | 平均打卡率、达标率、每日趋势 |
| 财务 | 总收款、总退款、净收入、退款率 |
| 退款 | 成功数、失败数、成功率 |

### 6.3 导出报表

1. 选择报表类型（概览/详情）
2. 选择时间范围或训练营
3. 选择导出格式（Excel / PDF）
4. 点击"导出"

---

## 七、系统配置

> 仅管理员可操作

### 7.1 更新知识星球Cookie

**操作频率**：Cookie通常7-30天过期，收到"Cookie过期"告警时需更新

**获取步骤**：

1. 浏览器登录知识星球网页版
2. 打开开发者工具（F12）
3. 切换到 Network 标签
4. 刷新页面，找到任意API请求
5. 复制 Request Headers 中的 Cookie 值

**配置步骤**：

1. 进入系统配置
2. 找到"知识星球Cookie"配置项
3. 粘贴新的Cookie值
4. 点击"保存"
5. 点击"测试连接"验证

### 7.2 用户管理

**添加用户**：

1. 进入用户管理
2. 点击"添加用户"
3. 填写用户名、密码、真实姓名
4. 选择角色
5. 点击"创建"

**禁用用户**：

1. 找到要禁用的用户
2. 点击"禁用"按钮
3. 确认操作

---

## 八、常见问题

### Q1: 会员支付成功但未显示在列表中？

**可能原因**：
1. 支付回调延迟（等待1-2分钟）
2. 支付回调处理失败

**解决方案**：
1. 等待几分钟后刷新页面
2. 检查系统日志中的回调记录
3. 联系技术人员排查

### Q2: 打卡数据与知识星球不一致？

**可能原因**：
1. 同步时间差（最长4小时延迟）
2. 会员身份匹配错误

**解决方案**：
1. 手动触发同步
2. 检查会员匹配是否正确
3. 查看打卡详情核对

### Q3: 退款一直显示"处理中"？

**可能原因**：
1. 微信支付接口响应慢
2. 回调处理异常

**解决方案**：
1. 等待30分钟
2. 若仍未完成，点击"刷新状态"
3. 联系技术人员检查回调日志

### Q4: 如何处理用户投诉"打卡达标但未退款"？

**处理步骤**：

1. 核实用户身份（订单号、星球昵称）
2. 查看匹配状态和打卡记录
3. 若匹配错误，进行手动匹配
4. 若确实达标，手动通过退款审核
5. 记录处理结果，反馈用户

### Q5: 群二维码过期怎么办？

**紧急处理**：

1. 立即生成新的群二维码
2. 在管理后台更新二维码
3. 检查是否有会员因此无法进群
4. 设置提醒，避免再次过期

---

## 附录：快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + S` | 保存当前编辑 |
| `Ctrl + F` | 打开搜索 |
| `Esc` | 关闭弹窗 |

---

## 相关文档

- [接口文档](../api/接口文档.md) - API技术详情
- [数据库设计](../design/数据库设计.md) - 数据结构说明
- [状态枚举定义](../design/状态枚举定义.md) - 状态值标准

---

**文档版本**：v1.1
**最后更新**：2025-12-08
**维护者**：运营团队
